<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片颜色拾取器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#06b6d4',
            dark: '#1e293b',
            light: '#f8fafc'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .transition-transform-opacity {
        transition-property: transform, opacity;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
      }
      .shadow-soft {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.03);
      }
      .color-preview {
        @apply w-10 h-10 rounded-full border-2 border-white shadow-md transition-all duration-300;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50;
      }
      .btn-secondary {
        @apply bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400/50;
      }
      .btn-active {
        @apply bg-primary/20 text-primary border border-primary;
      }
      .input-file {
        @apply hidden;
      }
      .label-file {
        @apply cursor-pointer bg-primary/10 hover:bg-primary/20 text-primary font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2;
      }
      .panel {
        @apply bg-white rounded-xl shadow-soft p-5 transition-all duration-500;
      }
      .result-item {
        @apply flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors duration-200;
      }
      .magnifier {
        position:fixed;
        @apply pointer-events-none w-24 h-24 rounded-full border-4 border-white shadow-xl scale-0 opacity-0 transition-all duration-200 z-50;
      }
      .min-h-canvas {
        min-height: 300px;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-inter text-dark">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- 页面标题 -->
    <header class="text-center mb-10 animate-fade-in">
      <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent mb-3">
        图片颜色拾取器
      </h1>
      <p class="text-gray-600 text-lg max-w-2xl mx-auto">
        上传图片后，在图片上移动鼠标或触摸屏幕即可实时获取颜色值，支持多种格式显示
      </p>
    </header>

    <!-- 主内容区 -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- 左侧控制面板 -->
      <section class="lg:col-span-1 space-y-6">
        <!-- 图片上传面板 -->
        <div class="panel">
          <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            <i class="fa fa-upload text-primary"></i> 上传图片
          </h2>
          <div class="space-y-4">
            <div class="flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-primary/50 transition-colors duration-300">
              <input type="file" id="imageUpload" accept="image/*" class="input-file" />
              <label for="imageUpload" class="label-file w-full">
                <i class="fa fa-cloud-upload-alt"></i> 选择图片文件
              </label>
              <p class="text-sm text-gray-500 mt-2">支持 JPG、PNG 等格式</p>
            </div>
            
            <div id="imagePreviewContainer" class="hidden">
              <h3 class="text-lg font-medium mb-2">图片预览</h3>
              <div class="relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden border border-gray-200">
                <img id="imagePreview" src="" alt="预览图片" class="w-full h-full object-contain" />
                <div id="imagePlaceholder" class="absolute inset-0 flex items-center justify-center text-gray-400">
                  <i class="fa fa-image text-4xl"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 颜色信息面板 -->
        <div class="panel" id="colorInfoPanel">
          <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            <i class="fa fa-eyedropper text-primary"></i> 颜色信息
          </h2>
          <div id="noColorSelected" class="py-10 text-center text-gray-500">
            <i class="fa fa-info-circle text-3xl mb-3"></i>
            <p>请上传图片并在图片上移动鼠标或触摸屏幕来选择颜色</p>
          </div>
          
          <div id="colorInfoContent" class="hidden space-y-5">
            <div class="flex items-center justify-center mb-4">
              <div id="colorPreview" class="color-preview"></div>
            </div>
            
            <div class="space-y-3">
              <div class="result-item">
                <span class="w-24 text-gray-600" style="width: 4rem;">RGB:</span>
                <span id="rgbValue" class="font-mono font-medium">#FFFFFF</span>
                <button class="copy-btn ml-auto text-gray-400 hover:text-primary transition-colors" data-target="rgbValue">
                  <i class="fa fa-copy"></i>
                </button>
              </div>
              
              <div class="result-item">
                <span class="w-24 text-gray-600" style="width: 4rem;">HEX:</span>
                <span id="hexValue" class="font-mono font-medium">#FFFFFF</span>
                <button class="copy-btn ml-auto text-gray-400 hover:text-primary transition-colors" data-target="hexValue">
                  <i class="fa fa-copy"></i>
                </button>
              </div>
              
              <div class="result-item">
                <span class="w-24 text-gray-600" style="width: 4rem;">HSL:</span>
                <span id="hslValue" class="font-mono font-medium">hsl(0, 0%, 100%)</span>
                <button class="copy-btn ml-auto text-gray-400 hover:text-primary transition-colors" data-target="hslValue">
                  <i class="fa fa-copy"></i>
                </button>
              </div>
              
              <div class="result-item">
                <span class="w-24 text-gray-600" style="width: 4rem;">坐标:</span>
                <span id="positionValue" class="font-mono font-medium">X: 0, Y: 0</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 右侧图片和取色区 -->
      <section class="lg:col-span-2">
        <div class="panel h-full flex flex-col">
          <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
            <h2 class="text-xl font-semibold flex items-center gap-2">
              <i class="fa fa-picture-o text-primary"></i> 取色区域
            </h2>
            <div class="flex gap-2">
              <button id="zoomInBtn" class="btn-secondary text-sm">
                <i class="fa fa-search-plus"></i> 放大
              </button>
              <button id="zoomOutBtn" class="btn-secondary text-sm">
                <i class="fa fa-search-minus"></i> 缩小
              </button>
              <button id="resetZoomBtn" class="btn-secondary text-sm">
                <i class="fa fa-refresh"></i> 重置
              </button>
              <button id="panBtn" class="btn-secondary text-sm">
                <i class="fa fa-arrows"></i> 移动
              </button>
            </div>
          </div>
          
          <div id="noImageSelected" class="flex-1 flex flex-col items-center justify-center text-gray-500 min-h-canvas">
            <i class="fa fa-image text-6xl mb-5"></i>
            <p class="text-lg">请上传一张图片开始取色</p>
          </div>
          
          <div id="imageContainer" class="hidden flex-1 relative bg-gray-50 rounded-lg overflow-hidden min-h-canvas">
            <div class="absolute inset-0 flex items-center justify-center">
              <canvas id="imageCanvas" class="cursor-crosshair"></canvas>
            </div>
            
            <!-- 放大镜 -->
            <div id="magnifier" class="magnifier">
              <canvas id="magnifierCanvas" class="w-full h-full rounded-full"></canvas>
            </div>
            
            <!-- 颜色指示器 -->
            <div id="colorIndicator" class="absolute w-4 h-4 rounded-full border-2 border-white shadow-md transform -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all duration-150"></div>
          </div>
        </div>
      </section>
    </main>

    <!-- 页脚 -->
    <footer class="mt-16 text-center text-gray-500 text-sm">
      <p>© 2025 图片颜色拾取器 | 一个高效的在线颜色提取工具 BY JAVA</p>
    </footer>
  </div>

  <!-- 复制成功提示 -->
  <div id="copyToast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-dark text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
    已复制到剪贴板！
  </div>

  <script>
    // DOM 元素
    const imageUpload = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const imagePlaceholder = document.getElementById('imagePlaceholder');
    const imageCanvas = document.getElementById('imageCanvas');
    const imageContainer = document.getElementById('imageContainer');
    const noImageSelected = document.getElementById('noImageSelected');
    const noColorSelected = document.getElementById('noColorSelected');
    const colorInfoContent = document.getElementById('colorInfoContent');
    const colorPreview = document.getElementById('colorPreview');
    const rgbValue = document.getElementById('rgbValue');
    const hexValue = document.getElementById('hexValue');
    const hslValue = document.getElementById('hslValue');
    const positionValue = document.getElementById('positionValue');
    const colorIndicator = document.getElementById('colorIndicator');
    const magnifier = document.getElementById('magnifier');
    const magnifierCanvas = document.getElementById('magnifierCanvas');
    const copyToast = document.getElementById('copyToast');
    const zoomInBtn = document.getElementById('zoomInBtn');
    const zoomOutBtn = document.getElementById('zoomOutBtn');
    const resetZoomBtn = document.getElementById('resetZoomBtn');
    const panBtn = document.getElementById('panBtn');

    // 变量
    let image = null;
    let ctx = null;
    let magnifierCtx = null;
    let zoomLevel = 1;
    const MAGNIFIER_SIZE = 120; // 放大镜尺寸
    const MAGNIFIER_SCALE = 5; // 放大镜放大倍数
    let isPanning = false; // 移动状态标志
    let isDragging = false; // 拖拽状态标志
    let lastX, lastY; // 上次鼠标位置
    let panOffset = { x: 0, y: 0 }; // 平移偏移量

    // 初始化
    function init() {
      // 获取Canvas上下文
      ctx = imageCanvas.getContext('2d');
      magnifierCtx = magnifierCanvas.getContext('2d');
      
      // 设置Canvas尺寸
      imageCanvas.width = 800;
      imageCanvas.height = 600;
      magnifierCanvas.width = MAGNIFIER_SIZE;
      magnifierCanvas.height = MAGNIFIER_SIZE;
      
      // 事件监听
      imageUpload.addEventListener('change', handleImageUpload);
      imageCanvas.addEventListener('mousedown', handleCanvasMouseDown);
      imageCanvas.addEventListener('mouseup', handleCanvasMouseUp);
      imageCanvas.addEventListener('mousemove', handleCanvasMouseMove);
      imageCanvas.addEventListener('mouseleave', handleCanvasMouseLeave);
      imageCanvas.addEventListener('touchmove', handleCanvasTouchMove, { passive: false });
      imageCanvas.addEventListener('touchstart', handleCanvasTouchStart, { passive: false });
      imageCanvas.addEventListener('touchend', handleCanvasTouchEnd);
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', handleCopy);
      });
      imageCanvas.addEventListener('click', handleCopyColor);
      zoomInBtn.addEventListener('click', handleZoomIn);
      zoomOutBtn.addEventListener('click', handleZoomOut);
      resetZoomBtn.addEventListener('click', handleResetZoom);
      panBtn.addEventListener('click', togglePanMode);
      // 监听窗口大小变化，调整Canvas尺寸
      window.addEventListener('resize', handleResize);
    }

    // 切换移动模式
    function togglePanMode() {
      isPanning = !isPanning;
      
      if (isPanning) {
        panBtn.classList.add('btn-active');
        imageCanvas.style.cursor = 'move';
        // 隐藏颜色指示器和放大镜
        colorIndicator.style.opacity = '0';
        colorIndicator.style.transform = 'translate(-50%, -50%) scale(0)';
        magnifier.style.opacity = '0';
        magnifier.style.transform = 'scale(0)';
      } else {
        panBtn.classList.remove('btn-active');
        imageCanvas.style.cursor = 'crosshair';
      }
    }

    // 处理窗口大小变化
    function handleResize() {
      if (image) {
        drawImage();
      }
    }
    // 处理图片上传
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        image = new Image();
        image.onload = function() {
          // 显示图片预览
          imagePreview.src = event.target.result;
          imagePreviewContainer.classList.remove('hidden');
          imagePlaceholder.classList.add('hidden');
          
          // 显示图片Canvas
          noImageSelected.classList.add('hidden');
          imageContainer.classList.remove('hidden');
          
          // 重置缩放
          zoomLevel = 1;
          
          // 绘制图片
          drawImage();
        };
        image.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    // 绘制图片
    function drawImage() {
      if (!image) return;
      // 设置Canvas尺寸与容器一致
      const container = imageCanvas.parentElement;
      imageCanvas.width = container.clientWidth;
      imageCanvas.height = container.clientHeight;
      // 设置Canvas尺寸与图片一致
        //   imageCanvas.width = image.width * zoomLevel;
        //   imageCanvas.height = image.height * zoomLevel;
        // 清除Canvas
        ctx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
      // 计算图片绘制位置（居中）
      const displayWidth = image.width * zoomLevel;
      const displayHeight = image.height * zoomLevel;
      const x = (imageCanvas.width - displayWidth) / 2 + panOffset.x;
      const y = (imageCanvas.height - displayHeight) / 2 + panOffset.y;
      
      // 绘制图片
      ctx.drawImage(image, x, y, displayWidth, displayHeight);
      // 清除Canvas
    //   ctx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
      
      // 绘制图片
    //   ctx.drawImage(image, 0, 0, image.width * zoomLevel, image.height * zoomLevel);
    }

    // 处理Canvas鼠标移动
    function handleCanvasMouseMove(e) {
      if (!image) return;
      if (isPanning && isDragging) {
        // 拖拽移动图片
        const rect = imageCanvas.getBoundingClientRect();
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY - rect.top;
        
        // 计算偏移量
        panOffset.x += currentX - lastX;
        panOffset.y += currentY - lastY;
        
        // 更新上次位置
        lastX = currentX;
        lastY = currentY;
        
        // 重绘图片
        drawImage();
        
        return;
      }
      if (isPanning) return;
      // console.log(e);
      // 获取鼠标在Canvas上的坐标
      // const rect = imageContainer.getBoundingClientRect();
      // const canvasRect = imageCanvas.getBoundingClientRect();
      // let canvasRealX = e.clientX - Math
      const canvasX = e.offsetX;
      const canvasY = e.offsetY;
      
      // 获取实际图片上的坐标（考虑缩放）
      const imageX = Math.floor(canvasX / zoomLevel);
      const imageY = Math.floor(canvasY / zoomLevel);
      
      // 确保坐标在图片范围内
      if (imageX >= 0 && imageX < image.width && imageY >= 0 && imageY < image.height) {
        // 获取颜色
        const pixelData = ctx.getImageData(canvasX, canvasY, 1, 1).data;
        const color = {
          r: pixelData[0],
          g: pixelData[1],
          b: pixelData[2],
          a: pixelData[3]
        };
        
        // 更新颜色信息
        updateColorInfo(color, imageX, imageY);
        
        // 显示颜色指示器
        // colorIndicator.style.left = `${canvasX}px`;
        // colorIndicator.style.top = `${canvasY}px`;
        // colorIndicator.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
        // colorIndicator.style.opacity = '1';
        // colorIndicator.style.transform = 'translate(-50%, -50%) scale(1)';
        
        // 更新放大镜
        updateMagnifier(canvasX, canvasY);
        
        // 调整放大镜位置，使其中心对准鼠标
        magnifier.style.left = `${e.clientX - MAGNIFIER_SIZE / 2}px`;
        magnifier.style.top = `${e.clientY - MAGNIFIER_SIZE / 2}px`;
        magnifier.style.opacity = '1';
        magnifier.style.transform = 'scale(1)';
      }
    }

    // 处理Canvas鼠标按下
    function handleCanvasMouseDown(e) {
      if (!image || !isPanning) return;
      
      isDragging = true;
      const rect = imageCanvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
      
      // 改变鼠标样式
      imageCanvas.style.cursor = 'grabbing';
    }

    // 处理Canvas鼠标释放
    function handleCanvasMouseUp() {
      if (!isPanning) return;
      
      isDragging = false;
      imageCanvas.style.cursor = 'move';
    }

    // 处理Canvas触摸开始
    function handleCanvasTouchStart(e) {
      if (!image || !isPanning) return;
      
      e.preventDefault();
      isDragging = true;
      const rect = imageCanvas.getBoundingClientRect();
      const touch = e.touches[0];
      lastX = touch.clientX - rect.left;
      lastY = touch.clientY - rect.top;
    }

    // 处理Canvas鼠标离开
    function handleCanvasMouseLeave() {
        if (isPanning && isDragging) {
        isDragging = false;
        imageCanvas.style.cursor = 'move';
      } else if (!isPanning) {
        colorIndicator.style.opacity = '0';
        colorIndicator.style.transform = 'translate(-50%, -50%) scale(0)';
        magnifier.style.opacity = '0';
        magnifier.style.transform = 'scale(0)';
      }
    }

    // 处理Canvas触摸移动
    function handleCanvasTouchMove(e) {
      e.preventDefault(); // 防止页面滚动
      
      if (!image) return;
      if (isPanning && isDragging) {
        // 触摸拖拽移动图片
        e.preventDefault();
        const rect = imageCanvas.getBoundingClientRect();
        const touch = e.touches[0];
        const currentX = touch.clientX - rect.left;
        const currentY = touch.clientY - rect.top;
        
        // 计算偏移量
        panOffset.x += currentX - lastX;
        panOffset.y += currentY - lastY;
        
        // 更新上次位置
        lastX = currentX;
        lastY = currentY;
        
        // 重绘图片
        drawImage();
        
        return;
      }
      if (isPanning) return;
      console.log(e.touches[0]);
      // 获取触摸点在Canvas上的坐标
      const rect = imageCanvas.getBoundingClientRect();
      console.log(rect);
      const touch = e.touches[0];
      const canvasX = touch.clientX - rect.left;
      const canvasY = touch.clientY - rect.top;
      
      // 获取实际图片上的坐标（考虑缩放）
      const imageX = Math.floor(canvasX / zoomLevel);
      const imageY = Math.floor(canvasY / zoomLevel);
      
      // 确保坐标在图片范围内
      if (imageX >= 0 && imageX < image.width && imageY >= 0 && imageY < image.height) {
        // 获取颜色
        const pixelData = ctx.getImageData(canvasX, canvasY, 1, 1).data;
        const color = {
          r: pixelData[0],
          g: pixelData[1],
          b: pixelData[2],
          a: pixelData[3]
        };
        
        // 更新颜色信息
        updateColorInfo(color, imageX, imageY);
        
        // 显示颜色指示器
        // colorIndicator.style.left = `${canvasX}px`;
        // colorIndicator.style.top = `${canvasY}px`;
        // colorIndicator.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
        // colorIndicator.style.opacity = '1';
        // colorIndicator.style.transform = 'translate(-50%, -50%) scale(1)';
        
        // 更新放大镜
        updateMagnifier(canvasX, canvasY);
        
        // 调整放大镜位置，使其中心对准触摸点
        magnifier.style.left = `${touch.clientX - MAGNIFIER_SIZE / 2}px`;
        magnifier.style.top = `${touch.clientY - MAGNIFIER_SIZE / 2 - 60}px`;
        magnifier.style.opacity = '1';
        magnifier.style.transform = 'scale(1)';
      }
    }

    // 处理Canvas触摸结束
    function handleCanvasTouchEnd() {
        if (isPanning) {
        isDragging = false;
      } else {
        colorIndicator.style.opacity = '0';
        colorIndicator.style.transform = 'translate(-50%, -50%) scale(0)';
        magnifier.style.opacity = '0';
        magnifier.style.transform = 'scale(0)';
      }
    }

    // 更新颜色信息
    function updateColorInfo(color, x, y) {
      // 显示颜色信息面板
      noColorSelected.classList.add('hidden');
      colorInfoContent.classList.remove('hidden');
      
      // 更新颜色预览
      colorPreview.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
      
      // 更新RGB值
      rgbValue.textContent = `rgb(${color.r}, ${color.g}, ${color.b})`;
      
      // 更新HEX值
      const hex = rgbToHex(color.r, color.g, color.b);
      hexValue.textContent = hex;
      
      // 更新HSL值
      const hsl = rgbToHsl(color.r, color.g, color.b);
      hslValue.textContent = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
      
      // 更新坐标值
      positionValue.textContent = `X: ${x}, Y: ${y}`;
    }

    // 更新放大镜
    function updateMagnifier(canvasX, canvasY) {
      if (!image) return;
      
      // 清除放大镜Canvas
      magnifierCtx.clearRect(0, 0, MAGNIFIER_SIZE, MAGNIFIER_SIZE);
      
      // 计算放大镜显示的区域
      const sourceX = canvasX - (MAGNIFIER_SIZE / 2 / MAGNIFIER_SCALE);
      const sourceY = canvasY - (MAGNIFIER_SIZE / 2 / MAGNIFIER_SCALE);
      
      // 绘制放大的图像
      magnifierCtx.drawImage(
        imageCanvas,
        sourceX, sourceY,
        MAGNIFIER_SIZE / MAGNIFIER_SCALE,
        MAGNIFIER_SIZE / MAGNIFIER_SCALE,
        0, 0,
        MAGNIFIER_SIZE,
        MAGNIFIER_SIZE
      );
      
      // 绘制十字线
      magnifierCtx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
      magnifierCtx.lineWidth = 2;
      
      // 水平线
      magnifierCtx.beginPath();
      magnifierCtx.moveTo(0, MAGNIFIER_SIZE / 2);
      magnifierCtx.lineTo(MAGNIFIER_SIZE, MAGNIFIER_SIZE / 2);
      magnifierCtx.stroke();
      
      // 垂直线
      magnifierCtx.beginPath();
      magnifierCtx.moveTo(MAGNIFIER_SIZE / 2, 0);
      magnifierCtx.lineTo(MAGNIFIER_SIZE / 2, MAGNIFIER_SIZE);
      magnifierCtx.stroke();
      
      // 绘制边框圆圈
      magnifierCtx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
      magnifierCtx.lineWidth = 4;
      magnifierCtx.beginPath();
      magnifierCtx.arc(MAGNIFIER_SIZE / 2, MAGNIFIER_SIZE / 2, MAGNIFIER_SIZE / 2 - 2, 0, 2 * Math.PI);
      magnifierCtx.stroke();
      
      // 绘制中心点标记
      magnifierCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      magnifierCtx.beginPath();
      magnifierCtx.arc(MAGNIFIER_SIZE / 2, MAGNIFIER_SIZE / 2, 2, 0, 2 * Math.PI);
      magnifierCtx.fill();
    }

    // RGB转HEX
    function rgbToHex(r, g, b) {
      return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
    }

    // RGB转HSL
    function rgbToHsl(r, g, b) {
      r /= 255;
      g /= 255;
      b /= 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      
      if (max === min) {
        h = s = 0; // 灰色
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        
        h /= 6;
      }
      
      return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        l: Math.round(l * 100)
      };
    }

    // 处理复制
    function handleCopy(e) {
      const targetId = e.currentTarget.getAttribute('data-target');
      const textToCopy = document.getElementById(targetId).textContent;
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        // 显示复制成功提示
        copyToast.style.opacity = '1';
        window.parent.postMessage(textToCopy,'*');
        
        // 3秒后隐藏提示
        setTimeout(() => {
          copyToast.style.opacity = '0';
        }, 3000);
      });
    }

    function handleCopyColor (e) {
        if (isPanning) return;
      const textToCopy = colorPreview.style.backgroundColor;
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        // 显示复制成功提示
        copyToast.style.opacity = '1';
        window.parent.postMessage(hexValue.textContent,'*');
        
        // 3秒后隐藏提示
        setTimeout(() => {
          copyToast.style.opacity = '0';
        }, 3000);
      });
    }

    // 处理缩放
    function handleZoomIn() {
      if (!image) return;
      
      zoomLevel = Math.min(zoomLevel + 0.1, 10);
      drawImage();
    }

    function handleZoomOut() {
      if (!image) return;
      
      zoomLevel = Math.max(zoomLevel - 0.1, 0.1);
      drawImage();
    }

    function handleResetZoom() {
      if (!image) return;
      
      zoomLevel = 1;
      drawImage();
    }

    // 初始化应用
    init();
  </script>
</body>
</html>
  