var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&r(e,l,a[l]);return e};import{P as n,a as c}from"./PersonShareDialog-858eaa85.js";import{d,as as u,y as p,r as g,o as h,ai as f,R as m,t as b,at as v,aj as y,a as V,ag as C,an as P,I as j,g as k,a4 as _,au as D,am as w,A as I,u as T,b as x,aa as $,e as S,n as O,V as A,j as E,k as q,h as R,ap as z,F as N,q as F,p as U,f as B,l as L,x as H}from"./index-7e9c327e.js";import{g as Q}from"./grid-429fa51c.js";import{l as G,_ as J}from"./logo-145c6dfc.js";import{h as K,_ as W}from"./hot-15b909cf.js";import{e as M,_ as X}from"./empty-6f34f8e8.js";import{_ as Y}from"./plugin-vue_export-helper-46f75680.js";import"./useDB-d1ce478c.js";var Z=d({name:"module",components:{PersonShareDialog:n,PublishEditDialog:c,SafeRender:{props:{sourceText:{type:String,required:!0}},render(){if(""===this.sourceText||!this.sourceText)return"";const e=this.sourceText.split("@");if(1===e.length)return this.sourceText;const a=e[1];if(1===a.split("[").length)return this.sourceText;const l=a.split("[")[0].trim(),t=a.split("[")[1].split("]")[0],o=a.split("[")[1].split("]")[1];return l&&t?u("div",[e[0],u("a",{href:t,target:"_blank"},"@"+l),o]):this.sourceText}}},props:{},emits:[],setup(e,t){const{proxy:o}=k(),s=p();let r=g({PublishEditVisible:!1,editProjectInfo:null,moduleList:[],isloading:!0,searchValue:"",searchData:[],activityData:[],filterValue:[0],filterOptions:[{value:0,label:"全部"},{value:1,label:"动态"},{value:2,label:"静态"},{value:3,label:"临摹"},{value:4,label:"原创"},{value:5,label:"二创"}],orderOptions:[{value:"-isTop,-downloadCount",label:"按热度排序"},{value:"-updatedAt",label:"按更新时间排序"},{value:"-createdAt",label:"按发布时间排序"}],filterOrderValue:"",currentPage:1,pageSize:15,total:0,loadingText:"正在加载...",isDevelop:!1,isDownload:!1,isImport:!1});const n={getFrameImg:V((()=>e=>e&&""!==e?`${o.$config.HUAWEI_OBS_CONFIG.HOST}${e}`:Q)),getAuthorImg:V((()=>e=>e.authorUid?`${o.$config.HUAWEI_OBS_CONFIG.HOST}/${e.authorUid}.png`:G)),getSource:V((()=>e=>{if(""===e||!e)return o.$config.projectSource[0];let a=e.split(","),l="";for(let t=0;t<a.length;t++)t+1===a.length&&a.length>=2&&(l+="/"),l+=o.$config.projectSource[a[t]];return l}))};let c={handleShare({projectId:e}){let a=_()+"draw/C"+e;o.$refs.PersonShareDialog.handleOpen("作品分享",a)},handleEditProject(e){r.searchData.forEach((a=>{a.projectId===e.projectId&&(a.desc=e.desc,a.isPass="0",a.author=e.author,a.projectName=e.projectName,a.tag=e.tag)}))},handleEdit(e){r.editProjectInfo=JSON.parse(JSON.stringify(e)),r.PublishEditVisible=!0},handleFilterOrder(){r.currentPage=1,c.handleSearch(r.filterOrderValue)},handleOpenUserPage(e){o.$router.push({name:"user",params:{username:e}})},search(){if(""===r.searchValue.trim())return o.$message.warning("请输入搜索内容");r.isloading=!0,r.loadingText="正在搜索...",r.currentPage=1,c.handleSearch()},handleSearch(e=r.filterOrderValue){r.isloading=!0;const a=o.$bmob.Query("Resource");if(r.isDevelop||a.equalTo("isPass","==","1"),""!==r.searchValue){const e=a.equalTo("projectName","==",r.searchValue),l=a.equalTo("desc","==",r.searchValue),t=a.equalTo("author","==",r.searchValue),o=a.equalTo("tip","==",r.searchValue);a.or(e,l,t,o)}if(0!==r.filterValue[0]){if(r.filterValue.includes(1)&&r.filterValue.includes(2)){let e=a.equalTo("tag","==","1"),l=a.equalTo("tag","==","0");a.or(e,l)}else 1===r.filterValue[0]?a.equalTo("tag","==","1"):2===r.filterValue[0]&&a.equalTo("tag","==","0");if(r.filterValue.includes(3)&&r.filterValue.includes(4)&&r.filterValue.includes(5));else if(r.filterValue.includes(3)&&r.filterValue.includes(5))a.equalTo("source","==","0,2");else if(r.filterValue.includes(4)&&r.filterValue.includes(5))a.equalTo("source","==","1,2");else if(3===r.filterValue[0]){let e=a.equalTo("source","==","0"),l=a.equalTo("source","==","0,2");a.or(e,l)}else if(4===r.filterValue[0]){let e=a.equalTo("source","==","1"),l=a.equalTo("source","==","1,2");a.or(e,l)}else if(5===r.filterValue[0]){let e=a.equalTo("source","==","2"),l=a.equalTo("source","==","0,2"),t=a.equalTo("source","==","1,2");a.or(e,l,t)}}a.limit(r.pageSize),a.skip(r.pageSize*(r.currentPage-1)),""!==e?a.order(...e.split(",")):a.order("-isTop","-downloadCount","-updatedAt"),a.find().then((e=>{r.total=e.count,r.searchData=e.results,r.isloading=!1})).catch((e=>{o.$message.error(e),r.isloading=!1}))},handleAddDownloadCount(e){o.$bmob.Query("Resource").get(e.objectId).then((a=>{a.downloadCount>=10&&a.set("isTop","1");let l=e.downloadCount?Number(e.downloadCount):0;a.set("downloadCount",String(l+1)),a.save(),e.downloadCount=l+1})).catch((e=>{}))},handleDelete(e){o.$bmob.Query("Resource").destroy(e.objectId).then((a=>{r.searchData.splice(r.searchData.findIndex((a=>a.objectId===e.objectId)),1);let l=e.frameImg.slice(1);C(l,(e=>{o.$message.success("删除图片成功")}),(e=>{})),C(`${e.projectId}.json`,(e=>{o.$message.success("删除文件成功")}),(e=>{}))})).catch((e=>{o.$message.error(e)}))},handleDownload(e){s.checkIsLogin()||(r.isDownload=!0,P(`${e.projectId}.json`,(a=>{r.isDownload=!1,D(a,e.projectName),c.handleAddDownloadCount(e)}),(e=>{o.$message.error(e),r.isDownload=!1})))},handleCurrentChange(e){r.currentPage=e,r.isloading=!0,r.loadingText="正在加载...",c.handleSearch()},getActivityData(){},getData(){r.isloading=!0,r.loadingText="正在加载...";const e=o.$bmob.Query("Resource");r.isDevelop||e.equalTo("isPass","==","1"),e.limit(r.pageSize),e.skip(r.pageSize*(r.currentPage-1)),r.isDevelop?e.order("isPass","-isTop","-downloadCount","-updatedAt"):e.order("-isTop","-downloadCount","-updatedAt"),e.find().then((e=>{r.total=e.count,r.searchData=e.results,r.isloading=!1})).catch((e=>{o.$message.error("资源获取失败"),r.isloading=!1}))},handleNoPass({objectId:e},a){j.prompt("请输入不通过原因","审核不通过",{confirmButtonText:"确 认",cancelButtonText:"取 消"}).then((async({value:l})=>{c.handleEditResource({objectId:e},a,"isPass",l)})).catch((e=>{}))},handleEditResource(e,a,l,t=""){const s=o.$bmob.Query("Resource");s.set("id",e.objectId),s.set(l,a),""!==t&&s.set("reason",t),s.save().then((s=>{o.$message.success("修改成功"),e[l]=a,""!==t&&(e.reason=t)})).catch((e=>{o.$message.error("修改失败"+e)}))},handleFilter(e){if(r.isloading=!0,r.loadingText="正在搜索...",r.filterValue.length<=0&&(r.filterValue=[0]),r.filterValue.length>1)if(0===r.filterValue[r.filterValue.length-1])r.filterValue=[0];else{let e=r.filterValue.findIndex((e=>0===e));e>=0&&r.filterValue.splice(e,1)}r.currentPage=1,c.handleSearch()},handleReset(){""===r.searchValue&&1===r.filterValue.length&&0===r.filterValue[0]&&1===r.currentPage&&""===r.filterOrderValue||(r.searchValue="",r.filterValue=[0],r.currentPage=1,r.total=0,r.filterOrderValue="",c.getData())},handlePreview(e){r.isloading=!0,r.loadingText="正在打开项目",o.$router.push({name:"draw",params:{projectId:"C"+e.projectId}})},handleImport(e){s.checkIsLogin()||(r.isImport=!0,P(`${e.projectId}.json`,(async a=>{let l=await w(a);l&&(l.createAt=I(),l.updateAt=l.createAt,l.projectId=T.v1(),l.tip="新项目",l.isTop=0,l.isLargeCanvas="1",s.saveProject(l).then((e=>{e&&(o.$message.success(o.$t("message.importSucceeded")+"，请在我的项目中查看"),r.isImport=!1)})).catch((e=>{o.$message.error(o.$t("message.importFailed"))}))),c.handleAddDownloadCount(e)}),(e=>{o.$message.error(e),r.isImport=!1})))}};return h((()=>{c.getData()})),f((()=>{r.isloading=!1})),m((()=>{r.searchData.length&&(r.isloading=!1)})),i((d=i(i({},b(r)),c),a(d,l({Download:v,ArrowDownBold:y}))),n);var d}});const ee={class:"full-layout scrollbar routerview flex-center"},ae=["element-loading-text"],le={class:"flex-start searchBox"},te={class:"full-layout scrollbar grid-box scrollAuto"},oe={class:"frameImg"},se=["src"],re=["onClick"],ie={class:"image-slot"},ne=["src"],ce={class:"oneline"},de={class:"info"},ue={class:"flex-between",style:{"padding-bottom":"5px"}},pe=["title"],ge={class:"project-time text-left"},he={class:"twoline project-desc"},fe={class:"flex-center",style:{padding:"10px"}},me={key:2,class:"full-layout flex-center scrollbar scrollAuto"};var be=Y(Z,[["render",function(e,a,l,t,o,s){const r=x("search"),i=x("el-icon"),n=x("el-input"),c=x("el-option"),d=x("el-select"),u=x("el-skeleton-item"),p=x("el-skeleton"),g=x("el-image"),h=x("el-tag"),f=x("el-tooltip"),m=x("el-button"),b=x("el-dropdown-item"),v=x("el-dropdown-menu"),y=x("el-dropdown"),V=(x("el-divider"),x("el-scrollbar")),C=x("SafeRender"),P=x("el-pagination"),j=x("el-empty"),k=x("PublishEditDialog"),_=x("PersonShareDialog"),D=$("loading");return S(),O("div",ee,[A((S(),O("div",{class:"full-layout flex flex-column","element-loading-text":e.loadingText,"element-loading-background":"#00000000"},[E("div",le,[q(n,{modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchValue=a),style:{width:"240px"},placeholder:"请搜索像素资源",onKeyup:z(e.search,["enter"])},{prefix:R((()=>[q(i,{class:"el-input__icon"},{default:R((()=>[q(r)])),_:1})])),_:1},8,["modelValue","onKeyup"]),q(d,{modelValue:e.filterValue,"onUpdate:modelValue":a[1]||(a[1]=a=>e.filterValue=a),placeholder:"请选择分类",onChange:e.handleFilter,class:"select","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,multiple:""},{default:R((()=>[(S(!0),O(N,null,F(e.filterOptions,(e=>(S(),B(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),q(d,{modelValue:e.filterOrderValue,"onUpdate:modelValue":a[2]||(a[2]=a=>e.filterOrderValue=a),placeholder:"请选择排序",onChange:e.handleFilterOrder,class:"select"},{default:R((()=>[(S(!0),O(N,null,F(e.orderOptions,(e=>(S(),B(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),E("button",{class:"pixelButton",onClick:a[3]||(a[3]=(...a)=>e.handleReset&&e.handleReset(...a))},"重 置")]),q(V,null,{default:R((()=>[U("",!0),e.searchData.length&&!e.isloading?(S(),O(N,{key:1},[E("div",te,[(S(!0),O(N,null,F(e.searchData,(l=>(S(),O("div",{key:l.projectId,class:"download-item"},[E("div",oe,[q(g,{src:e.getFrameImg(l.frameImg),fit:"contain",class:"image-pixelated"},{placeholder:R((()=>[q(p,{animated:"",class:"full-layout"},{template:R((()=>[q(u,{variant:"image",style:{height:"100%"}})])),_:1})])),_:2},1032,["src"]),"1"===l.isTop?(S(),O("img",{key:0,src:K||W,class:"top"},null,8,se)):U("",!0),q(h,{size:"small",type:"success",class:"size"},{default:R((()=>[L(H(l.width)+"x"+H(l.height),1)])),_:2},1024),q(h,{type:"danger",size:"small",class:"tip"},{default:R((()=>[L(H(e.getSource(l.source)),1)])),_:2},1024),E("div",{class:"author flex-start",onClick:a=>e.handleOpenUserPage(l.authorId)},[q(g,{src:e.getAuthorImg(l),fit:"cover"},{error:R((()=>[E("div",ie,[E("img",{src:G||J},null,8,ne)])])),_:2},1032,["src"]),E("p",ce,H(l.author),1)],8,re),q(f,{content:l.reason,placement:"top"},{default:R((()=>[e.isDevelop&&"2"===l.isPass?(S(),B(h,{key:0,size:"small",type:e.$config.projectStateInfo[l.isPass].type,effect:"dark",class:"state"},{default:R((()=>[L(H(e.$config.projectStateInfo[l.isPass].label),1)])),_:2},1032,["type"])):U("",!0)])),_:2},1032,["content"]),e.isDevelop&&"2"!==l.isPass?(S(),B(h,{key:1,size:"small",type:e.$config.projectStateInfo[l.isPass].type,effect:"dark",class:"state"},{default:R((()=>[L(H(e.$config.projectStateInfo[l.isPass].label),1)])),_:2},1032,["type"])):U("",!0)]),E("div",de,[E("div",ue,[E("h4",{class:"oneline project-name",title:l.projectName},H(l.projectName),9,pe),q(y,{trigger:"click",size:"small","hide-on-click":!1},{dropdown:R((()=>[q(v,null,{default:R((()=>[q(b,{onClick:a=>e.handleDownload(l),icon:"Download",disabled:e.isDownload},{default:R((()=>[L(H(e.isDownload?e.$t("message.downloadLoading"):e.$t("message.download")),1)])),_:2},1032,["onClick","disabled"]),q(b,{onClick:a=>e.handleImport(l),icon:"FolderAdd",disabled:e.isImport},{default:R((()=>[L(H(e.isImport?e.$t("message.importLoading"):e.$t("message.import")),1)])),_:2},1032,["onClick","disabled"]),q(b,{onClick:a=>e.handlePreview(l),icon:"View"},{default:R((()=>[L(H(e.$t("message.preview")),1)])),_:2},1032,["onClick"]),q(b,{onClick:a=>e.handleShare(l),icon:"Link"},{default:R((()=>a[14]||(a[14]=[L("分 享")]))),_:2,__:[14]},1032,["onClick"]),e.isDevelop?(S(),B(b,{key:0,onClick:a=>e.handleEdit(l),icon:"Edit"},{default:R((()=>a[15]||(a[15]=[L("编 辑")]))),_:2,__:[15]},1032,["onClick"])):U("",!0),e.isDevelop&&"1"!==l.isPass?(S(),B(b,{key:1,onClick:a=>e.handleEditResource(l,"1","isPass"),icon:"Check"},{default:R((()=>a[16]||(a[16]=[L("通 过")]))),_:2,__:[16]},1032,["onClick"])):U("",!0),e.isDevelop&&"2"!==l.isPass?(S(),B(b,{key:2,onClick:a=>e.handleNoPass(l,"2"),icon:"Close"},{default:R((()=>a[17]||(a[17]=[L("不通过")]))),_:2,__:[17]},1032,["onClick"])):U("",!0),e.isDevelop?(S(),B(b,{key:3,onClick:a=>e.handleDelete(l),icon:"Delete"},{default:R((()=>a[18]||(a[18]=[L("删 除")]))),_:2,__:[18]},1032,["onClick"])):U("",!0),e.isDevelop&&"3"!==l.isPass?(S(),B(b,{key:4,onClick:a=>e.handleEditResource(l,"3","isPass"),icon:"Hide"},{default:R((()=>a[19]||(a[19]=[L("隐 藏")]))),_:2,__:[19]},1032,["onClick"])):U("",!0),e.isDevelop&&"1"!==l.isTop?(S(),B(b,{key:5,onClick:a=>e.handleEditResource(l,"1","isTop"),icon:"Top"},{default:R((()=>a[20]||(a[20]=[L("置 顶")]))),_:2,__:[20]},1032,["onClick"])):U("",!0),e.isDevelop&&"0"!==l.isTop?(S(),B(b,{key:6,onClick:a=>e.handleEditResource(l,"0","isTop"),icon:"Top"},{default:R((()=>a[21]||(a[21]=[L("取消置顶")]))),_:2,__:[21]},1032,["onClick"])):U("",!0)])),_:2},1024)])),default:R((()=>[q(m,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),E("div",ge,H(l.createAt.split(" ")[0].replaceAll("/","-"))+" - 下载量: "+H(l.downloadCount?l.downloadCount>=100?"99+":l.downloadCount:"0"),1),q(f,{content:l.desc,effect:"light"},{default:R((()=>[E("div",he,[q(C,{sourceText:l.desc},null,8,["sourceText"])])])),_:2},1032,["content"])])])))),128))]),E("div",fe,[q(P,{"current-page":e.currentPage,"onUpdate:currentPage":a[4]||(a[4]=a=>e.currentPage=a),"page-size":e.pageSize,background:"",layout:"prev, pager, next","hide-on-single-page":!0,total:e.total,"pager-count":5,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):e.isloading||e.searchData.length||e.activityData.length?U("",!0):(S(),O("div",me,[q(j,{image:M||X,description:"空空如也","image-size":200},null,8,["image"])]))])),_:1}),e.PublishEditVisible?(S(),B(k,{key:0,visible:e.PublishEditVisible,editInfo:e.editProjectInfo,onSave:e.handleEditProject,onClose:a[5]||(a[5]=a=>e.PublishEditVisible=!1)},null,8,["visible","editInfo","onSave"])):U("",!0),q(_,{ref:"PersonShareDialog"},null,512)],8,ae)),[[D,e.isloading]])])}],["__scopeId","data-v-a5708706"]]);export{be as default};
