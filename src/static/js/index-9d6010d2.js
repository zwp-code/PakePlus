var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,s=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&i(e,a,l[a]);if(o)for(var a of o(l))n.call(l,a)&&i(e,a,l[a]);return e};import{d,y as u,r,o as c,ah as m,S as p,M as f,t as h,aC as g,a7 as b,aw as y,av as C,g as v,aD as x,aE as P,u as _,aF as k,aG as w,aH as S,al as $,I as B,b as V,aa as D,e as O,n as N,j as E,k as L,h as A,V as F,f as j,l as J,F as R,q as I,ap as K,p as M,x as T,s as U,W as z,v as W}from"./index-7e9c327e.js";import{u as q,w as G,r as H}from"./xlsx-eef54bab.js";import{e as Q}from"./empty-6f34f8e8.js";import{_ as X}from"./plugin-vue_export-helper-46f75680.js";var Y=d({name:"customPindou",props:{},components:{},emits:[],setup(e,o){const{proxy:t}=v(),n=u();let i=r({backRoute:null,loading:!1,list:null,myCustom:[],pindouBrand:"",customPindouKey:"",customPindouName:"",customPindouLabel:"",innerVisible:!1,name:"",color:"",editMask:-1,customData:{},isAddPindou:!1,searchValue:"",searchData:[],selectRows:[],pindouColorScheme:"",pindouColorSchemeOptions:[{num:"0",label:"黑色系"},{num:"1",label:"白色系"},{num:"2",label:"灰色系"},{num:"3",label:"棕色系"},{num:"4",label:"红色系"},{num:"5",label:"红橙色系"},{num:"6",label:"橙色系"},{num:"7",label:"橙黄色系"},{num:"8",label:"黄色系"},{num:"9",label:"黄绿色系"},{num:"10",label:"绿色系"},{num:"11",label:"蓝绿色系"},{num:"12",label:"蓝色系"},{num:"13",label:"蓝紫色系"},{num:"14",label:"紫色系"},{num:"15",label:"紫红色系"},{num:"16",label:"粉色系"}],selectedPindou:new Map}),d={handleSelect(e){i.selectedPindou.has(e)?i.selectedPindou.delete(e):i.selectedPindou.set(e,e)},handleEditPindou(e,l){i.innerVisible=!0,i.editMask=e,i.color=`#${l.color}`,i.name=l.name},handleSearchColorScheme(){let e=i.list&&i.list.data;i.loading=!0,i.searchValue="";let l=[];for(let a=0;a<e.length;a++){let o=C(e[a].color);x(P(o[0],o[1],o[2]),i.pindouColorScheme)&&l.push(e[a])}i.searchData=l,i.loading=!1},handleSearch(){if(""===i.searchValue.trim())return i.searchData=[],t.$message.warning("请输入搜索内容");i.loading=!0;let e=new RegExp(i.searchValue,"i");i.searchData=i.list&&i.list.data.filter((l=>e.test(l.name))),i.loading=!1},handleOpen(){i.loading=!0;let e=t.$utils.cache.pindou.get();e&&(i.myCustom=JSON.parse(e),""===i.pindouBrand&&(i.pindouBrand=i.myCustom[0].value,i.list=d.getList()),i.loading=!1)},getList:(e=i.pindouBrand)=>e&&""!==e&&JSON.parse(JSON.stringify(n.pindouMaps[e]))||null,saveData(){t.$utils.cache.pindou.set(JSON.stringify(i.myCustom)),n.pindouBrandOptions=JSON.parse(JSON.stringify(i.myCustom))},handleChange(e){""===i.pindouBrand?i.list=null:(i.loading=!0,d.handleReset(),i.list=d.getList(i.pindouBrand),i.loading=!1)},async handleSavePindou(e){if("edit"===e){if(""===i.customPindouLabel.trim())return t.$message.warning("请输入拼豆名称");return void(await n.editPindouData({id:i.pindouBrand,value:i.list})&&(i.myCustom.forEach((e=>{e.value===i.pindouBrand&&(e.label=i.customPindouLabel)})),d.saveData(),t.$message.success("已保存")))}if(i.customPindouKey=_.v1(),""===i.customPindouName.trim()||""===i.customPindouKey.trim())return t.$message.warning("请输入拼豆名称");if(Object.keys(n.pindouMaps).find((e=>e===i.customPindouKey)))return t.$message.warning("拼豆属性不能重复");await n.savePindouData({id:i.customPindouKey,value:{data:[],label:i.customPindouName}})&&(i.myCustom.push({label:i.customPindouName,value:i.customPindouKey}),i.pindouBrand=i.customPindouKey,i.list=d.getList(),d.saveData(),t.$message.success("已新增"),i.isAddPindou=!1,i.customPindouKey="",i.customPindouName="")},async handleDeletePindou(){var e,l;if(k.has(i.pindouBrand))return t.$message.warning("该拼豆不能删除");let a=i.myCustom.findIndex((e=>e.value===i.pindouBrand));if(a>=0){await n.deletePindouById(i.pindouBrand)&&(i.myCustom.splice(a,1),i.pindouBrand=(null==(e=i.myCustom[0])?void 0:e.value)?null==(l=i.myCustom[0])?void 0:l.value:"",i.list=d.getList(),d.saveData(),t.$message.success("已删除"),n.settingsOption.defaultPindou="mard-v2")}},handleAdd(){i.innerVisible=!0,i.editMask=-1,i.name="",i.color=""},hideDiaog(){i.innerVisible=!1},handleClose(){t.$utils.cache.customPindou.remove(),i.backRoute&&""!==i.backRoute?t.$router.back():t.$router.push("/about")},handleAddColorTemplate(){let e=t.$utils.cache.mycolor.get();if(e){let l=JSON.parse(e);n.setMyColorList(i.list);let a=i.list&&i.list.data.map((e=>({label:null==e?void 0:e.name,color:String(e.color).startsWith("#")?e.color:`#${e.color}`})));l.push({id:_.v1(),groupName:i.list.label,list:a}),t.$utils.cache.mycolor.set(JSON.stringify(l)),n.setMyColorList(l),t.$message.success("添加成功")}},handleReset(){i.selectedPindou.size>0&&i.selectedPindou.clear(),i.searchValue="",i.searchData=[],i.pindouColorScheme=""},handleEdit(){if(""===i.name)return t.$message.warning("色号不能为空");if(""===i.color)return t.$message.warning("颜色不能为空");if(!w(i.color)&&!S(i.color))return t.$message.warning("颜色不规范，请输入十六进制的颜色值");if(i.editMask>=0)i.list&&(i.list.data[i.editMask]={name:i.name,color:i.color.slice(1,7).toLowerCase()});else{if(i.list&&i.list.data.find((e=>e.name===i.name)))return t.$message.warning("色号不能重复");i.list.data.push({name:i.name,color:i.color.slice(1,7).toLowerCase()})}n.editPindouData({id:i.pindouBrand,value:i.list}).then((e=>{t.$message.success("已保存"),d.hideDiaog()})).catch((e=>{t.$message.error("保存失败")}))},handleDelete(e){let l=i.list&&i.list.data.findIndex((l=>l.name===e.name));l>=0&&i.list.data.splice(l,1),n.editPindouData({id:i.pindouBrand,value:i.list}).then((e=>{t.$message.success("已删除")})).catch((e=>{t.$message.error("删除失败")}))},handleBatchDelete(){if(!i.selectedPindou.size)return t.$message.warning("请先选择拼豆色号");Array.from(i.selectedPindou.keys()).forEach((e=>{let l=i.list&&i.list.data.findIndex((l=>l.name===i.selectedPindou.get(e)));l>=0&&i.list.data.splice(l,1)})),n.editPindouData({id:i.pindouBrand,value:i.list}).then((e=>{i.selectedPindou.clear(),t.$message.success("已删除")})).catch((e=>{t.$message.error("删除失败")}))},exportFile(e=!1){if(!e&&n.checkVipFunction("customPindouExport"))return;let l=e?"拼豆色卡模板":`${i.pindouBrand}-${i.customPindouLabel}`;const a=q.book_new(),o=q.json_to_sheet(e?[{name:"A1",color:"000000"}]:i.list?i.list.data:[]);q.book_append_sheet(a,o,"Sheet1"),G(a,`${l}.xlsx`)},exportJSONFile(){if(n.checkVipFunction("customPindouExport"))return;const e=JSON.stringify(i.list?i.list.data:[]),l=new Blob([e],{type:""});$.saveAs(l,`${i.pindouBrand}-${i.customPindouLabel}.json`)},importExcelFile(){if(n.checkVipFunction("customPindouImport"))return;const e=document.createElement("input");e.type="file",e.accept=".xls,.xlsx",e.addEventListener("change",(function(){const l=e.files[0];if(l){const e=new FileReader;e.onload=function(e){const l=new Uint8Array(e.target.result),a=H(l,{type:"array",cellStyles:!0});let o=[];a.SheetNames.forEach((function(e){const l=a.Sheets[e],t=q.sheet_to_json(l);o=o.concat(t)})),d.openInfo(o)},e.readAsArrayBuffer(l)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)},importJSONFile(){if(n.checkVipFunction("customPindouImport"))return;const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const l=e.files[0];if(l){const e=new FileReader;e.onload=function(e){const l=JSON.parse(e.target.result);d.openInfo(l)},e.readAsText(l)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)},openInfo(e){B.confirm("是否覆盖已有数据?","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{i.list?i.list.data=e:i.list={data:e,label:i.pindouBrand},n.editPindouData({id:i.pindouBrand,value:i.list,label:i.customPindouLabel}).then((e=>{t.$message.success("已覆盖")})).catch((e=>{t.$message.error("保存失败")}))})).catch((()=>{}))},handleInput(e){i.customPindouKey=i.customPindouKey.replace(/[\u4E00-\u9FA5]/g,"")}};return c((()=>{i.backRoute=t.$router.options.history.state.back,t.$utils.cache.customPindou.set("1")})),m((()=>{d.handleOpen()})),p((()=>i.pindouBrand),((e,l)=>{if(e){let l=i.myCustom.find((l=>l.value===e));i.customPindouLabel=l?l.label:""}else i.customPindouLabel="",i.pindouBrand=""})),p((()=>i.customPindouLabel),((e,l)=>{i.list&&(i.list.label=e)})),f((()=>{t.$utils.cache.customPindou.remove()})),V=s(s({},h(i)),d),l(V,a({editSpaceStore:n,InfoFilled:g,copyText:b,extractRgbaToString:y,hexToRgba:C}));var V}});const Z={class:"full-layout"},ee={class:"header-box"},le={class:"flex-center",style:{gap:"20px"}},ae={class:"flex flex-column","element-loading-background":"#00000000",style:{height:"calc(100% - 55px)"}},oe={class:"flex-start flex-warp searchBox"},te={class:"item full-w flex-start flex-warp"},ne={class:"flex-column-start"},ie={class:"flex-end"},se={class:"item flex-start full-w flex-warp"},de={class:"item flex-start full-w flex-warp"},ue={class:"item full-w flex-start flex-warp"},re={key:0,class:"full-layout scrollbar grid-box scrollAuto"},ce=["onClick"],me=["onClick"],pe={class:"color-meta flex-column-start",style:{gap:"10px"}},fe={style:{"font-size":"15px"},class:"full-w flex-between"},he={class:"flex-end",style:{gap:"10px"}},ge={style:{"font-size":"12px"}},be={key:1,class:"full-layout flex-center scrollbar scrollAuto"},ye={class:"flex-between",style:{"margin-top":"10px"}},Ce={class:"dialog-footer"};var ve=X(Y,[["render",function(e,l,a,o,t,n){var i;const s=V("Close"),d=V("el-icon"),u=V("el-tooltip"),r=V("el-option"),c=V("el-button"),m=V("el-input"),p=V("el-select"),f=V("el-popconfirm"),h=V("el-dropdown-item"),g=V("el-dropdown-menu"),b=V("el-dropdown"),y=V("search"),C=V("Edit"),v=V("Delete"),x=V("el-empty"),P=V("el-color-picker"),_=V("el-dialog"),k=D("loading");return O(),N("div",Z,[E("div",ee,[l[15]||(l[15]=E("h2",{class:"title"},"自定义拼豆",-1)),E("div",le,[L(u,{content:"关 闭",placement:"bottom"},{default:A((()=>[L(d,{size:20,class:"pointer icon",onClick:e.handleClose},{default:A((()=>[L(s)])),_:1},8,["onClick"])])),_:1})])]),F((O(),N("div",ae,[E("div",oe,[E("div",te,[L(p,{modelValue:e.pindouBrand,"onUpdate:modelValue":l[4]||(l[4]=l=>e.pindouBrand=l),placeholder:"请选择",style:{flex:"1"},onChange:e.handleChange},{footer:A((()=>[e.isAddPindou?(O(),N(R,{key:1},[E("div",ne,[L(m,{modelValue:e.customPindouName,"onUpdate:modelValue":l[1]||(l[1]=l=>e.customPindouName=l),class:"option-input",placeholder:"请输入拼豆名称",maxlength:"15"},null,8,["modelValue"])]),E("div",ie,[L(c,{onClick:l[2]||(l[2]=l=>{e.customPindouKey="",e.customPindouName="",e.isAddPindou=!1})},{default:A((()=>l[17]||(l[17]=[J("取消")]))),_:1,__:[17]}),L(c,{type:"primary",onClick:l[3]||(l[3]=l=>e.handleSavePindou("save"))},{default:A((()=>l[18]||(l[18]=[J("保存")]))),_:1,__:[18]})])],64)):(O(),j(c,{key:0,text:"",bg:"",onClick:l[0]||(l[0]=l=>e.isAddPindou=!0)},{default:A((()=>l[16]||(l[16]=[J(" 新建拼豆色卡 ")]))),_:1,__:[16]}))])),default:A((()=>[(O(!0),N(R,null,I(e.myCustom,(e=>(O(),j(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),L(m,{modelValue:e.customPindouLabel,"onUpdate:modelValue":l[5]||(l[5]=l=>e.customPindouLabel=l),placeholder:"请输入拼豆名称",style:{flex:"1"},disabled:""===e.pindouBrand},null,8,["modelValue","disabled"])]),E("div",se,[L(c,{type:"primary",onClick:l[6]||(l[6]=l=>e.handleSavePindou("edit")),disabled:""===e.pindouBrand},{default:A((()=>l[19]||(l[19]=[J("保存拼豆")]))),_:1,__:[19]},8,["disabled"]),L(f,{title:"确定删除该拼豆?",onConfirm:e.handleDeletePindou},{reference:A((()=>[L(c,{type:"danger",disabled:""===e.pindouBrand},{default:A((()=>l[20]||(l[20]=[J("删除拼豆")]))),_:1,__:[20]},8,["disabled"])])),_:1},8,["onConfirm"]),L(b,{trigger:"click",style:{flex:"1"}},{dropdown:A((()=>[L(g,null,{default:A((()=>[L(h,{onClick:l[7]||(l[7]=l=>e.exportFile(!0))},{default:A((()=>l[22]||(l[22]=[J("下载空模板")]))),_:1,__:[22]}),L(h,{onClick:e.importExcelFile},{default:A((()=>l[23]||(l[23]=[J("导入为Excel")]))),_:1,__:[23]},8,["onClick"]),L(h,{onClick:l[8]||(l[8]=l=>e.exportFile(!1))},{default:A((()=>l[24]||(l[24]=[J("导出为Excel")]))),_:1,__:[24]}),L(h,{onClick:e.importJSONFile},{default:A((()=>l[25]||(l[25]=[J("导入为JSON")]))),_:1,__:[25]},8,["onClick"]),L(h,{onClick:e.exportJSONFile},{default:A((()=>l[26]||(l[26]=[J("导出为JSON")]))),_:1,__:[26]},8,["onClick"])])),_:1})])),default:A((()=>[L(c,{type:"warning",disabled:""===e.pindouBrand},{default:A((()=>l[21]||(l[21]=[J("导入/导出拼豆")]))),_:1,__:[21]},8,["disabled"])])),_:1}),L(c,{type:"success",onClick:e.handleAddColorTemplate,disabled:""===e.pindouBrand},{default:A((()=>l[27]||(l[27]=[J("添加到我的调色板")]))),_:1,__:[27]},8,["onClick","disabled"])]),E("div",de,[L(m,{modelValue:e.searchValue,"onUpdate:modelValue":l[9]||(l[9]=l=>e.searchValue=l),style:{flex:"1"},placeholder:"搜索色号",clearable:"",onKeyup:K(e.handleSearch,["enter"]),disabled:""===e.pindouBrand},{prefix:A((()=>[L(d,{class:"el-input__icon"},{default:A((()=>[L(y)])),_:1})])),_:1},8,["modelValue","onKeyup","disabled"]),L(p,{modelValue:e.pindouColorScheme,"onUpdate:modelValue":l[10]||(l[10]=l=>e.pindouColorScheme=l),placeholder:"请选择色系",style:{flex:"1"},onChange:e.handleSearchColorScheme,clearable:""},{default:A((()=>[(O(!0),N(R,null,I(e.pindouColorSchemeOptions,(e=>(O(),j(r,{key:e.num,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),E("div",ue,[L(c,{type:"primary",onClick:e.handleReset,disabled:""===e.pindouBrand},{default:A((()=>l[28]||(l[28]=[J("重置列表")]))),_:1,__:[28]},8,["onClick","disabled"]),L(c,{type:"danger",onClick:e.handleBatchDelete,disabled:""===e.pindouBrand,style:{"margin-left":"0"}},{default:A((()=>l[29]||(l[29]=[J("批量删除")]))),_:1,__:[29]},8,["onClick","disabled"]),L(c,{type:"success",onClick:e.handleAdd,disabled:""===e.pindouBrand,style:{"margin-left":"0"}},{default:A((()=>l[30]||(l[30]=[J("新增色号")]))),_:1,__:[30]},8,["onClick","disabled"])])]),(e.list||(null==(i=e.list)?void 0:i.data)||e.searchData.length)&&!e.loading?(O(),N("div",re,[(O(!0),N(R,null,I(e.searchData.length?e.searchData:e.list?e.list.data||e.list:[],((a,o)=>(O(),N("div",{key:a.name,class:U(["color-item",{active:e.selectedPindou.has(a.name)}]),onClick:l=>e.handleSelect(a.name)},[E("div",{style:W({backgroundColor:`#${a.color}`}),class:"color-preview"},[E("div",{class:"color-name",onClick:z((l=>e.copyText(`#${a.color}`)),["stop"])},T(a.name),9,me)],4),E("div",pe,[E("div",fe,[E("span",null,T(`#${a.color}`.toUpperCase()),1),E("div",he,[L(d,{onClick:z((l=>e.handleEditPindou(o,a)),["stop"])},{default:A((()=>[L(C)])),_:2},1032,["onClick"]),L(f,{title:"确定删除该色号?",onConfirm:l=>e.handleDelete(a)},{reference:A((()=>[L(d,{onClick:l[11]||(l[11]=z((()=>{}),["stop"]))},{default:A((()=>[L(v)])),_:1})])),_:2},1032,["onConfirm"])])]),E("span",ge,T(e.extractRgbaToString(e.hexToRgba(a.color))),1)])],10,ce)))),128))])):e.loading||e.searchData.length&&e.list?M("",!0):(O(),N("div",be,[L(x,{image:Q,description:"空空如也","image-size":200},null,8,["image"])]))])),[[k,e.loading]]),L(_,{modelValue:e.innerVisible,"onUpdate:modelValue":l[14]||(l[14]=l=>e.innerVisible=l),width:"300",title:e.editMask>=0?"修改":"添加","append-to-body":"",class:"z-dialog"},{footer:A((()=>[E("div",Ce,[L(c,{onClick:e.hideDiaog},{default:A((()=>[J(T(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),L(c,{type:"primary",onClick:e.handleEdit},{default:A((()=>[J(T(e.$t("message.save")),1)])),_:1},8,["onClick"])])])),default:A((()=>[E("div",ye,[L(m,{modelValue:e.name,"onUpdate:modelValue":l[12]||(l[12]=l=>e.name=l),placeholder:"请输入",style:{width:"200px"}},null,8,["modelValue"]),L(P,{modelValue:e.color,"onUpdate:modelValue":l[13]||(l[13]=l=>e.color=l)},null,8,["modelValue"])])])),_:1},8,["modelValue","title"])])}],["__scopeId","data-v-240554bc"]]);export{ve as default};
