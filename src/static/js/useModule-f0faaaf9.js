var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,d=(e,o)=>{for(var t in o||(o={}))s.call(o,t)&&n(e,t,o[t]);if(r)for(var t of r(o))a.call(o,t)&&n(e,t,o[t]);return e};import{A as i,r as c,aB as l,c as p,aD as m,g as u,aJ as b,aC as g,C as w,u as h}from"./index-6a0d579b.js";import{g as I}from"./grid-33bc5412.js";import{b as j}from"./boy-09783d30.js";function $(){const{proxy:e}=u(),r=i(),s=c({isDownload:!1,isImport:!1,isPreview:!1,ArrowDownBold:l,PublishEditVisible:!1,editProjectInfo:null}),a={getFrameImg:p((()=>o=>o&&""!==o?`${e.$config.HUAWEI_OBS_CONFIG.HOST}${o}`:I)),getAuthorImg:p((()=>o=>"/"===o[0]?`${e.$config.HUAWEI_OBS_CONFIG.HOST}${o}`:o.startsWith("http")?o:j))},n={handleEdit(e){s.editProjectInfo=JSON.parse(JSON.stringify(e)),s.PublishEditVisible=!0},handleAddDownloadCount(o){e.$bmob.Query("Resource").get(o.objectId).then((e=>{e.downloadCount>=10&&e.set("isTop","1");let t=o.downloadCount?Number(o.downloadCount):0;e.set("downloadCount",String(t+1)),e.save(),o.downloadCount=t+1})).catch((e=>{}))},handleDownload(o){r.checkIsLogin()||(s.isDownload=!0,m(`${o.projectId}.json`,(e=>{b(e,o.projectName),s.isDownload=!1,n.handleAddDownloadCount(o)}),(o=>{e.$message.error(o),s.isDownload=!1})))},handlePreview(o){s.isPreview=!0,e.$router.push({name:"draw",params:{projectId:"C"+o.projectId}})},handleEditResource(o,t,r,s=""){const a=e.$bmob.Query("Resource");a.set("id",o.objectId),a.set(r,t),""!==s&&a.set("reason",s),a.save().then((a=>{e.$message.success("编辑成功"),o[r]=t,""!==s&&(o.reason=s)})).catch((o=>{e.$message.error("编辑失败"+o)}))},handleImport(o){r.checkIsLogin()||(s.isImport=!0,m(`${o.projectId}.json`,(async t=>{let a=await g(t);a&&(a.createAt=w(),a.updateAt=a.createAt,a.projectId=h.v1(),a.tip="新项目",a.isTop=0,a.isLargeCanvas="1",r.saveProject(a).then((o=>{o&&(e.$message.success(e.$t("message.importSucceeded")+"，请在我的项目中查看"),s.isImport=!1)})).catch((o=>{e.$message.error(e.$t("message.importFailed"))}))),n.handleAddDownloadCount(o)}),(o=>{e.$message.error(o),s.isImport=!1})))}};return d(($=d({},n),o($,t({data:s}))),a);var $}export{$ as u};
