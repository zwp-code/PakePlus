var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,o=(e,t)=>{for(var l in t||(t={}))c.call(t,l)&&s(e,l,t[l]);if(a)for(var l of a(t))r.call(t,l)&&s(e,l,t[l]);return e},i=(e,a)=>t(e,l(a));import{d as n,y as d,r as p,R as g,o as f,t as m,aj as h,i as u,P as j,Q as y,a as x,I as _,aI as P,g as k,b as w,aa as L,e as v,n as C,V as I,j as b,k as S,h as D,l as B,Y as O,ap as $,x as A,F as R,q as N,p as T,s as V,f as z,W as F}from"./index-7e9c327e.js";import{g as J,_ as E}from"./grid-429fa51c.js";import{e as H}from"./empty-6f34f8e8.js";import{_ as W}from"./plugin-vue_export-helper-46f75680.js";var K=n({name:"recycle",components:{},props:{},emits:[],setup(e,t){const{proxy:l}=k(),a=d();let c=p({isloading:!0,searchValue:"",searchData:[],loadingText:"正在加载...",selectedProject:new Map,count:0,scrollHeight:0,isShowNoticeTag:!0,projectList:[],recycleList:[]});const r={getFrameImg:x((()=>e=>e.data?""!==e.data[0].currentFrameImg&&null!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:"/"===e.frameImg[0]?`${l.$config.HUAWEI_OBS_CONFIG.HOST}${e.frameImg}`:J:J))};let s={handleBatchCommand(e){"1"===e?s.handleBatchDeleteProject():"2"===e&&s.handleBatchRecoverProject()},handleClearAll(){s.handleAllSelect(),s.handleBatchDeleteProject()},handleReset(){if(c.selectedProject.size>0)return c.selectedProject.clear();c.searchData.length=0,c.searchValue=""},handleSelectProject(e){c.selectedProject.has(e.projectId)?c.selectedProject.delete(e.projectId):c.selectedProject.set(e.projectId,e)},handleAllSelect(){let e=c.searchData.length?c.searchData:c.projectList;for(let t=0;t<e.length;t++)c.selectedProject.set(e[t].data.projectId,e[t].data)},handleBatchDeleteProject(){var e;if(0===c.selectedProject.size)return l.$message.warning("请选择项目后删除");let t=Array.from(c.selectedProject.keys()),r=!1;for(let l=0;l<t.length;l++)if(null==(e=c.selectedProject.get(t[l]))?void 0:e.isBackup){r=!0;break}if(r)return l.$message.warning("选中项目存在已备份项目，无法执行批量删除");_.confirm("是否永久删除选中的项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{let e=[];Array.from(c.selectedProject.keys()).forEach((async t=>{let l=c.recycleList.findIndex((e=>e===c.selectedProject.get(t).projectId));c.recycleList.splice(l,1);let r=await a.deleteProjectById(c.selectedProject.get(t).projectId,!1);e.push(r)})),P.recycleList.set(JSON.stringify(c.recycleList)),Promise.all(e).then((e=>{c.selectedProject.clear(),l.$message.success("删除成功"),s.getRecycleProject()})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleBatchRecoverProject(){if(0===c.selectedProject.size)return l.$message.warning("请选择项目后删除");let e=Array.from(c.selectedProject.keys());for(let t=0;t<e.length;t++){let l=e[t],a=c.recycleList.findIndex((e=>e===c.selectedProject.get(l).projectId));c.recycleList.splice(a,1);let r=c.projectList.findIndex((e=>e===c.selectedProject.get(l).projectId));c.projectList.splice(r,1)}P.recycleList.set(JSON.stringify(c.recycleList)),a.updateProjectTip(a.originProjectList).then((e=>{a.projectList=e,l.$message.success("项目恢复成功"),c.selectedProject.clear()}))},getRecycleProject(){c.isloading=!0,c.loadingText="正在加载...";let e=P.recycleList.get()?JSON.parse(P.recycleList.get()):[];if(c.recycleList=e,e.length){let t=e.map((e=>a.originProjectList.find((t=>t.id===e)))).filter((e=>void 0!==e));a.handleProjectFrameDecompress(t).then((e=>{c.projectList=e,c.isloading=!1}))}else c.projectList=[],c.isloading=!1},handleSearch(){if(""===c.searchValue.trim())return l.$message.warning("请输入搜索内容");let e=new RegExp(c.searchValue,"i");return c.searchData=c.projectList.filter((t=>e.test(t.data.projectName))),c.searchData.length?void 0:l.$message.warning("搜索不到该项目")},handleRecoverProject:e=>new Promise(((t,r)=>{let s=c.recycleList.findIndex((t=>t===e));c.recycleList.splice(s,1),P.recycleList.set(JSON.stringify(c.recycleList));let o=c.projectList.findIndex((t=>t===e));c.projectList.splice(o,1),a.updateProjectTip(a.originProjectList).then((e=>{a.projectList=e,l.$message.success("项目恢复成功"),t(!0)}))})),handleDeleteProject(e){let{projectId:t,isBackup:r,projectName:s}=e;_.confirm("是否永久删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{let e=c.recycleList.findIndex((e=>e===t));c.recycleList.splice(e,1),P.recycleList.set(JSON.stringify(c.recycleList)),a.deleteProjectById(t,!1).then((e=>{if(e){l.$message.success("删除成功");let e=c.projectList.findIndex((e=>e===t));c.projectList.splice(e,1)}})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))}};return g((()=>{""===c.searchValue.trim()&&(c.searchData=[])})),f((()=>{s.getRecycleProject()})),i(o(i(o(o({},m(c)),s),{editSpaceStore:a,ArrowDownBold:h}),r),{isMobile:u,isSafari:j,isSupportPaintWorklet:y})}});const M={class:"full-layout flex-center routerview scrollHidden"},U=["element-loading-text"],q={style:{padding:"10px 20px",gap:"10px"},class:"flex-start flex-warp"},G={class:"flex-between flex-warp",style:{padding:"0px 20px 10px","row-gap":"10px"}},Q={class:"title flex-start flex-warp",style:{gap:"15px"}},Y={class:"folder-back-icon pointer"},X={class:"flex-end"},Z={key:0,class:"flex-start flex-warp",style:{gap:"10px",padding:"0px 20px 10px"}},ee={key:1,class:"flex-start flex-warp",style:{gap:"10px",padding:"0px 20px 10px"}},te=["onClick"],le=["onDblclick"],ae=["src"],ce={class:"image-slot full-h"},re=["src"],se={class:"info"},oe={class:"flex-between",style:{"padding-bottom":"5px"}},ie=["title"],ne={class:"project-time text-left"},de={class:"twoline project-desc"},pe={key:3,class:"full-layout flex-center scrollbar scrollAuto"};var ge=W(K,[["render",function(e,t,l,a,c,r){const s=w("InfoFilled"),o=w("el-icon"),i=w("el-tag"),n=w("ArrowLeft"),d=w("search"),p=w("el-input"),g=w("px-button"),f=w("arrow-down"),m=w("px-dropdown-item"),h=w("px-dropdown-menu"),u=w("px-dropdown"),j=w("el-button"),y=w("el-dropdown-item"),x=w("el-dropdown-menu"),_=w("el-dropdown"),P=w("el-skeleton-item"),k=w("el-skeleton"),W=w("el-image"),K=w("el-tooltip"),ge=w("el-empty"),fe=L("loading");return v(),C("div",M,[I((v(),C("div",{class:"full-layout flex flex-column","element-loading-text":e.loadingText,"element-loading-background":"#00000020"},[b("div",q,[I(S(i,{type:"warning",effect:"dark",class:"notice-tag",closable:"",onClose:t[0]||(t[0]=t=>e.isShowNoticeTag=!1)},{default:D((()=>[S(o,{size:"16"},{default:D((()=>[S(s)])),_:1}),t[5]||(t[5]=B(" 回收站内容最多保留30个项目，超过将自动覆盖 "))])),_:1},512),[[O,e.isShowNoticeTag]])]),b("div",G,[b("h2",Q,[b("div",Y,[S(o,{onClick:t[1]||(t[1]=t=>e.$router.back())},{default:D((()=>[S(n)])),_:1})]),t[6]||(t[6]=B(" 回收站 "))]),b("div",X,[S(p,{modelValue:e.searchValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.searchValue=t),clearable:"",placeholder:e.$t("message.pleaseSearchProject"),onKeyup:$(e.handleSearch,["enter"]),style:{"max-width":"150px"}},{prefix:D((()=>[S(o,{class:"el-input__icon"},{default:D((()=>[S(d)])),_:1})])),_:1},8,["modelValue","placeholder","onKeyup"])])]),e.isSupportPaintWorklet()?(v(),C("div",Z,[S(g,{round:"",type:"primary",onClick:e.handleReset},{default:D((()=>[B(A(e.$t("message.reset")),1)])),_:1},8,["onClick"]),S(g,{round:"",type:"primary",onClick:e.handleAllSelect},{default:D((()=>t[7]||(t[7]=[B("全 选")]))),_:1,__:[7]},8,["onClick"]),S(u,{trigger:"click",onCommand:e.handleBatchCommand},{dropdown:D((()=>[S(h,null,{default:D((()=>[S(m,{onClick:e.handleBatchDeleteProject,command:"1"},{default:D((()=>t[9]||(t[9]=[B("批量删除")]))),_:1,__:[9]},8,["onClick"]),S(m,{onClick:e.handleBatchRecoverProject,command:"2"},{default:D((()=>t[10]||(t[10]=[B("批量恢复")]))),_:1,__:[10]},8,["onClick"])])),_:1})])),default:D((()=>[S(g,{round:"",type:"primary"},{default:D((()=>[t[8]||(t[8]=B("批量操作 ")),S(o,{class:"el-icon--right"},{default:D((()=>[S(f)])),_:1})])),_:1,__:[8]})])),_:1},8,["onCommand"]),S(g,{round:"",type:"danger",onClick:e.handleClearAll},{default:D((()=>t[11]||(t[11]=[B("一键清空")]))),_:1,__:[11]},8,["onClick"])])):(v(),C("div",ee,[S(j,{type:"primary",onClick:e.handleReset},{default:D((()=>[B(A(e.$t("message.reset")),1)])),_:1},8,["onClick"]),S(j,{type:"primary",onClick:e.handleAllSelect},{default:D((()=>t[12]||(t[12]=[B("全 选")]))),_:1,__:[12]},8,["onClick"]),S(_,{trigger:"click"},{dropdown:D((()=>[S(x,null,{default:D((()=>[S(y,{onClick:e.handleBatchDeleteProject},{default:D((()=>t[14]||(t[14]=[B("批量删除")]))),_:1,__:[14]},8,["onClick"]),S(y,{onClick:e.handleBatchRecoverProject},{default:D((()=>t[15]||(t[15]=[B("批量恢复")]))),_:1,__:[15]},8,["onClick"])])),_:1})])),default:D((()=>[S(j,{type:"primary"},{default:D((()=>[t[13]||(t[13]=B("批量操作 ")),S(o,{class:"el-icon--right"},{default:D((()=>[S(f)])),_:1})])),_:1,__:[13]})])),_:1}),S(j,{type:"danger",onClick:e.handleClearAll},{default:D((()=>t[16]||(t[16]=[B("一键清空")]))),_:1,__:[16]},8,["onClick"])])),!e.projectList.length&&!e.searchData.length||e.isloading?e.isloading||e.searchData.length&&e.projectList.length?T("",!0):(v(),C("div",pe,[S(ge,{image:H,description:"空空如也","image-size":200},null,8,["image"])])):(v(),C("div",{key:2,class:"full-layout scrollbar scrollAuto grid-box",onScroll:t[4]||(t[4]=(...t)=>e.handleScroll&&e.handleScroll(...t)),ref:"scroll"},[(v(!0),C(R,null,N(e.searchData.length?e.searchData:e.projectList,(l=>(v(),C("div",{class:V([{active:e.selectedProject.has(l.id)},"project-item"]),onClick:t=>e.handleSelectProject(l.data),key:l.id},[b("div",{class:"frameImg flex-center",onDblclick:F((t=>e.handleOpenProject(l.data)),["stop"])},[""===l.data.frameImg?(v(),C("img",{key:0,src:J,class:"emptyImg"},null,8,ae)):(v(),z(W,{key:1,src:e.getFrameImg(l.data),fit:"contain"},{placeholder:D((()=>[S(k,{animated:"",class:"full-layout"},{template:D((()=>[S(P,{variant:"image",style:{height:"100%"}})])),_:1})])),error:D((()=>[b("div",ce,[b("img",{src:J||E},null,8,re)])])),_:2},1032,["src"])),S(i,{type:"success",class:"size",size:"small"},{default:D((()=>[B(A(l.data.width)+"x"+A(l.data.height),1)])),_:2},1024)],40,le),b("div",se,[b("div",oe,[b("h4",{class:"oneline project-name",title:l.data.projectName},A(l.data.projectName),9,ie),S(_,{trigger:"click",size:"small"},{dropdown:D((()=>[S(x,null,{default:D((()=>[S(y,{onClick:t=>e.handleRecoverProject(l.id),icon:"Refresh"},{default:D((()=>t[17]||(t[17]=[B("恢复项目")]))),_:2,__:[17]},1032,["onClick"]),S(y,{onClick:t=>e.handleDeleteProject(l.data),icon:"Delete"},{default:D((()=>t[18]||(t[18]=[B("删除项目")]))),_:2,__:[18]},1032,["onClick"])])),_:2},1024)])),default:D((()=>[S(j,{type:"primary",icon:e.ArrowDownBold,size:"small",onClick:t[3]||(t[3]=F((()=>{}),["stop"])),style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),b("div",ne,A(l.data.updateAt),1),S(K,{content:l.data.desc,effect:"light"},{default:D((()=>[b("div",de,A(l.data.desc),1)])),_:2},1032,["content"])])],10,te)))),128))],544))],8,U)),[[fe,e.isloading]])])}],["__scopeId","data-v-371263c7"]]);export{ge as default};
