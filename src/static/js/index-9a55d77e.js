var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,r=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))i.call(t,a)&&l(e,a,t[a]);return e};import{N as n}from"./NoticeDialog-5a750ff1.js";import{d as g,y as c,bu as u,r as d,o as p,t as m,aC as A,a7 as y,g as b,b as f,aa as C,V as v,e as h,n as R,j as S,k as x,h as T,f as B,F as P,q as I,p as D,s as M,l as k,x as E}from"./index-7e9c327e.js";import{u as Q}from"./useModule-7c522666.js";import{e as N}from"./empty-6f34f8e8.js";import{_ as J}from"./plugin-vue_export-helper-46f75680.js";import"./grid-429fa51c.js";import"./boy-60d2a964.js";var L=g({name:"message",props:{},components:{NoticeDialog:n},emits:[],setup(e,s){const{proxy:o}=b(),i=c(),l=Q();u(i);let n=d({myMessageList:[],loading:!0,currentPage:1,pageSize:10,totalCount:0,emptyStatus:!1,desc:"暂无消息",backRoute:null,visible:!1,messageDetail:null,messageFooter:{str:"已读",id:2,visible:!0}}),g={handleOpenMessage(e){n.visible=!0,n.messageDetail=e,n.messageDetail.isForceUpdate="0",n.messageFooter.visible=!0,"1"!==e.isRead&&"0"!==e.userId||(n.messageFooter.visible=!1)},handleReadMsg(){const e=o.$bmob.Query("Message");e.set("id",n.messageDetail.objectId),e.set("isRead","1"),e.save().then((e=>{n.messageDetail.isRead="1"})).catch((e=>{o.$message.error("网络异常")}))},handleClose(){n.backRoute&&""!==n.backRoute?o.$router.back():o.$router.push("/about")},handleCurrentChange(e){n.currentPage=e,n.loading=!0,g.getMyMessage()},getMyMessage(){if(i.isLogin&&i.userData){const e=o.$bmob.Query("Message"),t=e.equalTo("userId","==",i.userData.uid),a=e.equalTo("userId","==","0");e.or(t,a),e.limit(n.pageSize),e.skip(n.pageSize*(n.currentPage-1)),e.order("-isTop","-createdAt"),e.find().then((e=>{if(n.loading=!1,!e.results.length)return n.emptyStatus=!0,void(n.desc="暂无消息");n.myMessageList=e.results,n.totalCount=e.count,n.emptyStatus=!1})).catch((e=>{n.loading=!1,n.emptyStatus=!0,n.desc="网络异常"}))}else n.loading=!1,n.emptyStatus=!0,n.desc="未登录"}};return p((()=>{n.backRoute=o.$router.options.history.state.back,g.getMyMessage()})),r(r((f=r(r({},m(n)),g),t(f,a({editSpaceStore:i,InfoFilled:A,copyText:y}))),m(l.data)),l);var f}}),j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABRVJREFUeF7tmk1oHFUcwH9vI7EFQVERWhSLsbvbpqIUrQpSK/WDqCnJbJKDiEQPgqCIJ62gJvhBL4ofF71oe+ihSXeWUuNJUI8iHpQ2m9mtKIIfBT14yKGazF/exInJZnbnY9/MDiRzCWTfvPd+v/d/36PY5I/a5PxsCdiKgE1uIJ9doHL+TqTvOUR9xRI1zpb+SKud8idgdGEcpWb+B1bn6VMTzO6eT0NCvgRsgPeR05OQHwFt4dOVkA8BofDpSei9gMjw6UjorYDO8LPAePDAZ25M6J2AMHi7NEHHNGYk9EZAFHi/6VOWkL2AOPAZSMhWQBL4lCVkJ6Ab+BQlmBNwZGEn/WoA1x2AvpuAARTXInIR4RcUL7VZys6iB7yoj+ExIbmA8XP9uP3DCI+CDAPXRGVYky4efAqREF+A1TgI7tPAEKirE0D7rySDNywhngDLeRl4swtoM/AGJUQTUPnhdmTpbeBgbuANSQgXYNWnoPBaJHBRX6JkEWHR+4taRKlFEEHYBfTFGvAiFQrdrBg7C7B+2gGXfu1YD6Uu4DIHfEStWI9aZ+PpQmeHv+9ndt/vreWGCKhPQuGTgMr+CcyhZI5qec3pjXGseBl2kiAcpVY6Fk/AUPNytrsL4IVvy2NmMxKPMEJqy9ENErCLlJPY5cfjCdCprYUxUKeAQu4ltIUH1NJdVAe/ji9Av1FxRhC0hP7cSugELzJBrazPFzbGcYSgWklSaQ4jrpawPXcSEsJrjvBpcC1txXn4v0i4IjcSuoCPL8CLhPpDSEFHwpU9l9AlfDIB+q0x5zCuNyYEbIAymh0MwCcXoN8cqR+i4EXCdZlHgiH47gTot0ede1DoeXdHZhIMwncvwJNQvxtV0BKuT12CYXgzArzu4Byg4I0J6a0YU4A3J0DnZDX3g6sjYcB4JKQEb1bAyphwK0pmQBWNSrCcE8ATG/LssMKLusCLtxCKkmulOQgyg8heYxIs5y3g6Pr85A3s8itRqtQpjXkBoQcoCdYJlcYxRF5cB6Lkfarl5/MlIBTer25MCZbzAfBsC+xx7NKT+REQGT6BBGvhY1AtsKqKXRzLh4AweKXmuxoTRp1TKFouT9Tn2MUHei8gDB53GnXZLLJsJ54dLOdT4JGWMeBDquVneisgCry9Z8qrpDdFUk20ThhtfIGSQ+tgRT1FrRh0XhnLSfJZIA68XyVrfj/0aQnRV4yjjT0o2fiJnCzfQm3vuVi0AYmTCUgCvyrBuQNUFeSGSOuE0ca7KGmZ7uRn7PKN3cInWwl2A+/X2NtAaQkqfBdZaTQRuXl9+HOCWmkyewEm4FcleFtp3R3anye4y/sQ70R6/aMKR6juPputAJPwqxKa96JcLSH4ZAn5NmAP8B126TYT8NG7QBrwPsGIc5iCOg1yVQCUvoFqkSOvYpdfz05AmvA+xVjzQVwvEgJOm1tQl5cGOTNo7MPpsLvBkJthdxp/nu+2ScYuDOEuawkB9w5+5mZbv3MXyKLlW6VV6sNI4XTgDZS+eq8V7+vW84bxNDBDq+2tsJ98Crs0bboyXn4r13A6ElrvIg9gl74xXWZwF6g47yC80Kaw9OD9AlcuZN8Ddq78y2BXa51RgyNg4SSoxwJ+Sx/eL3Tyx238dWkSte0M9q7fTLe8n1+7CPgM0V+BrXuyg0+LNiDf9rOAdxIr/6DURcT9HnvP8QzrlVlRyTZDmVUv/YK2BKTvON8lbEVAvtsn/dr9C6K3Ul8oqip4AAAAAElFTkSuQmCC";Symbol.toStringTag;const F={class:"full-layout","element-loading-background":"#00000000"},K={class:"header-box"},O={class:"flex-center",style:{gap:"20px"}},X=["onClick"],w=["src"],U=["innerHTML"],V={class:"full-w flex-end info-time"},H={key:0,class:"flex-center full-w",style:{padding:"10px"}},Y={key:1,class:"flex-center",style:{height:"calc(100% - 55px)"}};var q=J(L,[["render",function(e,t,a,s,o,i){const l=f("Close"),r=f("el-icon"),n=f("el-tooltip"),g=f("el-pagination"),c=f("el-scrollbar"),u=f("el-empty"),d=f("NoticeDialog"),p=C("loading");return v((h(),R("div",F,[S("div",K,[t[2]||(t[2]=S("h2",{class:"title"},"我的消息",-1)),S("div",O,[x(n,{content:"关 闭",placement:"bottom"},{default:T((()=>[x(r,{size:20,class:"pointer icon",onClick:e.handleClose},{default:T((()=>[x(l)])),_:1},8,["onClick"])])),_:1})])]),e.loading||e.emptyStatus?!e.loading&&e.emptyStatus?(h(),R("div",Y,[x(u,{image:N,description:e.desc,"image-size":200},null,8,["image","description"])])):D("",!0):(h(),B(c,{key:0,style:{height:"calc(100% - 55px)"}},{default:T((()=>[(h(!0),R(P,null,I(e.myMessageList,(t=>(h(),R("div",{class:"flex-column-start info-box",key:t.objectId,onClick:a=>e.handleOpenMessage(t)},[S("h4",{class:M(["oneline pointer info-title flex-start",{isRead:"1"===t.isRead}]),style:{gap:"10px"}},["1"===t.isTop?(h(),R("img",{key:0,src:j},null,8,w)):D("",!0),k(" "+E(t.title),1)],2),S("p",{class:M(["info-content text-justify",{isRead:"1"===t.isRead}]),innerHTML:t.content},null,10,U),S("div",V," —— 最后更新时间："+E(t.createAt)+" —— ",1)],8,X)))),128)),e.loading||e.emptyStatus?D("",!0):(h(),R("div",H,[x(g,{"current-page":e.currentPage,"onUpdate:currentPage":t[0]||(t[0]=t=>e.currentPage=t),"page-size":e.pageSize,background:"",layout:"total, prev, pager, next",total:e.totalCount,"pager-count":3,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])]))])),_:1})),e.visible?(h(),B(d,{key:2,visible:e.visible,notice:e.messageDetail,footerBtn:e.messageFooter,onClose:t[1]||(t[1]=t=>e.visible=!1),onReadMsg:e.handleReadMsg},null,8,["visible","notice","footerBtn","onReadMsg"])):D("",!0)])),[[p,e.loading]])}],["__scopeId","data-v-2c0feb4b"]]);export{q as default};
