var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e},n=(e,t)=>a(e,l(t));import{d,y as c,z as u,r as p,o as m,t as g,b as f,aa as h,e as v,f as b,h as y,V as w,n as P,k,j as C,x,v as A,g as S,A as U,ag as D,ae as _,ac as j,af as I,a5 as E,l as O,F as N,q as R,p as V,a as $,s as B,as as M,bu as T,S as z,aC as Q,a7 as F,a4 as G,a8 as J}from"./index-7e9c327e.js";import{_ as Y}from"./plugin-vue_export-helper-46f75680.js";import{v as H,g as K}from"./validator-16ef0ed0.js";import{P as q,a as L}from"./PersonShareDialog-858eaa85.js";import{u as X}from"./useModule-7c522666.js";import{p as Z}from"./pro-5bf8b402.js";import{b as W}from"./boy-60d2a964.js";import{h as ee,_ as ae}from"./hot-15b909cf.js";import{e as le,_ as te}from"./empty-6f34f8e8.js";import"./useDB-d1ce478c.js";import"./grid-429fa51c.js";const se=d({name:"AvatarUpload",components:{},props:{defaultAvatar:{type:String,default:""},isAuto:{type:Boolean,default:!1},height:{type:Number,default:80},width:{type:Number,default:80},type:{type:Number,default:0},borderRadius:{type:Number,default:50},desc:{type:String,default:"上传头像"}},emits:[],setup(e,a){const l=c();let{proxy:t}=S();const s=u();let o=p({uploadUrl:"",avatarUrl:"",headers:{"X-API-Key":t.$config.PICGO_KEY},fileType:["image/jpeg","image/jpg","image/png","image/svg+xml"],isSelected:!1,uploadBeforeFile:null,deletePosterUrl:"",isUploading:!1}),i={handleBmobPublish(e){let a=U();const s=t.$bmob.Query("User");s.set("id",l.userData.objectId),s.set("avatarUpdatedAt",a),s.set("avatar",e),s.save().then((async s=>{o.isUploading=!1,t.$message.success("上传成功"),o.avatarUrl=`${t.$config.HUAWEI_OBS_CONFIG.HOST}${e}?time=${(new Date).getTime()}`,l.userData.avatar=e+`?time=${(new Date).getTime()}`,l.userData.avatarUpdatedAt=a,l.saveUserInfo(l.userData)})).catch((a=>{o.isUploading=!1,i.handleDeleteAvatar(e),t.$message.error("上传失败")}))},handleDeleteAvatar(e){let a=e.slice(1);D(a,(e=>{}),(e=>{}))},handleExceed(e,a){s.value.clearFiles();const l=e[0];l.uid=_(),s.value.handleStart(l)},handleProgress(){o.isUploading=!0},handleAvatarChange(a,l){e.isAuto||(o.isUploading=!0,i.beforeAvatarUpload(a.raw)?i.handleUploadToOBS(a):o.isUploading=!1)},handleUploadToOBS(e){let a=j(e.name),s=`${l.userData.uid}.${a}`;I(e.raw,s,(e=>{i.handleBmobPublish("/"+s)}),(e=>{o.isUploading=!1,t.$message.error(e)}),(e=>{}))},handleAvatarSuccess(e,a){o.avatarUrl=e.image.url,o.deletePosterUrl=e.image.delete_url,i.handleBmobPublish("1")},handleAvatarError(e,a){o.isUploading=!1,t.$message.error("上传头像失败")},beforeAvatarUpload(e){let a=0;return l.userData.avatarUpdatedAt&&""!==l.userData.avatarUpdatedAt&&(a=E(l.userData.avatarUpdatedAt)),(new Date).getTime()-a<6048e5?(t.$message.warning("七天内只能更新一次头像喔！"),!1):["image/png"].includes(e.type)?!(e.size/1024/1024>t.$config.MAX_UPLOAD_SIZE)||(t.$message.warning("上传图片大小不能超过500kb！"),!1):(t.$message.warning("上传图片格式不正确！"),!1)}};return m((async()=>{""!==e.defaultAvatar&&e.defaultAvatar.startsWith("/")&&!e.defaultAvatar.includes("assets")?o.avatarUrl=`${t.$config.HUAWEI_OBS_CONFIG.HOST}${e.defaultAvatar}`:o.avatarUrl=e.defaultAvatar})),n(r(r({},g(o)),i),{uploadRef:s})}}),oe={class:"tip"},ie={class:"tip"};var re=Y(se,[["render",function(e,a,l,t,s,o){const i=f("el-skeleton-item"),r=f("el-skeleton"),n=f("el-image"),d=f("Plus"),c=f("el-icon"),u=f("el-upload"),p=h("loading");return v(),b(u,{ref:"uploadRef",class:"avatar-uploader",style:A({height:e.height+"px"}),action:e.uploadUrl,name:"source",method:"post","show-file-list":!1,limit:1,accept:".png",headers:e.headers,"auto-upload":e.isAuto,"on-change":e.handleAvatarChange,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-error":e.handleAvatarError,"on-exceed":e.handleExceed,"on-progress":e.handleProgress},{default:y((()=>[""!==e.avatarUrl?w((v(),P("div",{key:0,class:"avatar flex-center",style:A({height:e.height+"px",width:e.width+"px",borderRadius:e.borderRadius+"%"})},[k(n,{src:e.avatarUrl,fit:"cover"},{placeholder:y((()=>[k(r,{animated:"",class:"full-layout"},{template:y((()=>[k(i,{variant:"image",style:{height:"100%"}})])),_:1})])),_:1},8,["src"]),C("div",oe,x(e.desc),1)],4)),[[p,e.isUploading]]):(v(),P("div",{key:1,class:"avatar flex-center",style:A({height:e.height+"px",width:e.width+"px",borderRadius:e.borderRadius+"%"})},[k(c,{size:20,color:"#808080"},{default:y((()=>[k(d)])),_:1}),C("div",ie,x(e.desc),1)],4))])),_:1},8,["style","action","headers","auto-upload","on-change","on-success","before-upload","on-error","on-exceed","on-progress"])}],["__scopeId","data-v-ea576606"]]);const ne=d({name:"EditPasswordDialog",components:{},props:{visible:{type:Boolean,default:!1}},emits:["close","update"],setup(e,a){const l=u(),{proxy:t}=S(),s=c();let o=p({form:{oldPassword:"",newPassword:""},loading:!1,rules:{oldPassword:[{required:!0,trigger:"change",validator:(e,a,t)=>{H.validatePwd1(e,a,t,o.form.newPassword,l)}}],newPassword:[{required:!0,trigger:"change",validator:(e,a,l)=>{H.validatePwd2(e,a,l,o.form.oldPassword)}}]},dialogVisible:e.visible}),i={handleClose(){o.dialogVisible=!1,a.emit("close")},handleReset(e){const l=t.$bmob.Query("User");l.set("id",e),l.set("password",t.$utils.secret.MD5(o.form.newPassword)),l.save().then((e=>{o.loading=!1,t.$message.success("修改成功，请重新登录"),a.emit("update"),i.handleClose(),setTimeout((()=>{s.deleteUserInfo()}),1e3)})).catch((e=>{o.loading=!1,t.$message.error("修改失败")}))},async handleConfirm(e){e&&e.validate((e=>{if(!e)return!1;{o.loading=!0;const e=t.$bmob.Query("User");e.equalTo("username","==",s.userData.username),e.equalTo("password","==",t.$utils.secret.MD5(o.form.oldPassword)),e.select("isEnable"),e.limit(1),e.find().then((e=>(o.loading=!1,e.results.length?e.results.length&&e.results[0].isEnable&&"0"===e.results[0].isEnable?t.$message.warning("账号已被禁用"):void i.handleReset(e.results[0].objectId):t.$message.warning("用户不存在")))).catch((e=>{o.loading=!1,t.$message.error("修改失败")}))}}))}};return n(r(r({},g(o)),i),{ruleFormRef:l})}}),de={class:"dialog-footer"};var ce=Y(ne,[["render",function(e,a,l,t,s,o){const i=f("el-input"),r=f("el-form-item"),n=f("el-form"),d=f("el-button"),c=f("el-dialog");return v(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=a=>e.dialogVisible=a),title:"修改密码","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[C("span",de,[k(d,{onClick:e.handleClose},{default:y((()=>a[4]||(a[4]=[O("取 消")]))),_:1,__:[4]},8,["onClick"]),k(d,{type:"primary",onClick:a[2]||(a[2]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>a[5]||(a[5]=[O("确 定")]))),_:1,__:[5]},8,["loading"])])])),default:y((()=>[k(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[k(r,{label:"旧密码",prop:"oldPassword"},{default:y((()=>[k(i,{type:"password",modelValue:e.form.oldPassword,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.oldPassword=a),"show-password":"",placeholder:"请输入旧密码",clearable:""},null,8,["modelValue"])])),_:1}),k(r,{label:"新密码",prop:"newPassword"},{default:y((()=>[k(i,{type:"password","show-password":"",modelValue:e.form.newPassword,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.newPassword=a),placeholder:"请输入新密码",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"])}]]);const ue=d({name:"EditPasswordDialog",components:{},props:{visible:{type:Boolean,default:!1}},emits:["close","update"],setup(e,a){const l=u(),{proxy:t}=S(),s=c();let o=p({form:{newNickname:s.userData.nickname},loading:!1,rules:{newNickname:[{required:!0,trigger:"change",validator:(e,a,l)=>{H.validateFormNickname(a,l)}}]},dialogVisible:e.visible}),i={handleClose(){o.dialogVisible=!1,a.emit("close")},async handleConfirm(e){e&&e.validate((e=>{if(!e)return!1;{let e=0;if(s.userData.nameUpdatedAt&&""!==s.userData.nameUpdatedAt&&(e=E(s.userData.nameUpdatedAt)),(new Date).getTime()-e<6048e5)return void t.$message.warning("七天内只能更新一次昵称喔！");o.loading=!0;let l=U();const r=t.$bmob.Query("User");r.set("id",s.userData.objectId),r.set("nameUpdatedAt",l),r.set("nickname",o.form.newNickname),r.save().then((e=>{o.loading=!1,t.$message.success("修改成功"),s.userData.nickname=o.form.newNickname,s.userData.nameUpdatedAt=l,s.saveUserInfo(s.userData),a.emit("update"),i.handleClose()})).catch((e=>{o.loading=!1,t.$message.error("修改失败")}))}}))}};return n(r(r({},g(o)),i),{ruleFormRef:l})}}),pe={class:"dialog-footer"};var me=Y(ue,[["render",function(e,a,l,t,s,o){const i=f("el-input"),r=f("el-form-item"),n=f("el-form"),d=f("el-button"),c=f("el-dialog");return v(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogVisible=a),title:"修改昵称","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[C("span",pe,[k(d,{onClick:e.handleClose},{default:y((()=>a[3]||(a[3]=[O("取 消")]))),_:1,__:[3]},8,["onClick"]),k(d,{type:"primary",onClick:a[1]||(a[1]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>a[4]||(a[4]=[O("确 定")]))),_:1,__:[4]},8,["loading"])])])),default:y((()=>[k(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[k(r,{label:"新昵称",prop:"newNickname"},{default:y((()=>[k(i,{modelValue:e.form.newNickname,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.newNickname=a),placeholder:"请输入新昵称",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"])}]]);const ge=d({name:"CustomHomePageDialog",components:{},props:{visible:{type:Boolean,default:!1},editData:{type:Object,default:null}},emits:["close","update"],setup(e,a){const l=u(),{proxy:t}=S(),s=c();let o=p({form:{url:"",id:"0"},loading:!1,rules:{url:[{required:!0,trigger:"change",validator:(e,a,l)=>{H.validateUrl(a,l)}}]},dialogVisible:e.visible});const i=$((()=>e=>new URL(`/svg/${e}.svg`,window.location.href).href));let d={handleClose(){o.dialogVisible=!1,a.emit("close")},async handleConfirm(l){l&&l.validate((l=>{var i;if(!l)return!1;{o.loading=!0;let l=JSON.parse(JSON.stringify(JSON.parse((null==(i=s.userData)?void 0:i.homePage)||[])));if(l.findIndex((e=>e.id===o.form.id))>=0)return o.loading=!1,t.$message.warning("已存在该主页");if(e.editData){let e=l.findIndex((e=>e.id===o.form.id));e>=0&&l.splice(e,1,o.form)}else l.push(o.form);let r={homePage:JSON.stringify(l)};s.updateUserInfo(t,r,(()=>{t.$message.success("保存成功"),o.loading=!1,a.emit("update"),d.handleClose()}),(()=>{t.$message.error("保存失败"),o.loading=!1}))}}))}};return m((()=>{e.editData&&(o.form=JSON.parse(JSON.stringify(e.editData)))})),n(r(r({},g(o)),d),{ruleFormRef:l,getIcon:i})}}),fe={key:0},he={class:"page-box flex-warp flex-center"},ve=["onClick"],be=["src"],ye={class:"dialog-footer"};var we=d({name:"user",props:{},components:{AvatarUpload:re,EditPasswordDialog:ce,EditNickNameDialog:me,PersonShareDialog:q,PublishEditDialog:L,CustomHomePageDialog:Y(ge,[["render",function(e,a,l,t,s,o){const i=f("el-input"),r=f("el-form-item"),n=f("el-form"),d=f("el-button"),c=f("el-dialog");return v(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogVisible=a),title:"自定义主页","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[C("span",ye,[k(d,{onClick:e.handleClose},{default:y((()=>a[4]||(a[4]=[O("取 消")]))),_:1,__:[4]},8,["onClick"]),k(d,{type:"primary",onClick:a[1]||(a[1]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>a[5]||(a[5]=[O("确 定")]))),_:1,__:[5]},8,["loading"])])])),default:y((()=>[k(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[k(r,{label:"链接",prop:"url"},{default:y((()=>[k(i,{modelValue:e.form.url,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.url=a),placeholder:"请输入链接地址",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),e.editData?V("",!0):(v(),P("div",fe,[a[3]||(a[3]=C("p",null,"主页选择",-1)),C("div",he,[(v(!0),P(N,null,R(e.$config.homePageList,((a,l)=>(v(),P("div",{class:B(["page-icon flex-column-center pointer",{active:l==e.form.id}]),key:a.name,onClick:a=>e.form.id=String(l)},[C("img",{src:e.getIcon(l),style:A({backgroundColor:a.color})},null,12,be),C("span",null,x(a.label),1)],10,ve)))),128))])]))])),_:1},8,["modelValue","before-close"])}],["__scopeId","data-v-778efd6f"]]),SafeRender:{props:{sourceText:{type:String,required:!0}},render(){if(""===this.sourceText||!this.sourceText)return"";const e=this.sourceText.split("@");if(1===e.length)return this.sourceText;const a=e[1];if(1===a.split("[").length)return this.sourceText;const l=a.split("[")[0].trim(),t=a.split("[")[1].split("]")[0],s=a.split("[")[1].split("]")[1];return l&&t?M("div",[e[0],M("a",{href:t,target:"_blank"},"@"+l),s]):this.sourceText}}},emits:[],setup(e,a){const{proxy:l}=S(),t=c(),s=X();T(t);let o=p({visible:!1,visible1:!1,visible2:!1,visible3:!1,isloading:!0,myPublishProject:[],loading:!0,isSelf:!0,currentPage:1,pageSize:10,totalCount:0,userData:null,emptyStatus:!1,desc:"未登录",backRoute:null,shareUrl:"",homePageEditData:null,filterOrder:"-updatedAt"});const i=$((()=>e=>e?"1"===e?Z:"data:image/png;base64,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":"")),d=$((()=>e=>new URL(`/svg/${e}.svg`,window.location.href).href)),u=$((()=>e=>J.homePageList[e].color)),f=$((()=>e=>{if(""===e||!e)return l.$config.projectSource[0];let a=e.split(","),t="";for(let s=0;s<a.length;s++)s+1===a.length&&a.length>=2&&(t+="/"),t+=l.$config.projectSource[a[s]];return t}));let h={handleFilterCommand(e){o.filterOrder=e,o.loading=!0,h.getMyPublishProject()},handleEditProject(e){o.myPublishProject.forEach((a=>{a.projectId===e.projectId&&(a.desc=e.desc,a.isPass="0",a.author=e.author,a.projectName=e.projectName,a.tag=e.tag)}))},handleClose(){o.backRoute&&""!==o.backRoute?l.$router.back():l.$router.push("/about")},handleShare({projectId:e}){let a=G()+"draw/C"+e;l.$refs.PersonShareDialog.handleOpen("作品分享",a)},handleShareLink(){o.shareUrl=location.href,l.$refs.PersonShareDialog.handleOpen("主页分享",o.shareUrl)},handleLogOut(){t.deleteUserInfo(),o.userData=null,o.myPublishProject=[],o.emptyStatus=!0,o.desc="未登录",l.$router.replace("/user")},CheckUserSex:e=>"0"===e,CheckAvatar:e=>e.avatar&&""!==e.avatar?e.avatar.startsWith("http")?e.avatar:`${l.$config.HUAWEI_OBS_CONFIG.HOST}${e.avatar}`:"0"==e.sex?W:K,handleCurrentChange(e){o.currentPage=e,o.loading=!0,h.getMyPublishProject()},getMyPublishProject(){o.loading=!0;const e=l.$bmob.Query("Resource");o.isSelf&&t.isLogin?(e.equalTo("authorId","==",t.userData.username),e.limit(o.pageSize),e.skip(o.pageSize*(o.currentPage-1)),e.order(...o.filterOrder.split(",")),e.find().then((e=>{o.totalCount=e.count,o.myPublishProject=e.results,o.loading=!1})).catch((e=>{l.$message.error("获取作品数据失败"),o.loading=!1}))):(e.equalTo("authorId","==",l.$route.params.username),e.equalTo("isPass","==","1"),e.limit(o.pageSize),e.skip(o.pageSize*(o.currentPage-1)),e.order(...o.filterOrder.split(",")),e.find().then((e=>{o.totalCount=e.count,o.myPublishProject=e.results,o.loading=!1})).catch((e=>{l.$message.error("获取作品数据失败"),o.loading=!1})))},handleUpdateUserData(){o.userData=JSON.parse(JSON.stringify(t.userData))},checkUsername(){if(!l.$route.params.username||t.isLogin&&l.$route.params.username===t.userData.username)return o.isSelf=!0,t.isLogin?(o.emptyStatus=!1,o.userData=JSON.parse(JSON.stringify(t.userData)),o.isloading=!1,void h.getMyPublishProject()):(o.isloading=!1,void(o.emptyStatus=!0));o.isSelf=!1;const e=l.$bmob.Query("User");e.limit(1),e.equalTo("username","==",l.$route.params.username),e.select("username","avatar","sex","rank","nickname","vip"),e.find().then((e=>{e.results.length?(o.userData=JSON.parse(JSON.stringify(e.results[0])),o.emptyStatus=!1,h.getMyPublishProject()):(o.desc="用户不存在",o.emptyStatus=!0),o.isloading=!1})).catch((e=>{o.isloading=!1,o.desc="加载失败",o.emptyStatus=!0}))},handleOpenUrl(e){window.open(e,"_blank")},handleDeleteHomePage(e){var a;let s=JSON.parse(JSON.stringify(JSON.parse((null==(a=t.userData)?void 0:a.homePage)||[]))),o=s.findIndex((a=>a.id===e));if(o>=0){s.splice(o,1);let e={homePage:JSON.stringify(s)};t.updateUserInfo(l,e,(()=>{l.$message.success("删除成功"),h.handleUpdateUserData()}),(()=>l.$message.error("删除失败")))}}};return m((()=>{o.backRoute=l.$router.options.history.state.back})),z((()=>l.$route.params.username),((e,a)=>{h.checkUsername()})),z((()=>t.isCheckUser),((e,a)=>{e&&h.checkUsername()}),{immediate:!0}),z((()=>t.isLogin),((e,a)=>{e&&h.checkUsername()})),n(r(r(n(r(r({},g(o)),h),{editSpaceStore:t,InfoFilled:Q,copyText:F}),g(s.data)),s),{getUserVip:i,getIcon:d,getIconColor:u,getSource:f})}});const Pe={class:"full-layout","element-loading-background":"#00000000"},ke={class:"header-box"},Ce={class:"flex-center",style:{gap:"20px"}},xe={class:"flex-between info-box flex-warp"},Ae={class:"flex-start flex-warp",style:{gap:"15px"}},Se={key:1,class:"scrollHidden box-shadow flex-center",style:{height:"100px",width:"100px",borderRadius:"50%"}},Ue={class:"flex-column-start info-text"},De={class:"flex-between info-name"},_e={key:1,class:"flex-center"},je=["src"],Ie={class:"flex-center"},Ee={class:"flex-start",style:{gap:"10px","margin-top":"10px"}},Oe=["onClick"],Ne=["src"],Re={key:0},Ve={key:1,class:"flex-between info-box flex-warp"},$e={class:"flex-start flex-warp",style:{gap:"15px"}},Be={class:"info-icon flex-center"},Me={style:{margin:"30px 15px 10px"}},Te={class:"flex-between",style:{margin:"0 20px"}},ze={style:{padding:"15px 0"}},Qe={class:"grid-box scrollAuto scrollbar"},Fe={class:"frameImg"},Ge=["src"],Je={class:"info"},Ye={class:"flex-between",style:{"padding-bottom":"5px"}},He=["title"],Ke={class:"project-time text-left"},qe={class:"twoline project-desc"},Le={class:"flex-center full-w",style:{padding:"10px"}},Xe={key:1,class:"flex-center"},Ze={key:2,class:"flex-center"},We={key:1,class:"flex-center",style:{height:"calc(100% - 55px)"}};var ea=Y(we,[["render",function(e,a,l,t,s,o){const i=f("Promotion"),r=f("el-icon"),n=f("el-tooltip"),d=f("Close"),c=f("el-tag"),u=f("AvatarUpload"),p=f("el-skeleton-item"),m=f("el-skeleton"),g=f("el-image"),S=f("Male"),U=f("Female"),D=f("el-dropdown-item"),_=f("el-dropdown-menu"),j=f("el-dropdown"),I=f("Plus"),E=f("el-button"),$=f("el-popconfirm"),B=f("Lock"),M=f("Filter"),T=f("SafeRender"),z=f("el-pagination"),Q=f("el-empty"),F=f("el-scrollbar"),G=f("EditPasswordDialog"),J=f("EditNickNameDialog"),Y=f("CustomHomePageDialog"),H=f("PersonShareDialog"),K=f("PublishEditDialog"),q=h("loading");return w((v(),P("div",Pe,[C("div",ke,[a[9]||(a[9]=C("h2",{class:"title"},"个人主页",-1)),C("div",Ce,[k(n,{content:"分享主页",placement:"bottom"},{default:y((()=>[e.isSelf&&e.userData?(v(),b(r,{key:0,size:20,class:"pointer icon",onClick:e.handleShareLink},{default:y((()=>[k(i)])),_:1},8,["onClick"])):V("",!0)])),_:1}),k(n,{content:"关 闭",placement:"bottom"},{default:y((()=>[k(r,{size:20,class:"pointer icon",onClick:e.handleClose},{default:y((()=>[k(d)])),_:1},8,["onClick"])])),_:1})])]),e.isloading||e.emptyStatus||!e.userData?e.isloading||!e.emptyStatus||e.userData?V("",!0):(v(),P("div",We,[k(Q,{image:le,description:e.desc,"image-size":200},null,8,["image","description"])])):(v(),b(F,{key:0,style:{height:"calc(100% - 55px)"}},{default:y((()=>{var l,t;return[e.isSelf?(v(),b(c,{key:0,type:"warning",style:{margin:"20px 20px 0"},effect:"dark",class:"notice-tag"},{default:y((()=>a[10]||(a[10]=[O("须知：每个用户七天内只能修改一次昵称和头像喔")]))),_:1,__:[10]})):V("",!0),C("div",xe,[C("div",Ae,[C("div",null,[e.isSelf?(v(),b(u,{key:0,height:100,width:100,type:0,isAuto:!1,defaultAvatar:e.CheckAvatar(e.userData)},null,8,["defaultAvatar"])):(v(),P("div",Se,[k(g,{src:e.CheckAvatar(e.userData),fit:"cover",class:"full-layout"},{placeholder:y((()=>[k(m,{animated:"",class:"full-layout"},{template:y((()=>[k(p,{variant:"image",style:{height:"100%"}})])),_:1})])),_:1},8,["src"])]))]),C("div",Ue,[C("div",De,[e.isSelf?(v(),P("span",{key:0,class:"flex-center pointer",onClick:a[0]||(a[0]=a=>e.visible1=!0)},x(e.userData.nickname),1)):(v(),P("span",_e,x(e.userData.nickname),1)),e.CheckUserSex(e.userData.sex)?(v(),b(r,{key:2,size:20,color:"#0052d9"},{default:y((()=>[k(S)])),_:1})):(v(),b(r,{key:3,size:20,color:"#d760b7"},{default:y((()=>[k(U)])),_:1})),(null==(l=e.userData)?void 0:l.vip)>0?(v(),P("img",{key:4,src:e.getUserVip(null==(t=e.userData)?void 0:t.vip),class:"vip"},null,8,je)):V("",!0)]),C("p",Ie,"像素号："+x(e.userData.username),1),e.userData.rank?(v(),b(c,{key:0,type:"success"},{default:y((()=>[O("像素格子第"+x(e.userData.rank)+"位用户",1)])),_:1})):V("",!0),C("div",Ee,[e.userData.homePage?(v(!0),P(N,{key:0},R(JSON.parse(e.userData.homePage),(l=>(v(),b(j,{key:l.id},{dropdown:y((()=>[k(_,null,{default:y((()=>[k(D,{onClick:a=>{e.visible3=!0,e.homePageEditData=l}},{default:y((()=>a[11]||(a[11]=[O("编 辑")]))),_:2,__:[11]},1032,["onClick"]),k(D,{onClick:a=>e.handleDeleteHomePage(l.id)},{default:y((()=>a[12]||(a[12]=[O("删 除")]))),_:2,__:[12]},1032,["onClick"])])),_:2},1024)])),default:y((()=>[C("div",{class:"pointer flex-center pageIcon",onClick:a=>e.handleOpenUrl(l.url)},[C("img",{src:e.getIcon(l.id),style:A({backgroundColor:e.getIconColor(l.id)})},null,12,Ne)],8,Oe)])),_:2},1024)))),128)):V("",!0),e.isSelf?(v(),P("div",{key:1,class:"pointer flex-center pageIcon",onClick:a[1]||(a[1]=a=>{e.visible3=!0,e.homePageEditData=null})},[k(r,null,{default:y((()=>[k(I)])),_:1})])):V("",!0)])])]),e.isSelf?(v(),P("div",Re,[k($,{width:160,"confirm-button-text":"确认","cancel-button-text":"取消",icon:e.InfoFilled,"confirm-button-type":"primary",title:"是否退出登录？",onConfirm:e.handleLogOut},{reference:y((()=>[k(E,{type:"primary"},{default:y((()=>a[13]||(a[13]=[O("退出登录")]))),_:1,__:[13]})])),_:1},8,["icon","onConfirm"])])):V("",!0)]),e.isSelf&&!e.userData.platform||e.isSelf&&"0"===e.userData.platform?(v(),P("div",Ve,[C("div",$e,[C("div",Be,[k(r,{size:25,color:"#0052d9"},{default:y((()=>[k(B)])),_:1})]),a[14]||(a[14]=C("div",{class:"info-line"},null,-1)),a[15]||(a[15]=C("div",{class:"flex-column-start info-text"},[C("h5",null,"登录密码"),C("p",null,"管理登录密码")],-1)),a[16]||(a[16]=C("div",{class:"flex-column-start info-text"},[C("p",null," 设置安全性高的密码可以使您的账号更安全。建议您定期更换密码 "),C("p",null," 设置包含大小写字母，数字且不能使用特殊字符，同时长度6 ~ 16位的密码 ")],-1))]),C("div",null,[k(E,{type:"primary",onClick:a[2]||(a[2]=a=>e.visible=!0)},{default:y((()=>a[17]||(a[17]=[O("修改密码")]))),_:1,__:[17]})])])):V("",!0),C("div",Me,[C("div",Te,[a[21]||(a[21]=C("h2",{class:"title"},"作品集",-1)),C("div",null,[k(j,{onCommand:e.handleFilterCommand,"max-height":200},{dropdown:y((()=>[k(_,null,{default:y((()=>[k(D,{command:"-isTop,-downloadCount"},{default:y((()=>a[18]||(a[18]=[O("按热度排序")]))),_:1,__:[18]}),k(D,{command:"-updatedAt"},{default:y((()=>a[19]||(a[19]=[O("按更新时间排序")]))),_:1,__:[19]}),k(D,{command:"-createdAt"},{default:y((()=>a[20]||(a[20]=[O("按发布时间排序")]))),_:1,__:[20]})])),_:1})])),default:y((()=>[k(r,{size:"20",class:"pointer iconHover"},{default:y((()=>[k(M)])),_:1})])),_:1},8,["onCommand"])])]),C("div",ze,[e.myPublishProject.length&&!e.loading?(v(),P(N,{key:0},[C("div",Qe,[(v(!0),P(N,null,R(e.myPublishProject,(l=>(v(),P("div",{key:l.projectId,class:"download-item"},[C("div",Fe,[k(g,{src:e.getFrameImg(l.frameImg),fit:"contain",class:"image-pixelated"},{placeholder:y((()=>[k(m,{animated:"",class:"full-layout"},{template:y((()=>[k(p,{variant:"image",style:{height:"100%"}})])),_:1})])),_:2},1032,["src"]),"1"===l.isTop?(v(),P("img",{key:0,src:ee||ae,class:"top"},null,8,Ge)):V("",!0),k(c,{size:"small",type:"success",class:"size"},{default:y((()=>[O(x(l.width)+"x"+x(l.height),1)])),_:2},1024),k(c,{type:"danger",class:"tip",size:"small"},{default:y((()=>[O(x(e.getSource(l.source)),1)])),_:2},1024),k(n,{content:l.reason,placement:"top"},{default:y((()=>[e.isSelf&&"2"===l.isPass?(v(),b(c,{key:0,size:"small",type:e.$config.projectStateInfo[l.isPass].type,class:"state"},{default:y((()=>[O(x(e.$config.projectStateInfo[l.isPass].label),1)])),_:2},1032,["type"])):V("",!0)])),_:2},1032,["content"]),e.isSelf&&"2"!==l.isPass?(v(),b(c,{key:1,size:"small",type:e.$config.projectStateInfo[l.isPass].type,class:"state"},{default:y((()=>[O(x(e.$config.projectStateInfo[l.isPass].label),1)])),_:2},1032,["type"])):V("",!0)]),C("div",Je,[C("div",Ye,[C("h4",{class:"oneline project-name",title:l.projectName},x(l.projectName),9,He),k(j,{trigger:"click",size:"small","hide-on-click":!1},{dropdown:y((()=>[k(_,null,{default:y((()=>["1"!==l.isPass||l.activityCode&&"0"!==l.activityCode?V("",!0):(v(),b(D,{key:0,onClick:a=>e.handleDownload(l),icon:"Download",disabled:e.isDownload},{default:y((()=>[O(x(e.isDownload?e.$t("message.downloadLoading"):e.$t("message.download")),1)])),_:2},1032,["onClick","disabled"])),"1"!==l.isPass||l.activityCode&&"0"!==l.activityCode?V("",!0):(v(),b(D,{key:1,onClick:a=>e.handleImport(l),icon:"FolderAdd",disabled:e.isImport},{default:y((()=>[O(x(e.isImport?e.$t("message.importLoading"):e.$t("message.import")),1)])),_:2},1032,["onClick","disabled"])),"1"!==l.isPass||l.activityCode&&"0"!==l.activityCode?V("",!0):(v(),b(D,{key:2,onClick:a=>e.handlePreview(l),icon:"View",disabled:e.isPreview},{default:y((()=>[O(x(e.isPreview?e.$t("message.previewLoading"):e.$t("message.preview")),1)])),_:2},1032,["onClick","disabled"])),e.isSelf?(v(),b(D,{key:3,onClick:a=>e.handleEdit(l),icon:"Edit"},{default:y((()=>a[22]||(a[22]=[O("编 辑")]))),_:2,__:[22]},1032,["onClick"])):V("",!0),e.isSelf?(v(),b(D,{key:4,onClick:a=>e.handleShare(l),icon:"Link"},{default:y((()=>a[23]||(a[23]=[O("分 享")]))),_:2,__:[23]},1032,["onClick"])):V("",!0),!e.isSelf||"1"!==l.isPass||l.activityCode&&"0"!==l.activityCode?V("",!0):(v(),b(D,{key:5,onClick:a=>e.handleEditResource(l,"3","isPass"),icon:"Hide"},{default:y((()=>[O(x("3"===l.isPass?"取消隐藏":"隐 藏"),1)])),_:2},1032,["onClick"]))])),_:2},1024)])),default:y((()=>[k(E,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),C("div",Ke,x(l.createAt.split(" ")[0].replaceAll("/","-"))+" - 下载量: "+x(l.downloadCount?l.downloadCount>=100?"99+":l.downloadCount:"0"),1),k(n,{content:l.desc,effect:"light"},{default:y((()=>[C("div",qe,[k(T,{sourceText:l.desc},null,8,["sourceText"])])])),_:2},1032,["content"])])])))),128))]),C("div",Le,[k(z,{"current-page":e.currentPage,"onUpdate:currentPage":a[3]||(a[3]=a=>e.currentPage=a),"page-size":e.pageSize,background:"",layout:"prev, pager, next",total:e.totalCount,"pager-count":5,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):e.loading||e.myPublishProject.length?e.loading?(v(),P("div",Ze,a[24]||(a[24]=[C("div",{class:"loading-spinner-1"},null,-1)]))):V("",!0):(v(),P("div",Xe,[k(Q,{image:le||te,description:"空空如也","image-size":200},null,8,["image"])]))])])]})),_:1})),e.visible?(v(),b(G,{key:2,visible:e.visible,onClose:a[4]||(a[4]=a=>e.visible=!1),onUpdate:a[5]||(a[5]=a=>{e.userData=null,e.emptyStatus=!0})},null,8,["visible"])):V("",!0),e.visible1?(v(),b(J,{key:3,visible:e.visible1,onClose:a[6]||(a[6]=a=>e.visible1=!1),onUpdate:e.handleUpdateUserData},null,8,["visible","onUpdate"])):V("",!0),e.visible3?(v(),b(Y,{key:4,visible:e.visible3,onClose:a[7]||(a[7]=a=>e.visible3=!1),editData:e.homePageEditData,onUpdate:e.handleUpdateUserData},null,8,["visible","editData","onUpdate"])):V("",!0),k(H,{ref:"PersonShareDialog"},null,512),e.PublishEditVisible?(v(),b(K,{key:5,visible:e.PublishEditVisible,editInfo:e.editProjectInfo,onSave:e.handleEditProject,onClose:a[8]||(a[8]=a=>e.PublishEditVisible=!1)},null,8,["visible","editInfo","onSave"])):V("",!0)])),[[q,e.isloading]])}],["__scopeId","data-v-2fa9445d"]]);export{ea as default};
