var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,d=(e,o)=>{for(var t in o||(o={}))a.call(o,t)&&n(e,t,o[t]);if(r)for(var t of r(o))s.call(o,t)&&n(e,t,o[t]);return e};import{y as i,r as c,aj as l,a as p,an as m,g as u,au as g,am as b,A as w,u as h}from"./index-7e9c327e.js";import{g as j}from"./grid-429fa51c.js";import{b as I}from"./boy-60d2a964.js";function $(){const{proxy:e}=u(),r=i(),a=c({isDownload:!1,isImport:!1,isPreview:!1,ArrowDownBold:l,PublishEditVisible:!1,editProjectInfo:null}),s={getFrameImg:p((()=>o=>o&&""!==o?`${e.$config.HUAWEI_OBS_CONFIG.HOST}${o}`:j)),getAuthorImg:p((()=>o=>"/"===o[0]?`${e.$config.HUAWEI_OBS_CONFIG.HOST}${o}`:o.startsWith("http")?o:I))},n={handleEdit(e){a.editProjectInfo=JSON.parse(JSON.stringify(e)),a.PublishEditVisible=!0},handleAddDownloadCount(o){e.$bmob.Query("Resource").get(o.objectId).then((e=>{e.downloadCount>=10&&e.set("isTop","1");let t=o.downloadCount?Number(o.downloadCount):0;e.set("downloadCount",String(t+1)),e.save(),o.downloadCount=t+1})).catch((e=>{}))},handleDownload(o){r.checkIsLogin()||(a.isDownload=!0,m(`${o.projectId}.json`,(e=>{g(e,o.projectName),a.isDownload=!1,n.handleAddDownloadCount(o)}),(o=>{e.$message.error(o),a.isDownload=!1})))},handlePreview(o){a.isPreview=!0,e.$router.push({name:"draw",params:{projectId:"C"+o.projectId}})},handleEditResource(o,t,r,a=""){const s=e.$bmob.Query("Resource");s.set("id",o.objectId),s.set(r,t),""!==a&&s.set("reason",a),s.save().then((s=>{e.$message.success("编辑成功"),o[r]=t,""!==a&&(o.reason=a)})).catch((o=>{e.$message.error("编辑失败"+o)}))},handleImport(o){r.checkIsLogin()||(a.isImport=!0,m(`${o.projectId}.json`,(async t=>{let s=await b(t);s&&(s.createAt=w(),s.updateAt=s.createAt,s.projectId=h.v1(),s.tip="新项目",s.isTop=0,s.isLargeCanvas="1",r.saveProject(s).then((o=>{o&&(e.$message.success(e.$t("message.importSucceeded")+"，请在我的项目中查看"),a.isImport=!1)})).catch((o=>{e.$message.error(e.$t("message.importFailed"))}))),n.handleAddDownloadCount(o)}),(o=>{e.$message.error(o),a.isImport=!1})))}};return d(($=d({},n),o($,t({data:a}))),s);var $}export{$ as u};
