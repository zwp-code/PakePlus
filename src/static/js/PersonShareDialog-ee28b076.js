var e=Object.defineProperty,o=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(o,l,a)=>l in o?e(o,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[l]=a,i=(e,o)=>{for(var l in o||(o={}))t.call(o,l)&&r(e,l,o[l]);if(a)for(var l of a(o))s.call(o,l)&&r(e,l,o[l]);return e},n=(e,a)=>o(e,l(a));import{_ as d,d as c,A as p,B as u,r as m,o as g,t as f,b as h,f as b,h as j,g as O,au as v,as as y,av as C,aw as P,e as U,j as x,n as _,z as V,v as w,l as q,k as $,F as I,x as D,y as k,ay as B,a8 as E}from"./index-6a0d579b.js";import{u as S}from"./useDB-ae0c91ac.js";const T=c({name:"PublishEditDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,o){const l=p(),a=u();S();let{proxy:t}=O(),s=m({uploadUrl:"/api/1/upload",dialogVisible:e.visible,projectOptions:{isPass:"0",author:"",authorAvatar:"",projectName:"",projectId:"",desc:"-",width:"32",height:"32",frameImg:"",isTop:"0",tip:"",tag:"0",authorId:"",authorUid:""},imageTypes:["image/jpeg","image/jpg","image/png","image/gif"],fileList:[],fileHeader:{"X-API-Key":t.$config.PICGO_KEY},poster:"",isloading:!1,deletePosterUrl:"",progressValue:0,posterFile:null}),r={handleChangeProjectTag(e){"1"===s.projectOptions.tag&&(s.projectOptions.tip="动画")},handleBeforeUploadPoster:e=>s.imageTypes.includes(e.type)?!(e.size/1024/1024>t.$config.MAX_UPLOAD_SIZE)||(t.$message.warning("上传图片封面大小不能超过500kb！"),!1):(t.$message.warning("上传图片封面格式不正确！"),!1),handleErrorUploadPoster(e,o){t.$message.error("上传封面失败"),s.isloading=!1},handleSuccessUploadPoster(e,o){},handleExceedUploadPoster(e,o){a.value.clearFiles();const l=e[0];l.uid=v(),a.value.handleStart(l)},handleChangeUploadPoster(e,o){s.poster=URL.createObjectURL(e.raw),s.posterFile=e},handleUploadPosterToOBS(e){let o=y(e.name),l=`${s.projectOptions.projectId}.${o}`;C(e.raw,l,(e=>{r.handleBmobPublish("/"+l)}),(e=>{s.isloading=!1,t.$message.error(e)}),(e=>{}))},handleBmobPublish(e){const a=t.$bmob.Query("Resource");a.set("id",s.projectOptions.objectId),a.set("author",l.userData.nickname),a.set("projectName",s.projectOptions.projectName),a.set("tag",s.projectOptions.tag),a.set("desc",s.projectOptions.desc.trim()),s.projectOptions.source.sort(((e,o)=>e-o)),a.set("source",s.projectOptions.source.join(",")),""!==e&&a.set("frameImg",e),a.set("isPass","0"),a.save().then((e=>{s.isloading=!1,t.$message.success("编辑成功，已提交审核"),o.emit("save",s.projectOptions),r.handleClose()})).catch((o=>{e&&r.handleDeletePoster(e),s.isloading=!1,t.$message.error("编辑失败")}))},handleDeletePoster(e){let o=e.slice(1);P(o,(e=>{s.isloading=!1}),(e=>{s.isloading=!1}))},handleClose(){s.dialogVisible=!1,o.emit("close")},handleConfirm(){t.$refs.form.validate((e=>{if(e){if(""===s.poster)return t.$message.warning("请上传封面");if("1"===s.projectOptions.activityCode){if("0"===s.projectOptions.source)return t.$message.warning("请确保项目是原创作品！");if(Number(s.projectOptions.width)>100||Number(s.projectOptions.height)>100)return t.$message.warning("请确保项目画布尺寸小于100");if(""===s.projectOptions.tip)return t.$message.warning("请填写联系方式");if(""===s.projectOptions.desc)return t.$message.warning("请填写项目描述")}s.isloading=!0,s.posterFile?r.handleBeforeUploadPoster(s.posterFile.raw)?r.handleUploadPosterToOBS(s.posterFile):s.isloading=!1:r.handleBmobPublish("")}else t.$message.warning("请填写参数")}))}};return g((()=>{e.editInfo&&(s.projectOptions=e.editInfo,s.projectOptions.source?s.projectOptions.source=e.editInfo.source.split(","):s.projectOptions.source=["0"],s.poster=`${t.$config.HUAWEI_OBS_CONFIG.HOST}${s.projectOptions.frameImg}`)})),n(i(i({},f(s)),r),{uploadRef:a})}}),R=e=>(D("data-v-b490ef6c"),e=e(),k(),e),N=R((()=>x("div",{class:"el-upload__text"},[V(" 拖拽文件到这 或者 "),x("em",null,"点击这里上传")],-1))),F={key:1,class:"poster flex-center"},L=["src"],z={key:0,class:"el-upload__tip"},A=R((()=>x("p",{style:{"line-height":"1.5","font-size":"12px","margin-top":"5px"},class:"text-grey"},"注：如需艾特原创作者可通过 @原创作者名称[原创作者链接地址] 标明",-1))),H={class:"dialog-footer"};var Q=d(T,[["render",function(e,o,l,a,t,s){const r=h("upload-filled"),i=h("el-icon"),n=h("el-upload"),d=h("el-input"),c=h("el-form-item"),p=h("el-option"),u=h("el-select"),m=h("el-form"),g=h("el-button"),f=h("el-dialog");return U(),b(f,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[6]||(o[6]=o=>e.dialogVisible=o),title:e.editInfo?"编辑项目":"发布项目",width:400,"before-close":e.handleClose,"lock-scroll":!1,"close-on-click-modal":!1,class:"z-dialog",center:""},{footer:j((()=>[x("span",H,[_(g,{onClick:e.handleClose},{default:j((()=>[V(w(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),_(g,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:j((()=>[V(w(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:j((()=>[_(n,{ref:"uploadRef",class:"flex-column-center",drag:"",action:e.uploadUrl,"auto-upload":!1,"show-file-list":!1,accept:".png,.jpg,.jpeg,.gif",name:"source",limit:1,method:"post",headers:e.fileHeader,"file-list":e.fileList,"onUpdate:file-list":o[0]||(o[0]=o=>e.fileList=o),"on-success":e.handleSuccessUploadPoster,"before-upload":e.handleBeforeUploadPoster,"on-error":e.handleErrorUploadPoster,"on-exceed":e.handleExceedUploadPoster,"on-change":e.handleChangeUploadPoster,disabled:"1"===e.projectOptions.activityCode},{tip:j((()=>["0"===e.projectOptions.activityCode?(U(),q("div",z," 上传小于500KB的jpg/png/gif文件作为封面 ")):$("v-if",!0)])),default:j((()=>[""===e.poster?(U(),q(I,{key:0},[_(i,{class:"el-icon--upload"},{default:j((()=>[_(r)])),_:1}),N],64)):(U(),q("div",F,[x("img",{src:e.poster,style:{"object-fit":"contain"}},null,8,L)]))])),_:1},8,["action","headers","file-list","on-success","before-upload","on-error","on-exceed","on-change","disabled"]),_(m,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,class:"scrollbar scrollY",style:{"margin-top":"10px","max-height":"300px",padding:"0 10px"},model:e.projectOptions},{default:j((()=>[_(c,{label:"项目名称",required:"",prop:"projectName"},{default:j((()=>[_(d,{modelValue:e.projectOptions.projectName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.projectOptions.projectName=o),clearable:"",placeholder:"请输入项目名称",maxlength:"20"},null,8,["modelValue"])])),_:1}),_(c,{label:"项目标签"},{default:j((()=>[_(u,{modelValue:e.projectOptions.tag,"onUpdate:modelValue":o[2]||(o[2]=o=>e.projectOptions.tag=o),placeholder:"请选择项目标签",onChange:e.handleChangeProjectTag},{default:j((()=>[_(p,{label:"静态",value:"0"}),_(p,{label:"动态",value:"1"})])),_:1},8,["modelValue","onChange"])])),_:1}),_(c,{label:"项目来源"},{default:j((()=>[$(' <el-select v-model="projectOptions.source" placeholder="请选择项目来源">\r\n                      <el-option label="临摹" :value="\'0\'"></el-option>\r\n                      <el-option label="原创" :value="\'1\'"></el-option>\r\n                    </el-select> '),_(u,{modelValue:e.projectOptions.source,"onUpdate:modelValue":o[3]||(o[3]=o=>e.projectOptions.source=o),placeholder:"请选择项目来源","multiple-limit":2,"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,multiple:""},{default:j((()=>[_(p,{label:"临摹",value:"0",disabled:e.projectOptions.source.includes("1")},null,8,["disabled"]),_(p,{label:"原创",value:"1",disabled:e.projectOptions.source.includes("0")},null,8,["disabled"]),_(p,{label:"二创",value:"2"})])),_:1},8,["modelValue"])])),_:1}),"1"===e.projectOptions.activityCode?(U(),b(c,{key:0,label:"联系方式",required:"",prop:"tip"},{default:j((()=>[_(d,{modelValue:e.projectOptions.tip,"onUpdate:modelValue":o[4]||(o[4]=o=>e.projectOptions.tip=o),clearable:"",placeholder:"请输入联系方式",maxlength:"20"},null,8,["modelValue"])])),_:1})):$("v-if",!0),_(c,{label:"项目描述"},{default:j((()=>[_(d,{modelValue:e.projectOptions.desc,"onUpdate:modelValue":o[5]||(o[5]=o=>e.projectOptions.desc=o),placeholder:"请输入项目描述",type:"textarea",maxlength:"100","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"]),A])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-b490ef6c"],["__file","D:/project/pixel-grid/src/components/dialog/PublishEditDialog.vue"]]);const K=c({name:"PersonShareDialog",components:{},props:{visible:{type:Boolean,default:!1},url:{type:String,default:""}},emits:["close"],setup(e,o){let l=m({dialogVisible:e.visible,qrCodeUrl:null,qrcodeDom:null,title:"",qrcode:null}),a={handleClose(){l.dialogVisible=!1,o.emit("close")},handleOpen(e,o){l.dialogVisible=!0,B((()=>{l.qrcodeDom=document.getElementById("qrcode"),l.title=e,l.qrCodeUrl=o,a.generateQRCode()}))},async generateQRCode(){try{l.qrcodeDom.innerHTML="",l.qrcode=new QRCode(l.qrcodeDom),l.qrcode.clear(),l.qrcode.makeCode(l.qrCodeUrl||"分享内容不存在")}catch(e){l.qrcodeDom.innerText="二维码生成失败"}}};return g((()=>{B((()=>{l.qrcodeDom=document.getElementById("qrcode")}))})),n(i(i({},f(l)),a),{copyText:E})}}),G={class:"flex-column-center share-content scrollbar"},M={class:"share-pic flex-center",id:"qrcode",ref:"qrcode"},X={class:"flex-between share-url"},Y=["title"];var W=d(K,[["render",function(e,o,l,a,t,s){const r=h("CopyDocument"),i=h("el-icon"),n=h("el-dialog");return U(),b(n,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=o=>e.dialogVisible=o),title:e.title,width:400,"lock-scroll":!1,"before-close":e.handleClose,class:"z-dialog",center:""},{default:j((()=>[x("div",G,[x("div",M,[$(' <el-image\r\n                :src="qrCodeUrl"\r\n                fit="contain" /> ')],512),x("div",X,[x("p",{class:"oneline",title:e.qrCodeUrl},w(e.qrCodeUrl),9,Y),_(i,{onClick:o[0]||(o[0]=o=>e.copyText(e.qrCodeUrl))},{default:j((()=>[_(r)])),_:1})])])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-250168db"],["__file","D:/project/pixel-grid/src/components/dialog/PersonShareDialog.vue"]]);export{W as P,Q as a};
