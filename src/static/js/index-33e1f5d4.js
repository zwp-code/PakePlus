var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,r=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&l(e,a,t[a]);return e};import{d as n,A as c,bA as g,r as d,o as u,t as p,aQ as m,a8 as y,g as A,_ as b,b as f,a2 as v,O as C,l as h,j as R,k as x,n as S,h as B,f as T,x as k,y as D,e as I,F as P,p as M,z as E,v as Q,q as N}from"./index-6a0d579b.js";import{N as J}from"./NoticeDialog-6b8c53c3.js";import{u as L}from"./useModule-f0faaaf9.js";import{e as j}from"./empty-6662c720.js";import"./grid-33bc5412.js";import"./boy-09783d30.js";var F=n({name:"message",props:{},components:{NoticeDialog:J},emits:[],setup(e,s){const{proxy:i}=A(),o=c(),l=L();g(o);let n=d({myMessageList:[],loading:!0,currentPage:1,pageSize:10,totalCount:0,emptyStatus:!1,desc:"暂无消息",backRoute:null,visible:!1,messageDetail:null,messageFooter:{str:"已读",id:2,visible:!0}}),b={handleOpenMessage(e){n.visible=!0,n.messageDetail=e,n.messageDetail.isForceUpdate="0",n.messageFooter.visible=!0,"1"!==e.isRead&&"0"!==e.userId||(n.messageFooter.visible=!1)},handleReadMsg(){const e=i.$bmob.Query("Message");e.set("id",n.messageDetail.objectId),e.set("isRead","1"),e.save().then((e=>{n.messageDetail.isRead="1"})).catch((e=>{i.$message.error("网络异常")}))},handleClose(){n.backRoute&&""!==n.backRoute?i.$router.back():i.$router.push("/about")},handleCurrentChange(e){n.currentPage=e,n.loading=!0,b.getMyMessage()},getMyMessage(){if(o.isLogin&&o.userData){const e=i.$bmob.Query("Message"),t=e.equalTo("userId","==",o.userData.username),a=e.equalTo("userId","==","0");e.or(t,a),e.limit(n.pageSize),e.skip(n.pageSize*(n.currentPage-1)),e.order("-isTop","-createdAt"),e.find().then((e=>{if(n.loading=!1,!e.results.length)return n.emptyStatus=!0,void(n.desc="暂无消息");n.myMessageList=e.results,n.totalCount=e.count,n.emptyStatus=!1})).catch((e=>{n.loading=!1,n.emptyStatus=!0,n.desc="网络异常"}))}else n.loading=!1,n.emptyStatus=!0,n.desc="未登录"}};return u((()=>{n.backRoute=i.$router.options.history.state.back,b.getMyMessage()})),r(r((f=r(r({},p(n)),b),t(f,a({editSpaceStore:o,InfoFilled:m,copyText:y}))),p(l.data)),l);var f}});const w={class:"full-layout","element-loading-background":"#00000000"},O={class:"header-box"},K=(e=>(k("data-v-da1dbfc0"),e=e(),D(),e))((()=>R("h2",{class:"title"},"我的消息",-1))),X={class:"flex-center",style:{gap:"20px"}},U=["onClick"],V=["src"],z=["innerHTML"],H={class:"full-w flex-end info-time"},Y={key:0,class:"flex-center full-w",style:{padding:"10px"}},q={key:1,class:"flex-center",style:{height:"calc(100% - 55px)"}};var G=b(F,[["render",function(e,t,a,s,i,o){const l=f("Close"),r=f("el-icon"),n=f("el-tooltip"),c=f("el-pagination"),g=f("el-scrollbar"),d=f("el-empty"),u=f("NoticeDialog"),p=v("loading");return C((I(),h("div",w,[R("div",O,[K,R("div",X,[x(' <el-tooltip\r\n                    content="一键已读"\r\n                    placement="bottom">\r\n                    <el-icon :size="20" class="pointer icon" @click="handleClose"><Close /></el-icon>\r\n                </el-tooltip> '),S(n,{content:"关 闭",placement:"bottom"},{default:B((()=>[S(r,{size:20,class:"pointer icon",onClick:e.handleClose},{default:B((()=>[S(l)])),_:1},8,["onClick"])])),_:1})])]),e.loading||e.emptyStatus?!e.loading&&e.emptyStatus?(I(),h("div",q,[S(d,{image:j,description:e.desc,"image-size":200},{default:B((()=>[x(' <el-button type="primary" @click="editSpaceStore.loginVisible = true">去登录</el-button> ')])),_:1},8,["image","description"])])):x("v-if",!0):(I(),T(g,{key:0,style:{height:"calc(100% - 55px)"}},{default:B((()=>[x(' <el-tag type="warning" style="margin:20px 20px 0" v-if="isSelf" effect="dark" class="notice-tag">须知：每个用户七天内只能修改一次昵称和头像喔</el-tag> '),(I(!0),h(P,null,M(e.myMessageList,(t=>(I(),h("div",{class:"flex-column-start info-box",key:t.objectId,onClick:a=>e.handleOpenMessage(t)},[R("h4",{class:N(["oneline pointer info-title flex-start",{isRead:"1"===t.isRead}]),style:{gap:"10px"}},["1"===t.isTop?(I(),h("img",{key:0,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABRVJREFUeF7tmk1oHFUcwH9vI7EFQVERWhSLsbvbpqIUrQpSK/WDqCnJbJKDiEQPgqCIJ62gJvhBL4ofF71oe+ihSXeWUuNJUI8iHpQ2m9mtKIIfBT14yKGazF/exInJZnbnY9/MDiRzCWTfvPd+v/d/36PY5I/a5PxsCdiKgE1uIJ9doHL+TqTvOUR9xRI1zpb+SKud8idgdGEcpWb+B1bn6VMTzO6eT0NCvgRsgPeR05OQHwFt4dOVkA8BofDpSei9gMjw6UjorYDO8LPAePDAZ25M6J2AMHi7NEHHNGYk9EZAFHi/6VOWkL2AOPAZSMhWQBL4lCVkJ6Ab+BQlmBNwZGEn/WoA1x2AvpuAARTXInIR4RcUL7VZys6iB7yoj+ExIbmA8XP9uP3DCI+CDAPXRGVYky4efAqREF+A1TgI7tPAEKirE0D7rySDNywhngDLeRl4swtoM/AGJUQTUPnhdmTpbeBgbuANSQgXYNWnoPBaJHBRX6JkEWHR+4taRKlFEEHYBfTFGvAiFQrdrBg7C7B+2gGXfu1YD6Uu4DIHfEStWI9aZ+PpQmeHv+9ndt/vreWGCKhPQuGTgMr+CcyhZI5qec3pjXGseBl2kiAcpVY6Fk/AUPNytrsL4IVvy2NmMxKPMEJqy9ENErCLlJPY5cfjCdCprYUxUKeAQu4ltIUH1NJdVAe/ji9Av1FxRhC0hP7cSugELzJBrazPFzbGcYSgWklSaQ4jrpawPXcSEsJrjvBpcC1txXn4v0i4IjcSuoCPL8CLhPpDSEFHwpU9l9AlfDIB+q0x5zCuNyYEbIAymh0MwCcXoN8cqR+i4EXCdZlHgiH47gTot0ede1DoeXdHZhIMwncvwJNQvxtV0BKuT12CYXgzArzu4Byg4I0J6a0YU4A3J0DnZDX3g6sjYcB4JKQEb1bAyphwK0pmQBWNSrCcE8ATG/LssMKLusCLtxCKkmulOQgyg8heYxIs5y3g6Pr85A3s8itRqtQpjXkBoQcoCdYJlcYxRF5cB6Lkfarl5/MlIBTer25MCZbzAfBsC+xx7NKT+REQGT6BBGvhY1AtsKqKXRzLh4AweKXmuxoTRp1TKFouT9Tn2MUHei8gDB53GnXZLLJsJ54dLOdT4JGWMeBDquVneisgCry9Z8qrpDdFUk20ThhtfIGSQ+tgRT1FrRh0XhnLSfJZIA68XyVrfj/0aQnRV4yjjT0o2fiJnCzfQm3vuVi0AYmTCUgCvyrBuQNUFeSGSOuE0ca7KGmZ7uRn7PKN3cInWwl2A+/X2NtAaQkqfBdZaTQRuXl9+HOCWmkyewEm4FcleFtp3R3anye4y/sQ70R6/aMKR6juPputAJPwqxKa96JcLSH4ZAn5NmAP8B126TYT8NG7QBrwPsGIc5iCOg1yVQCUvoFqkSOvYpdfz05AmvA+xVjzQVwvEgJOm1tQl5cGOTNo7MPpsLvBkJthdxp/nu+2ScYuDOEuawkB9w5+5mZbv3MXyKLlW6VV6sNI4XTgDZS+eq8V7+vW84bxNDBDq+2tsJ98Crs0bboyXn4r13A6ElrvIg9gl74xXWZwF6g47yC80Kaw9OD9AlcuZN8Ddq78y2BXa51RgyNg4SSoxwJ+Sx/eL3Tyx238dWkSte0M9q7fTLe8n1+7CPgM0V+BrXuyg0+LNiDf9rOAdxIr/6DURcT9HnvP8QzrlVlRyTZDmVUv/YK2BKTvON8lbEVAvtsn/dr9C6K3Ul8oqip4AAAAAElFTkSuQmCC"},null,8,V)):x("v-if",!0),E(" "+Q(t.title),1)],2),R("p",{class:N(["info-content text-justify",{isRead:"1"===t.isRead}]),innerHTML:t.content},null,10,z),R("div",H," —— 最后更新时间："+Q(t.createAt)+" —— ",1),x(' <el-divider content-position="right" border-style="dashed">{{ item.createdAt }}</el-divider> ')],8,U)))),128)),e.loading||e.emptyStatus?x("v-if",!0):(I(),h("div",Y,[S(c,{"current-page":e.currentPage,"onUpdate:current-page":t[0]||(t[0]=t=>e.currentPage=t),"page-size":e.pageSize,background:"",layout:"total, prev, pager, next",total:e.totalCount,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])]))])),_:1})),e.visible?(I(),T(u,{key:2,visible:e.visible,notice:e.messageDetail,footerBtn:e.messageFooter,onClose:t[1]||(t[1]=t=>e.visible=!1),onReadMsg:e.handleReadMsg},null,8,["visible","notice","footerBtn","onReadMsg"])):x("v-if",!0)])),[[p,e.loading]])}],["__scopeId","data-v-da1dbfc0"],["__file","D:/project/pixel-grid/src/views/message/index.vue"]]);export{G as default};
