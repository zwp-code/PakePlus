import{aF as t,aG as e}from"./index-6a0d579b.js";function n(t){return(new TextEncoder).encode(t)}function r(t,e,n){const r=new Uint8Array(t,e,n);return(new TextDecoder).decode(r)}function a(t,e){return new DataView(t).getUint8(e)}function o(t,e){return new DataView(t).getUint16(e,!0)}function c(t,e){return new DataView(t).getUint32(e,!0)}function s(t,e,r){const a=n(r);return t[e]=a.length,t.set(a,e+1),e+1+a.length}function i(t,e,n){return t[e]=n,e+1}function l(t,e,n){return new DataView(t.buffer).setUint16(e,n,!0),e+2}function h(t,e,n){return new DataView(t.buffer).setUint32(e,n,!0),e+4}function d(n){return new Promise(((r,a)=>{if(n)if(n.split(",").length>=2)r(n);else try{const a=atob(n),o=new Uint8Array(a.length);for(let t=0;t<a.length;t++)o[t]=a.charCodeAt(t);const c=pako.inflate(o),s=t(c);r((e()?"data:image/webp;base64":"data:image/png;base64")+","+s)}catch(o){a(new Error("Base64 解压失败："+o.message))}else r("")}))}function g(n){return e(),new Promise(((e,r)=>{if(null!==n&&""!==n)try{const r=atob(n),a=new Uint8Array(r.length);for(let t=0;t<r.length;t++)a[t]=r.charCodeAt(t);const o=pako.deflate(a);e(t(o))}catch(a){r(new Error("Base64 压缩失败："+a.message))}else e("")}))}async function f(t){try{if(!t)throw new Error("项目不存在");return function(t){if(!t.projectName||"string"!=typeof t.projectName)throw new Error("项目名称不存在");if(!t.projectId||"string"!=typeof t.projectId)throw new Error("项目ID不存在")}(t),await(async()=>{try{const e=n(t.projectName),r=n(t.desc),a=n(t.projectId),o=n(t.createAt),c=n(t.updateAt),g=n(t.tip||""),f=[];for(const p of t.data){const t=n(p.frameId);let e=await d(p.currentFrameImg);e=e.replace(/^data:image\/\w+;base64,/,"");const r=Uint8Array.from(atob(e),(t=>t.charCodeAt(0))),a=p.layer||[],o=[];for(const f of a){const t=n(f.layerId),e=n(f.layerName);let r=new Uint8Array(0);if(f.currentLayerImg&&"string"==typeof f.currentLayerImg){const t=(await d(f.currentLayerImg)).replace(/^data:image\/\w+;base64,/,"");r=Uint8Array.from(atob(t),(t=>t.charCodeAt(0)))}const a=f.mindLayerList||[],c=[];for(const o of a){let t=await d(o.mindObj);t=t.replace(/^data:image\/\w+;base64,/,"");const e=Uint8Array.from(atob(t),(t=>t.charCodeAt(0))),r=new Uint8Array(1+n(o.mindId).length+4+e.length+1+1+2+2+2+2+1+n(o.mindName).length);let a=0;a=s(r,a,o.mindId),a=h(r,a,e.length),r.set(e,a),a+=e.length,a=i(r,a,o.isLock?1:0),a=i(r,a,o.isHide?1:0),a=l(r,a,o.width),a=l(r,a,o.height),a=l(r,a,o.left),a=l(r,a,o.top),a=s(r,a,o.mindName),c.push(r)}const g=new Uint8Array(1+t.length+1+e.length+1+1+4+r.length+1+1+1+c.reduce(((t,e)=>t+e.length),0));let u=0;u=s(g,u,f.layerId),u=s(g,u,f.layerName),u=i(g,u,f.alpha),u=i(g,u,f.isLock?1:0),u=h(g,u,r.length),g.set(r,u),u+=r.length,u=i(g,u,f.isExpandMindList?1:0),u=i(g,u,f.isRender?1:0),u=i(g,u,c.length),c.forEach((t=>{g.set(t,u),u+=t.length})),o.push(g)}const c=new Uint8Array(1+t.length+4+r.length+1+o.reduce(((t,e)=>t+e.length),0));let g=0;g=s(c,g,p.frameId),g=h(c,g,r.length),c.set(r,g),g+=r.length,g=i(c,g,o.length),o.forEach((t=>{c.set(t,g),g+=t.length})),f.push(c)}const u=1+e.length+1+r.length+1+a.length+1+o.length+1+c.length+2+2+1+1+1+g.length+1+f.reduce(((t,e)=>t+e.length),0),w=new Uint8Array(u);let m=0;return m=s(w,m,t.projectName),m=s(w,m,t.desc),m=s(w,m,t.projectId),m=s(w,m,t.createAt),m=s(w,m,t.updateAt),m=l(w,m,t.width),m=l(w,m,t.height),m=i(w,m,t.isTop),m=i(w,m,"1"===t.isLargeCanvas?1:0),m=s(w,m,t.tip||""),m=i(w,m,f.length),f.forEach((t=>{w.set(t,m),m+=t.length})),new Blob([w],{type:"application/octet-stream"})}catch(e){throw new Error("项目导出失败")}})()}catch(e){return null}}async function u(e){try{if(!e)throw new Error("项目不存在");return await(async()=>{try{let n=0;const s=r(e,n+1,a(e,n));n+=1+a(e,n);const i=r(e,n+1,a(e,n));n+=1+a(e,n);const l=r(e,n+1,a(e,n));n+=1+a(e,n);const h=r(e,n+1,a(e,n));n+=1+a(e,n);const d=r(e,n+1,a(e,n));n+=1+a(e,n);const f=o(e,n);n+=2;const u=o(e,n);n+=2;const w=0!==a(e,n);n+=1;const m=0!==a(e,n);n+=1;const p=r(e,n+1,a(e,n));n+=1+a(e,n);const y=a(e,n);n+=1;const A=[];for(let I=0;I<y;I++){const s=r(e,n+1,a(e,n));n+=1+a(e,n);const i=c(e,n);n+=4;const l=e.slice(n,n+i);n+=i;const h=a(e,n);n+=1;const d=[];for(let u=0;u<h;u++){const s=r(e,n+1,a(e,n));n+=1+a(e,n);const i=r(e,n+1,a(e,n));n+=1+a(e,n);const l=a(e,n);n+=1;const h=0!==a(e,n);n+=1;const f=c(e,n);n+=4;let u="";if(f>0){const r=e.slice(n,n+f);n+=f,u=await g(t(r))}const w=0!==a(e,n);n+=1;const m=0!==a(e,n);n+=1;const p=a(e,n);n+=1;const y=[];for(let d=0;d<p;d++){const s=r(e,n+1,a(e,n));n+=1+a(e,n);const i=c(e,n);n+=4;let l="";if(i>0){const r=e.slice(n,n+i);n+=i,l=await g(t(r))}const h=0!==a(e,n);n+=1;const d=0!==a(e,n);n+=1;const f=o(e,n);n+=2;const u=o(e,n);n+=2;const w=o(e,n);n+=2;const m=o(e,n);n+=2;const p=r(e,n+1,a(e,n));n+=1+a(e,n),y.push({mindId:s,mindObj:l,isLock:h,isHide:d,width:f,height:u,left:w,top:m,mindName:p})}d.push({layerId:s,layerName:i,alpha:l,isLock:h,currentLayerImg:u,isExpandMindList:w,isRender:m,mindLayerList:y})}const f=await g(t(l));A.push({frameId:s,currentFrameImg:f,layer:d})}return{projectName:s,desc:i,createAt:h,updateAt:d,projectId:l,width:f,height:u,frameImg:"@",isTop:w?"1":"0",isLargeCanvas:m?"1":"0",tip:p,data:A}}catch(n){throw new Error("项目读取失败")}})()||null}catch(n){return null}}export{f as e,u as i};
