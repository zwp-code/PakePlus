var e=Object.defineProperty,o=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(o,l,t)=>l in o?e(o,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[l]=t,i=(e,o)=>{for(var l in o||(o={}))a.call(o,l)&&r(e,l,o[l]);if(t)for(var l of t(o))s.call(o,l)&&r(e,l,o[l]);return e},n=(e,t)=>o(e,l(t));import{d,y as p,z as c,r as u,o as m,t as g,b as f,e as h,f as b,h as j,j as O,k as y,l as C,x as v,n as U,p as P,F as x,g as _,ae as V,ac as w,af as $,ag as q,ak as I,a7 as k}from"./index-7e9c327e.js";import{u as B}from"./useDB-d1ce478c.js";import{_ as D}from"./plugin-vue_export-helper-46f75680.js";const T=d({name:"PublishEditDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,o){const l=p(),t=c();B();let{proxy:a}=_(),s=u({uploadUrl:"/api/1/upload",dialogVisible:e.visible,projectOptions:{isPass:"0",author:"",authorAvatar:"",projectName:"",projectId:"",desc:"-",width:"32",height:"32",frameImg:"",isTop:"0",tip:"",tag:"0",authorId:"",authorUid:""},imageTypes:["image/jpeg","image/jpg","image/png","image/gif"],fileList:[],fileHeader:{"X-API-Key":a.$config.PICGO_KEY},poster:"",isloading:!1,deletePosterUrl:"",progressValue:0,posterFile:null}),r={handleChangeProjectTag(e){"1"===s.projectOptions.tag&&(s.projectOptions.tip="动画")},handleBeforeUploadPoster:e=>s.imageTypes.includes(e.type)?!(e.size/1024/1024>a.$config.MAX_UPLOAD_SIZE)||(a.$message.warning("上传图片封面大小不能超过500kb！"),!1):(a.$message.warning("上传图片封面格式不正确！"),!1),handleErrorUploadPoster(e,o){a.$message.error("上传封面失败"),s.isloading=!1},handleSuccessUploadPoster(e,o){},handleExceedUploadPoster(e,o){t.value.clearFiles();const l=e[0];l.uid=V(),t.value.handleStart(l)},handleChangeUploadPoster(e,o){s.poster=URL.createObjectURL(e.raw),s.posterFile=e},handleUploadPosterToOBS(e){let o=w(e.name),l=`${s.projectOptions.projectId}.${o}`;$(e.raw,l,(e=>{r.handleBmobPublish("/"+l)}),(e=>{s.isloading=!1,a.$message.error(e)}),(e=>{}))},handleBmobPublish(e){const t=a.$bmob.Query("Resource");t.set("id",s.projectOptions.objectId),t.set("author",l.userData.nickname),t.set("projectName",s.projectOptions.projectName),t.set("tag",s.projectOptions.tag),t.set("desc",s.projectOptions.desc.trim()),s.projectOptions.source.sort(((e,o)=>e-o)),t.set("source",s.projectOptions.source.join(",")),""!==e&&t.set("frameImg",e),t.set("isPass","0"),t.save().then((e=>{s.isloading=!1,a.$message.success("编辑成功，已提交审核"),o.emit("save",s.projectOptions),r.handleClose()})).catch((o=>{e&&r.handleDeletePoster(e),s.isloading=!1,a.$message.error("编辑失败")}))},handleDeletePoster(e){let o=e.slice(1);q(o,(e=>{s.isloading=!1}),(e=>{s.isloading=!1}))},handleClose(){s.dialogVisible=!1,o.emit("close")},handleConfirm(){a.$refs.form.validate((e=>{if(e){if(""===s.poster)return a.$message.warning("请上传封面");if("1"===s.projectOptions.activityCode){if("0"===s.projectOptions.source)return a.$message.warning("请确保项目是原创作品！");if(Number(s.projectOptions.width)>100||Number(s.projectOptions.height)>100)return a.$message.warning("请确保项目画布尺寸小于100");if(""===s.projectOptions.tip)return a.$message.warning("请填写联系方式");if(""===s.projectOptions.desc)return a.$message.warning("请填写项目描述")}s.isloading=!0,s.posterFile?r.handleBeforeUploadPoster(s.posterFile.raw)?r.handleUploadPosterToOBS(s.posterFile):s.isloading=!1:r.handleBmobPublish("")}else a.$message.warning("请填写参数")}))}};return m((()=>{e.editInfo&&(s.projectOptions=e.editInfo,s.projectOptions.source?s.projectOptions.source=e.editInfo.source.split(","):s.projectOptions.source=["0"],s.poster=`${a.$config.HUAWEI_OBS_CONFIG.HOST}${s.projectOptions.frameImg}`)})),n(i(i({},g(s)),r),{uploadRef:t})}}),E={key:1,class:"poster flex-center"},S=["src"],R={key:0,class:"el-upload__tip"},N={class:"dialog-footer"};var F=D(T,[["render",function(e,o,l,t,a,s){const r=f("upload-filled"),i=f("el-icon"),n=f("el-upload"),d=f("el-input"),p=f("el-form-item"),c=f("el-option"),u=f("el-select"),m=f("el-form"),g=f("el-button"),_=f("el-dialog");return h(),b(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[6]||(o[6]=o=>e.dialogVisible=o),title:e.editInfo?"编辑项目":"发布项目",width:350,"before-close":e.handleClose,"lock-scroll":!1,"close-on-click-modal":!1,class:"z-dialog",center:""},{footer:j((()=>[O("span",N,[y(g,{onClick:e.handleClose},{default:j((()=>[C(v(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),y(g,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:j((()=>[C(v(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:j((()=>[y(n,{ref:"uploadRef",class:"flex-column-center",drag:"",action:e.uploadUrl,"auto-upload":!1,"show-file-list":!1,accept:".png,.jpg,.jpeg,.gif",name:"source",limit:1,method:"post",headers:e.fileHeader,"file-list":e.fileList,"onUpdate:fileList":o[0]||(o[0]=o=>e.fileList=o),"on-success":e.handleSuccessUploadPoster,"before-upload":e.handleBeforeUploadPoster,"on-error":e.handleErrorUploadPoster,"on-exceed":e.handleExceedUploadPoster,"on-change":e.handleChangeUploadPoster,disabled:"1"===e.projectOptions.activityCode},{tip:j((()=>["0"===e.projectOptions.activityCode?(h(),U("div",R," 上传小于500KB的jpg/png/gif文件作为封面 ")):P("",!0)])),default:j((()=>[""===e.poster?(h(),U(x,{key:0},[y(i,{class:"el-icon--upload"},{default:j((()=>[y(r)])),_:1}),o[7]||(o[7]=O("div",{class:"el-upload__text"},[C(" 拖拽文件到这 或者 "),O("em",null,"点击这里上传")],-1))],64)):(h(),U("div",E,[O("img",{src:e.poster,style:{"object-fit":"contain"}},null,8,S)]))])),_:1},8,["action","headers","file-list","on-success","before-upload","on-error","on-exceed","on-change","disabled"]),y(m,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,class:"scrollbar scrollY",style:{"margin-top":"10px","max-height":"300px",padding:"0 10px"},model:e.projectOptions},{default:j((()=>[y(p,{label:"项目名称",required:"",prop:"projectName"},{default:j((()=>[y(d,{modelValue:e.projectOptions.projectName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.projectOptions.projectName=o),clearable:"",placeholder:"请输入项目名称",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(p,{label:"项目标签"},{default:j((()=>[y(u,{modelValue:e.projectOptions.tag,"onUpdate:modelValue":o[2]||(o[2]=o=>e.projectOptions.tag=o),placeholder:"请选择项目标签",onChange:e.handleChangeProjectTag},{default:j((()=>[y(c,{label:"静态",value:"0"}),y(c,{label:"动态",value:"1"})])),_:1},8,["modelValue","onChange"])])),_:1}),y(p,{label:"项目来源"},{default:j((()=>[y(u,{modelValue:e.projectOptions.source,"onUpdate:modelValue":o[3]||(o[3]=o=>e.projectOptions.source=o),placeholder:"请选择项目来源","multiple-limit":2,"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,multiple:""},{default:j((()=>[y(c,{label:"临摹",value:"0",disabled:e.projectOptions.source.includes("1")},null,8,["disabled"]),y(c,{label:"原创",value:"1",disabled:e.projectOptions.source.includes("0")},null,8,["disabled"]),y(c,{label:"二创",value:"2"})])),_:1},8,["modelValue"])])),_:1}),"1"===e.projectOptions.activityCode?(h(),b(p,{key:0,label:"联系方式",required:"",prop:"tip"},{default:j((()=>[y(d,{modelValue:e.projectOptions.tip,"onUpdate:modelValue":o[4]||(o[4]=o=>e.projectOptions.tip=o),clearable:"",placeholder:"请输入联系方式",maxlength:"20"},null,8,["modelValue"])])),_:1})):P("",!0),y(p,{label:"项目描述"},{default:j((()=>[y(d,{modelValue:e.projectOptions.desc,"onUpdate:modelValue":o[5]||(o[5]=o=>e.projectOptions.desc=o),placeholder:"请输入项目描述",type:"textarea",maxlength:"100","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"]),o[8]||(o[8]=O("p",{style:{"line-height":"1.5","font-size":"12px","margin-top":"5px"},class:"text-grey"},"注：如需艾特原创作者可通过 @原创作者名称[原创作者链接地址] 标明",-1))])),_:1,__:[8]})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-6da77973"]]);const L=d({name:"PersonShareDialog",components:{},props:{visible:{type:Boolean,default:!1},url:{type:String,default:""}},emits:["close"],setup(e,o){let l=u({dialogVisible:e.visible,qrCodeUrl:null,qrcodeDom:null,title:"",qrcode:null}),t={handleClose(){l.dialogVisible=!1,o.emit("close")},handleOpen(e,o){l.dialogVisible=!0,I((()=>{l.qrcodeDom=document.getElementById("qrcode"),l.title=e,l.qrCodeUrl=o,t.generateQRCode()}))},async generateQRCode(){try{l.qrcodeDom.innerHTML="",l.qrcode=new QRCode(l.qrcodeDom),l.qrcode.clear(),l.qrcode.makeCode(l.qrCodeUrl||"分享内容不存在")}catch(e){l.qrcodeDom.innerText="二维码生成失败"}}};return m((()=>{I((()=>{l.qrcodeDom=document.getElementById("qrcode")}))})),n(i(i({},g(l)),t),{copyText:k})}}),z={class:"flex-column-center share-content scrollbar"},A={class:"share-pic flex-center",id:"qrcode",ref:"qrcode"},H={class:"flex-between share-url"},Q=["title"];var K=D(L,[["render",function(e,o,l,t,a,s){const r=f("CopyDocument"),i=f("el-icon"),n=f("el-dialog");return h(),b(n,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=o=>e.dialogVisible=o),title:e.title,width:350,"lock-scroll":!1,"before-close":e.handleClose,class:"z-dialog",center:""},{default:j((()=>[O("div",z,[O("div",A,null,512),O("div",H,[O("p",{class:"oneline",title:e.qrCodeUrl},v(e.qrCodeUrl),9,Q),y(i,{onClick:o[0]||(o[0]=o=>e.copyText(e.qrCodeUrl))},{default:j((()=>[y(r)])),_:1})])])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-612bca15"]]);export{K as P,F as a};
