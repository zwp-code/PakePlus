var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,s=(e,a)=>{for(var t in a||(a={}))i.call(a,t)&&l(e,t,a[t]);if(o)for(var t of o(a))n.call(a,t)&&l(e,t,a[t]);return e},r=(e,o)=>a(e,t(o));import{_ as c,d as p,A as d,r as u,c as y,o as f,t as g,b as m,f as v,h as b,G as h,i as x,w as I,e as w,j as C,k,l as P,n as S,v as _,F as T,p as D,q as j,s as A,g as V,x as $,y as O,z as B,aI as L,a as N,al as F,am as U,aq as z,a2 as E,O as G,L as M}from"./index-6a0d579b.js";import{C as R,P as W}from"./PayStatusDialog-19d73961.js";const q=p({name:"PayDialog",components:{},props:{visible:{type:Boolean,default:!1},versionInfo:{type:Object,default:null}},emits:["close","update","contact","finish"],setup(e,a){const{proxy:t}=V(),o=d();let i=u({payTypeList:[{value:"0",label:"支付宝",icon:"alipay",color:"#447df6"},{value:"1",label:"微信",icon:"wx",color:"#2cac30"}],payInfo:{payType:"0",status:"0",outTradeNo:"",totalAmount:"",subject:"",version:"",uid:"",orderType:""},loading:!1,dialogVisible:e.visible,wxPayInfo:null,wxPayData:null,payTimer:null});const n=y((()=>e=>new URL(`/svg/${e}.svg`,window.location.origin).href));let l={async handleSelect(e,a){i.payInfo.payType=e.value},handleClose(){i.dialogVisible=!1,a.emit("close")},handleGenerateOrder(){i.payInfo.outTradeNo=h();const e=t.$bmob.Query("Order");e.set("payType",i.payInfo.payType),e.set("status",i.payInfo.status),e.set("subject",i.payInfo.subject),e.set("totalAmount",i.payInfo.totalAmount),e.set("uid",i.payInfo.uid),e.set("version",i.payInfo.version),e.set("outTradeNo",i.payInfo.outTradeNo),e.set("orderType",i.payInfo.orderType),e.save().then((async e=>{"0"===i.payInfo.payType?l.handleAliPay(e):l.handleWxPay()})).catch((e=>{i.loading=!1,t.$message.error("购买失败，请联系作者")}))},async handleAliPay(e){try{let a=r(s({},e),{returnUrl:window.location.origin+"/price"}),o=x()?"wap":"page";const i=await t.$http.alipay(a,o);l.handleClose(),window.open(i.data.url,"_blank")}catch(a){i.loading=!1,t.$message.error("跳转支付失败，请联系作者")}},async handleWxPay(){try{let e=i.payInfo.outTradeNo,a=Math.floor((new Date).getTime()/1e3),o=I({mch_id:t.$config.WX_MCH_ID,out_trade_no:e,total_fee:i.payInfo.totalAmount,body:i.payInfo.subject,timestamp:String(a),notify_url:"https://api.zwpyyds.com/px/api/wxpay/notify"},t.$config.WX_KEY),n={mch_id:t.$config.WX_MCH_ID,out_trade_no:e,total_fee:i.payInfo.totalAmount,body:i.payInfo.subject,timestamp:String(a),notify_url:"https://api.zwpyyds.com/px/api/wxpay/notify",sign:o};i.wxPayData=JSON.parse(JSON.stringify(n)),n.time_expire="2m";const l=await t.$http.wxPay(n);i.loading=!1,0===l.data.code?i.wxPayInfo=l.data:t.$message.error("请求支付失败，请联系作者")}catch(e){i.loading=!1,t.$message.error("请求支付失败，请联系作者")}},async handleConfirm(){if(o.checkIsLogin())return l.handleClose();i.loading=!0,l.handleGenerateOrder()},handleFinishWxPay(){i.wxPayData&&(i.payTimer&&clearTimeout(i.payTimer),i.loading=!0,i.payTimer=setTimeout((async()=>{try{const e=await t.$http.wxPayVerify(i.wxPayData);if(e.data.status){let n=await o.getRemoteUserInfo(t,o.userData.objectId);o.saveUserInfo(n),t.$message.success(e.data.msg),i.loading=!1,l.handleClose(),a.emit("finish",e)}else i.loading=!1,t.$message.error(e.data.msg)}catch(e){i.loading=!1,t.$message.error("查询支付失败，请联系作者")}}),5e3))}};return f((()=>{i.payInfo.subject=e.versionInfo.subject,i.payInfo.totalAmount=e.versionInfo.totalAmount,i.payInfo.uid=e.versionInfo.uid,i.payInfo.version=e.versionInfo.version,i.payInfo.orderType=e.versionInfo.orderType})),r(s(s({},g(i)),l),{getIcon:n})}}),Q=e=>($("data-v-d651c90e"),e=e(),O(),e),K={key:0,style:{margin:"20px 0"},class:"text-center"},X=Q((()=>C("p",{style:{"margin-top":"10px"}},"请使用微信扫一扫完成支付（有效期2分钟）",-1))),H={class:"flex-between full-w",style:{margin:"20px 0"}},J=Q((()=>C("p",null,"支付金额",-1))),Y={key:1,style:{margin:"10px 0"}},Z=Q((()=>C("p",null,"支付类型",-1))),ee={class:"page-box"},ae=["onClick"],te=["src"],oe={class:"dialog-footer"},ie=B("取 消"),ne=B("确 定"),le=B("已完成支付");var se=p({name:"price",components:{ContactAuthorDialog:R,PayDialog:c(q,[["render",function(e,a,t,o,i,n){const l=m("el-image"),s=m("el-button"),r=m("el-dialog");return w(),v(r,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=a=>e.dialogVisible=a),title:"升级"+e.payInfo.subject,"before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:b((()=>[C("span",oe,[e.wxPayInfo?k("v-if",!0):(w(),v(s,{key:0,onClick:e.handleClose},{default:b((()=>[ie])),_:1},8,["onClick"])),e.wxPayInfo?(w(),v(s,{key:2,type:"success",onClick:e.handleFinishWxPay,loading:e.loading},{default:b((()=>[le])),_:1},8,["onClick","loading"])):(w(),v(s,{key:1,type:"primary",onClick:e.handleConfirm,loading:e.loading},{default:b((()=>[ne])),_:1},8,["onClick","loading"]))])])),default:b((()=>{var a,t;return[e.wxPayInfo?(w(),P("div",K,[S(l,{src:null==(t=null==(a=e.wxPayInfo)?void 0:a.data)?void 0:t.QRcode_url,fit:"contain"},null,8,["src"]),X])):k("v-if",!0),C("div",H,[J,C("p",null,"￥"+_(e.payInfo.totalAmount),1)]),e.wxPayInfo?k("v-if",!0):(w(),P("div",Y,[Z,C("div",ee,[(w(!0),P(T,null,D(e.payTypeList,((a,t)=>(w(),P("div",{class:j(["page-icon flex-column-center pointer",{active:t==e.payInfo.payType}]),key:a.value,onClick:o=>e.handleSelect(a,t)},[C("img",{src:e.getIcon(a.icon),style:A({backgroundColor:a.color})},null,12,te),C("span",null,_(a.label),1)],10,ae)))),128))])]))]})),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-d651c90e"],["__file","D:/project/pixel-grid/src/components/dialog/PayDialog.vue"]]),PayStatusDialog:W},props:{},emits:[],setup(e,a){const t=d(),{proxy:o}=V();let i=u({priceList:[],visible:!1,count:0,versionInfo:{subject:"",totalAmount:"",version:"",orderType:"",uid:""},buyVisible:!1,isloading:!1,loadingText:"正在加载",payStatusVisible:!1,payStatus:!1,payStatusContent:"",contactMsg:"请添加作者微信购买密钥（备注 - 像素格子）"});const n=y((()=>function(e){return 0===e?{backgroundColor:"#ebb105d9",color:"#ffffff"}:1===e?{backgroundColor:"#00a870d9",color:"#ffffff"}:2===e?{backgroundColor:"#0052d9d9",color:"#ffffff"}:3===e?{backgroundColor:"#f56c6cd9",color:"#fff"}:{backgroundColor:"#f1f1f1d9",color:"#7f7f7f"}})),l=y((()=>function(e){return 1===e?"success":2===e?"primary":3===e?"danger":void 0}));let c={async handleBuy(e,a){if(N())return t.contactAuthorVisible=!0;if(!t.checkIsLogin()){if(1===e.id&&"0"===a)return o.$message.warning("当前版本无需升级");if("0"===a)try{let n=await t.getRemoteUserInfo(o,t.userData.objectId);if(t.saveUserInfo(n),t.userData.vip==e.id-1)o.$message.warning("当前版本无需升级");else if(e.id-1>t.userData.vip){let o=i.priceList.find((e=>e.id-1==t.userData.vip)),n=o.disCountPrice?o.disCountPrice:o.price,l=e.disCountPrice?e.disCountPrice:e.price,s=n.slice(1),r=parseFloat((Number(l.slice(1))-Number(s)).toFixed(1));i.versionInfo={subject:e.label,totalAmount:String(r),version:String(e.id-1),orderType:a,uid:t.userData.uid},i.buyVisible=!0}}catch(n){o.$message.error("网络异常")}"1"===a&&(i.versionInfo={subject:`云备份数量套餐（${e.cloudBackupPrice.split("/")[1]}）`,totalAmount:e.cloudBackupPrice.split("/")[0].slice(1),version:e.cloudBackupPrice.split("/")[1].split("(")[0],orderType:a,uid:t.userData.uid},i.buyVisible=!0)}},handleOpen(e){t.contactAuthorVisible=!0},getData(){F.get(`${U()}json/price.json`).then((e=>{i.priceList=e.data})).catch((e=>{o.$message.error(e)}))},getBmobData(){const e=o.$bmob.Query("Key");e.equalTo("isUse","==","1"),e.count().then((e=>{i.count=50-(e.count-2)})).catch((e=>{}))},handleContactAuthor(e){i.contactMsg=e,t.contactAuthorVisible=!0},handleFinishPay(e){i.payStatus=e.data.status,i.payStatusContent=e.data.content,i.payStatusVisible=!0},async handleBuyStatus(){let e=window.location.search?decodeURIComponent(window.location.search.substring(1)):"";if(""===e)return;let a=z(e);if((!window.localStorage.getItem("orderNo")||window.localStorage.getItem("orderNo")!==a.out_trade_no)&&a.out_trade_no)try{i.isloading=!0,i.loadingText="正在处理订单...";const e=await o.$http.alipayVerify(window.location.search);if(e.data.status){o.$message.success(e.data.msg);let a=await t.getRemoteUserInfo(o,t.userData.objectId);t.saveUserInfo(a)}else o.$message.error(e.data.msg);i.payStatus=e.data.status,i.payStatusContent=e.data.content||e.data.msg,i.payStatusVisible=!0,i.isloading=!1,window.localStorage.setItem("orderNo",a.out_trade_no)}catch(n){o.$message.error("订单查询异常，请联系作者解决"),i.isloading=!1}}};return f((()=>{c.getData(),c.handleBuyStatus()})),r(s(s({},g(i)),c),{Download:L,editSpaceStore:t,computedStyle:n,computedType:l})}});const re=e=>($("data-v-63e8fe62"),e=e(),O(),e),ce=["element-loading-text"],pe={key:0,style:{"margin-bottom":"20px"}},de=B(" 2025/4/20 至 2025/5/5，版本限时优惠，专业版 （￥12.9/永久）高级版（￥23.9/永久） "),ue={class:"price-title flex-center"},ye={class:"flex-center price-content"},fe=[M('<div data-v-63e8fe62><div style="padding:0;" class="version" data-v-63e8fe62> 版本套餐 <div class="price-box" data-v-63e8fe62>￥价格</div></div></div><p data-v-63e8fe62>倍图(高清)导出</p><p data-v-63e8fe62>Excel图导出</p><p data-v-63e8fe62>GIF图导出</p><p data-v-63e8fe62>拼豆文件导出</p><p data-v-63e8fe62>自动备份</p><p data-v-63e8fe62>批量备份</p><p data-v-63e8fe62>项目云备份</p><p data-v-63e8fe62>云备份数量</p><p data-v-63e8fe62>颜色快捷键</p><p data-v-63e8fe62>项目分组数量</p><p data-v-63e8fe62>项目回收站</p><p data-v-63e8fe62>AI像素画</p><p data-v-63e8fe62>自定义水印Logo</p><p data-v-63e8fe62>自定义拼图宫格</p><p data-v-63e8fe62>最大拼图数量</p><p data-v-63e8fe62>服务支持</p><p style="height:44px;" data-v-63e8fe62></p>',18)],ge=["onClick"],me={style:{padding:"0"}},ve={key:0,class:"price-box"},be={key:1,class:"price-box"},he={class:"price-delete"},xe={style:{height:"44px"}},Ie=B("去升级"),we=re((()=>C("br",null,null,-1))),Ce=re((()=>C("br",null,null,-1))),ke=re((()=>C("div",{class:"price-title flex-center"},[C("h2",null,"云备份数量套餐")],-1))),Pe={class:"flex-center price-content"},Se=["onClick"],_e={style:{padding:"0","font-size":"1.2rem"},class:"price-box"},Te=B("去购买");var De=c(se,[["render",function(e,a,t,o,i,n){const l=m("InfoFilled"),s=m("el-icon"),r=m("el-tag"),c=m("el-button"),p=m("ContactAuthorDialog"),d=m("PayDialog"),u=m("PayStatusDialog"),y=E("loading");return G((w(),P("div",{class:"full-layout scrollbar routerview flex-center section-1","element-loading-text":e.loadingText,"element-loading-background":"#00000020"},[k(' <div class="section-1 flex-center"> '),(new Date).getTime()>17450784e5&&(new Date).getTime()<17463744e5?(w(),P("div",pe,[S(r,{type:"warning",effect:"dark",class:"notice-tag"},{default:b((()=>[S(s,{size:"16"},{default:b((()=>[S(l)])),_:1}),de,k(" 前50位升级版本的格子用户，享受专业版（￥9.9/永久）和高级版（￥19.9/永久）特惠价格，目前名额还剩{{count}}位！ ")])),_:1})])):k("v-if",!0),C("div",ue,[C("h2",null,_(e.$t("message.purchaseNotes")),1),k(' <p style="padding:0 30px" class="text-center">\r\n                    如有问题，请及时\r\n                    <span @click="handleOpen" style="color:#5bc939" class="pointer">联系作者</span><br/>\r\n                </p> ')]),C("div",ye,[C("div",{class:"price-item flex-center",style:A(e.computedStyle(0))},fe,4),(w(!0),P(T,null,D(e.priceList,(a=>(w(),P("div",{class:"price-item flex-center",key:a.id,onClick:t=>e.handleBuy(a,"0"),style:A(e.computedStyle(a.id))},[C("div",null,[C("p",me,[B(_(a.label)+"（永久） ",1),a.disCountPrice?(w(),P("div",be,[C("span",he,_(a.price),1),B(" "+_(a.disCountPrice),1)])):(w(),P("div",ve,_(a.price),1))])]),C("p",null,_(a.hasBeiTuExport),1),C("p",null,_(a.hasExcelExport?"√":"×"),1),C("p",null,_(a.hasGifExport?"√":"×"),1),C("p",null,_(a.customPindouExport?"√":"×"),1),C("p",null,_(a.hasAutoBackups?"√":"×"),1),C("p",null,_(a.hasBatchBackups?"√":"×"),1),C("p",null,_(a.hasCloudBackups?"√":"×"),1),C("p",null,_(a.backupsCount),1),C("p",null,_(a.hasColorKeyOptions?"√":"×"),1),C("p",null,_(a.maxProjectGroup),1),C("p",null,_(a.projectRecycle?"√":"×"),1),C("p",null,_(a.AIPixelDraw?"√":"×"),1),C("p",null,_(a.hasBorderMarkCustomLogo?"√":"×"),1),C("p",null,_(a.hasPinjieCustomGrid?"√":"×"),1),C("p",null,_(a.maxPinjieCount),1),k(" <p>{{item.hasAttrCopy ? '√' : '×'}}</p>\r\n                    <p>{{item.hasSquadPlayerCopy ? '√' : '×'}}</p>\r\n                    <p>{{item.autoSave ? '√' : '×'}}</p>\r\n                    <p>{{item.cacheItemQuantity}}</p> "),C("p",null,_(a.hasSupport),1),C("p",xe,[a.id>1?(w(),v(c,{key:0,type:e.computedType(a.id)},{default:b((()=>[Ie])),_:2},1032,["type"])):k("v-if",!0)])],12,ge)))),128))]),we,Ce,ke,C("div",Pe,[k(' <div class="price-item-first price-item flex-center">\r\n                    <div>\r\n                        <p style="font-size: 1.2rem;padding:0px">云备份数量套餐</p>\r\n                    </div>\r\n                </div> '),(w(!0),P(T,null,D(e.priceList,(a=>(w(),P("div",{class:"price-item flex-center",style:A([{gap:"10px"},e.computedStyle(a.id)]),key:a.id,onClick:t=>e.handleBuy(a,"1")},[C("div",null,[C("p",_e,_(a.cloudBackupPrice),1)]),C("div",null,[S(c,{type:e.computedType(a.id)},{default:b((()=>[Te])),_:2},1032,["type"])])],12,Se)))),128)),k(' <div class="price-item flex-center" v-for="item in priceList" :key="item.id" \r\n                :style="computedStyle(item.id)">\r\n                    <div>\r\n                        <p style="padding: 0;font-size:1.2rem" class="price-box">\r\n                            {{ item.cloudBackupPrice }}\r\n                        </p>\r\n                    </div>\r\n                </div> ')]),k(" </div> "),e.editSpaceStore.contactAuthorVisible?(w(),v(p,{key:1,visible:e.editSpaceStore.contactAuthorVisible,onClose:a[0]||(a[0]=a=>e.editSpaceStore.contactAuthorVisible=!1),msg:e.contactMsg},null,8,["visible","msg"])):k("v-if",!0),e.buyVisible?(w(),v(d,{key:2,visible:e.buyVisible,onFinish:e.handleFinishPay,onClose:a[1]||(a[1]=a=>e.buyVisible=!1),onContact:a[2]||(a[2]=a=>e.editSpaceStore.contactAuthorVisible=!0),versionInfo:e.versionInfo},null,8,["visible","onFinish","versionInfo"])):k("v-if",!0),e.payStatusVisible?(w(),v(u,{key:3,onContact:e.handleContactAuthor,content:e.payStatusContent,visible:e.payStatusVisible,onClose:a[3]||(a[3]=a=>e.payStatusVisible=!1),payStatus:e.payStatus},null,8,["onContact","content","visible","payStatus"])):k("v-if",!0)],8,ce)),[[y,e.isloading]])}],["__scopeId","data-v-63e8fe62"],["__file","D:/project/pixel-grid/src/views/price/index.vue"]]);export{De as default};
