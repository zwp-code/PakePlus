var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,o=(e,t)=>{for(var l in t||(t={}))r.call(t,l)&&s(e,l,t[l]);if(a)for(var l of a(t))c.call(t,l)&&s(e,l,t[l]);return e},n=(e,a)=>t(e,l(a));import{d as i,A as d,r as p,c as g,U as u,o as h,t as m,aB as f,i as y,S as j,K as x,aR as P,g as k,_ as w,b as v,a2 as _,l as C,O as L,j as I,n as b,h as S,P as D,ah as B,F as $,p as O,k as A,x as R,y as V,e as N,z as T,v as z,q as F,X as J}from"./index-371f133f.js";import{g as K}from"./grid-33bc5412.js";import{e as E}from"./empty-6662c720.js";var H=i({name:"recycle",components:{},props:{},emits:[],setup(e,t){const{proxy:l}=k(),a=d();let r=p({isloading:!0,searchValue:"",searchData:[],loadingText:"正在加载...",selectedProject:new Map,count:0,scrollHeight:0,isShowNoticeTag:!0,projectList:[],recycleList:[]});const c={getFrameImg:g((()=>e=>e.data?""!==e.data[0].currentFrameImg&&null!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:"/"===e.frameImg[0]?`${l.$config.HUAWEI_OBS_CONFIG.HOST}${e.frameImg}`:K:K))};let s={handleBatchCommand(e){"1"===e?s.handleBatchDeleteProject():"2"===e&&s.handleBatchRecoverProject()},handleClearAll(){s.handleAllSelect(),s.handleBatchDeleteProject()},handleReset(){if(r.selectedProject.size>0)return r.selectedProject.clear();r.searchData.length=0,r.searchValue=""},handleSelectProject(e){r.selectedProject.has(e.projectId)?r.selectedProject.delete(e.projectId):r.selectedProject.set(e.projectId,e)},handleAllSelect(){let e=r.searchData.length?r.searchData:r.projectList;for(let t=0;t<e.length;t++)r.selectedProject.set(e[t].data.projectId,e[t].data)},handleBatchDeleteProject(){var e;if(0===r.selectedProject.size)return l.$message.warning("请选择项目后删除");let t=Array.from(r.selectedProject.keys()),c=!1;for(let l=0;l<t.length;l++)if(null==(e=r.selectedProject.get(t[l]))?void 0:e.isBackup){c=!0;break}if(c)return l.$message.warning("选中项目存在已备份项目，无法执行批量删除");x.confirm("是否永久删除选中的项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{let e=[];Array.from(r.selectedProject.keys()).forEach((async t=>{let l=r.recycleList.findIndex((e=>e===r.selectedProject.get(t).projectId));r.recycleList.splice(l,1);let c=await a.deleteProjectById(r.selectedProject.get(t).projectId,!1);e.push(c)})),P.recycleList.set(JSON.stringify(r.recycleList)),Promise.all(e).then((e=>{r.selectedProject.clear(),l.$message.success("删除成功"),s.getRecycleProject()})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleBatchRecoverProject(){if(0===r.selectedProject.size)return l.$message.warning("请选择项目后删除");let e=Array.from(r.selectedProject.keys());for(let t=0;t<e.length;t++){let l=e[t],a=r.recycleList.findIndex((e=>e===r.selectedProject.get(l).projectId));r.recycleList.splice(a,1);let c=r.projectList.findIndex((e=>e===r.selectedProject.get(l).projectId));r.projectList.splice(c,1)}P.recycleList.set(JSON.stringify(r.recycleList)),a.updateProjectTip(a.originProjectList).then((e=>{a.projectList=e,l.$message.success("项目恢复成功"),r.selectedProject.clear()}))},getRecycleProject(){r.isloading=!0,r.loadingText="正在加载...";let e=P.recycleList.get()?JSON.parse(P.recycleList.get()):[];if(r.recycleList=e,e.length){let t=e.map((e=>a.originProjectList.find((t=>t.id===e)))).filter((e=>void 0!==e));a.handleProjectFrameDecompress(t).then((e=>{r.projectList=e,r.isloading=!1}))}else r.projectList=[],r.isloading=!1},handleSearch(){if(""===r.searchValue.trim())return l.$message.warning("请输入搜索内容");let e=new RegExp(r.searchValue,"i");return r.searchData=r.projectList.filter((t=>e.test(t.data.projectName))),r.searchData.length?void 0:l.$message.warning("搜索不到该项目")},handleRecoverProject:e=>new Promise(((t,c)=>{let s=r.recycleList.findIndex((t=>t===e));r.recycleList.splice(s,1),P.recycleList.set(JSON.stringify(r.recycleList));let o=r.projectList.findIndex((t=>t===e));r.projectList.splice(o,1),a.updateProjectTip(a.originProjectList).then((e=>{a.projectList=e,l.$message.success("项目恢复成功"),t(!0)}))})),handleDeleteProject(e){let{projectId:t,isBackup:c,projectName:s}=e;x.confirm("是否永久删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{let e=r.recycleList.findIndex((e=>e===t));r.recycleList.splice(e,1),P.recycleList.set(JSON.stringify(r.recycleList)),a.deleteProjectById(t,!1).then((e=>{if(e){l.$message.success("删除成功");let e=r.projectList.findIndex((e=>e===t));r.projectList.splice(e,1)}})).catch((e=>{l.$message.error("删除失败 - "+e)}))})).catch((()=>{}))}};return u((()=>{""===r.searchValue.trim()&&(r.searchData=[])})),h((()=>{s.getRecycleProject()})),n(o(n(o(o({},m(r)),s),{editSpaceStore:a,ArrowDownBold:f}),c),{isMobile:y,isSupportPaintWorklet:j})}});const U=e=>(R("data-v-518658a8"),e=e(),V(),e),W={class:"full-layout flex-center routerview scrollHidden"},M=["element-loading-text"],q={style:{padding:"10px 20px",gap:"10px"},class:"flex-start flex-warp"},G=T(" 回收站内容最多保留30个项目，超过将自动覆盖 "),X={class:"flex-between flex-warp",style:{padding:"0px 20px 10px","row-gap":"10px"}},Q=U((()=>I("h2",{class:"title flex-start flex-warp",style:{gap:"10px"}}," 回收站 ",-1))),Y={key:0,class:"flex-start flex-warp",style:{gap:"10px"}},Z=T("全 选"),ee=T("批量操作 "),te=T("批量删除"),le=T("批量恢复"),ae=T("一键清空"),re={key:1,class:"flex-start flex-warp",style:{gap:"10px"}},ce=T("全 选"),se=T("批量操作 "),oe=T("批量删除"),ne=T("批量恢复"),ie=T("一键清空"),de=["onClick"],pe=["onDblclick"],ge=["src"],ue={class:"image-slot full-h"},he=["src"],me={class:"info"},fe={class:"flex-between",style:{"padding-bottom":"5px"}},ye=["title"],je=T("恢复项目"),xe=T("删除项目"),Pe={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box",color:"#808080"}},ke={key:1,class:"full-layout flex-center scrollbar scrollAuto"};var we=w(H,[["render",function(e,t,l,a,r,c){const s=v("InfoFilled"),o=v("el-icon"),n=v("el-tag"),i=v("search"),d=v("el-input"),p=v("px-button"),g=v("arrow-down"),u=v("px-dropdown-item"),h=v("px-dropdown-menu"),m=v("px-dropdown"),f=v("el-button"),y=v("el-dropdown-item"),j=v("el-dropdown-menu"),x=v("el-dropdown"),P=v("el-skeleton-item"),k=v("el-skeleton"),w=v("el-image"),R=v("el-divider"),V=v("el-tooltip"),H=v("el-empty"),U=_("loading");return N(),C("div",W,[L((N(),C("div",{class:"full-layout flex flex-column","element-loading-text":e.loadingText,"element-loading-background":"#00000020"},[I("div",q,[L(b(n,{type:"warning",effect:"dark",class:"notice-tag",closable:"",onClose:t[0]||(t[0]=t=>e.isShowNoticeTag=!1)},{default:S((()=>[b(o,{size:"16"},{default:S((()=>[b(s)])),_:1}),G])),_:1},512),[[D,e.isShowNoticeTag]])]),I("div",X,[Q,e.isSupportPaintWorklet()?(N(),C("div",Y,[b(d,{modelValue:e.searchValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.searchValue=t),clearable:"",placeholder:e.$t("message.pleaseSearchProject"),onKeyup:B(e.handleSearch,["enter"]),style:{"max-width":"150px"}},{prefix:S((()=>[b(o,{class:"el-input__icon"},{default:S((()=>[b(i)])),_:1})])),_:1},8,["modelValue","placeholder","onKeyup"]),b(p,{round:"",type:"primary",onClick:e.handleReset},{default:S((()=>[T(z(e.$t("message.reset")),1)])),_:1},8,["onClick"]),b(p,{round:"",type:"primary",onClick:e.handleAllSelect},{default:S((()=>[Z])),_:1},8,["onClick"]),b(m,{trigger:"click",onCommand:e.handleBatchCommand},{dropdown:S((()=>[b(h,null,{default:S((()=>[b(u,{onClick:e.handleBatchDeleteProject,command:"1"},{default:S((()=>[te])),_:1},8,["onClick"]),b(u,{onClick:e.handleBatchRecoverProject,command:"2"},{default:S((()=>[le])),_:1},8,["onClick"])])),_:1})])),default:S((()=>[b(p,{round:"",type:"primary"},{default:S((()=>[ee,b(o,{class:"el-icon--right"},{default:S((()=>[b(g)])),_:1})])),_:1})])),_:1},8,["onCommand"]),b(p,{round:"",type:"danger",onClick:e.handleClearAll},{default:S((()=>[ae])),_:1},8,["onClick"])])):(N(),C("div",re,[b(d,{modelValue:e.searchValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.searchValue=t),clearable:"",placeholder:e.$t("message.pleaseSearchProject"),onKeyup:B(e.handleSearch,["enter"]),style:{"max-width":"150px"}},{prefix:S((()=>[b(o,{class:"el-input__icon"},{default:S((()=>[b(i)])),_:1})])),_:1},8,["modelValue","placeholder","onKeyup"]),b(f,{type:"primary",onClick:e.handleReset},{default:S((()=>[T(z(e.$t("message.reset")),1)])),_:1},8,["onClick"]),b(f,{type:"primary",onClick:e.handleAllSelect},{default:S((()=>[ce])),_:1},8,["onClick"]),b(x,{trigger:"click"},{dropdown:S((()=>[b(j,null,{default:S((()=>[b(y,{onClick:e.handleBatchDeleteProject},{default:S((()=>[oe])),_:1},8,["onClick"]),b(y,{onClick:e.handleBatchRecoverProject},{default:S((()=>[ne])),_:1},8,["onClick"])])),_:1})])),default:S((()=>[b(f,{type:"primary"},{default:S((()=>[se,b(o,{class:"el-icon--right"},{default:S((()=>[b(g)])),_:1})])),_:1})])),_:1}),b(f,{type:"danger",onClick:e.handleClearAll},{default:S((()=>[ie])),_:1},8,["onClick"])]))]),!e.projectList.length&&!e.searchData.length||e.isloading?e.isloading||e.searchData.length&&e.projectList.length?A("v-if",!0):(N(),C("div",ke,[b(H,{image:E,description:"空空如也","image-size":200},null,8,["image"])])):(N(),C($,{key:0},[I("div",{class:"full-layout scrollbar scrollAuto grid-box",onScroll:t[4]||(t[4]=(...t)=>e.handleScroll&&e.handleScroll(...t)),ref:"scroll"},[(N(!0),C($,null,O(e.searchData.length?e.searchData:e.projectList,(l=>(N(),C("div",{class:F([{active:e.selectedProject.has(l.id)},"project-item"]),onClick:t=>e.handleSelectProject(l.data),key:l.id},[I("div",{class:"frameImg flex-center",onDblclick:J((t=>e.handleOpenProject(l.data)),["stop"])},[""===l.data.frameImg?(N(),C("img",{key:0,src:K,class:"emptyImg"},null,8,ge)):(N(),C($,{key:1},[A(' <img :src="getFrameImg(item.data)" v-else class="previewImg"/> '),b(w,{src:e.getFrameImg(l.data),fit:"contain"},{placeholder:S((()=>[b(k,{animated:"",class:"full-layout"},{template:S((()=>[b(P,{variant:"image",style:{height:"100%"}})])),_:1})])),error:S((()=>[I("div",ue,[I("img",{src:K},null,8,he)])])),_:2},1032,["src"])],2112)),b(n,{type:"success",class:"size"},{default:S((()=>[T(z(l.data.width)+"x"+z(l.data.height),1)])),_:2},1024)],40,pe),I("div",me,[I("div",fe,[I("h4",{class:"oneline project-name",title:l.data.projectName},z(l.data.projectName),9,ye),b(x,{trigger:"click",size:"small"},{dropdown:S((()=>[b(j,null,{default:S((()=>[b(y,{onClick:t=>e.handleRecoverProject(l.id),icon:"Refresh"},{default:S((()=>[je])),_:2},1032,["onClick"]),b(y,{onClick:t=>e.handleDeleteProject(l.data),icon:"Delete"},{default:S((()=>[xe])),_:2},1032,["onClick"])])),_:2},1024)])),default:S((()=>[b(f,{type:"primary",icon:e.ArrowDownBold,size:"small",onClick:t[3]||(t[3]=J((()=>{}),["stop"])),style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),b(R,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:S((()=>[T(z(l.data.updateAt),1)])),_:2},1024),b(V,{content:l.data.desc,effect:"light"},{default:S((()=>[I("div",Pe,[A(" {{ item.desc !== '' ? $t(`message.${item.desc}`) : $t(`message.None`) }} "),T(z(l.data.desc),1)])])),_:2},1032,["content"])])],10,de)))),128))],544),A(' <div class="flex-center full-w" style="padding: 10px;" v-if="!searchData.length">\r\n                    <el-pagination\r\n                    v-model:current-page="currentPage"\r\n                    :page-size="pageSize"\r\n                    background\r\n                    layout="total, prev, pager, next"\r\n                    :total="totalCount"\r\n                    @current-change="handleCurrentChange"\r\n                    />\r\n                </div> ')],64))],8,M)),[[U,e.isloading]])])}],["__scopeId","data-v-518658a8"],["__file","D:/project/pixel-grid/src/views/recycle/index.vue"]]);export{we as default};
