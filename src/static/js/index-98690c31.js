var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,s=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&i(e,a,t[a]);if(o)for(var a of o(t))r.call(t,a)&&i(e,a,t[a]);return e},n=(e,o)=>t(e,a(o));import{d as c,y as d,r as p,o as u,t as g,b as m,e as f,f as h,h as j,j as y,k as b,l as k,x as P,p as v,n as w,F as I,q as C,A as S,u as x,s as B,g as _,ab as $,ac as A,z as D,ad as O,ae as L,af as G,ag as V,R as U,S as T,i as F,ah as N,ai as z,aj as R,P as E,Q as H,a as J,ak as M,I as q,al as Q,am as K,an as Z,a5 as Y,ao as W,aa as X,V as ee,X as te,ap as ae,v as oe,W as le}from"./index-7e9c327e.js";import{u as re}from"./useDB-d1ce478c.js";import{_ as ie}from"./plugin-vue_export-helper-46f75680.js";import{e as se,i as ne}from"./binary-50e6c5e6.js";import{g as ce,_ as de}from"./grid-429fa51c.js";import{e as pe}from"./empty-6f34f8e8.js";var ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAABiCAYAAABEZ20wAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHlSURBVHhe7d3RioMwEIVh3//ZfCdL8aYNkwQR01P4Cnu1iIvp/Gf8J67bMfjs+36MfkbHvn/n+GvXb7MY/Suw+stkMYLIYDEsxsnS2Wc1Jtq/Z/X5VYbKUBkVGTata7/9XI1RizG4l7IYHxdn9cVoKbH6/CpDZZzfudWt469b19n5VYbKUBkVGVRGUmWwtqwtN1W4OW6Km+KmSjclM2SGzJAZ34Z2tXuauS8BnhTg5hnmGURhIUrpkCQdAlMwBVMw9d06pQ23ZIbMMFwqh0vcFDfFTXFT3FR3S06aqJttpZmJvrvHE4VJolCAC3ABLsDDA5woJAqJQqKQKOy2K2nW9On7iNl9CGvL2rK2HgloOJGGSZhKwhQdQofQIXRIuA6BKZiCKZiCKWPXTvvcAtLYNWnsap5hnmGeYZ5hnmGe0bkCbUQQhUmiUIALcAEuwMMDnCgkColCopAoJAqJwv/7v7msbZK11U3ppnRTVTdFh9AhdAgdEq5DYAqmYAqmYMrY1dj1/96QSYfQId4S4C0BjcoeebnqAcinH02GKZiCKZiCqRzd8DTzW+Jdfc5cZiRlBlGYU7k2Ptv4fLLhKlPvMjn9eJWhMlRGRQaVoTJUhspoEjytgXDTl3TTZ3un7Z22dxbbO1/qp7ceqIxB2QAAAABJRU5ErkJggg==";Symbol.toStringTag;const ge=c({name:"NewProjectDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null},groupId:{type:String,default:"0"},isLocalProject:{type:Boolean,default:!1}},emits:["close","save","group","local"],setup(e,t){const a=d();re();let{proxy:o}=_(),l=p({dialogVisible:e.visible,projectGroupID:e.groupId,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:32,height:32,frameImg:"",isTop:0,isLargeCanvas:"1",tip:"新项目",data:null},isloading:!1,isCheckedRatio:!0,widthHeightRatio:1,canvasTemplate:[{id:0,width:0,height:0},{id:1,width:16,height:16},{id:3,width:32,height:32},{id:4,width:48,height:48},{id:5,width:64,height:64}],selectTemplateId:3}),r={handleChangeLargeCanvas(e){if(a.checkIsLogin())return l.itemInfo.isLargeCanvas=!e;const t=o.$bmob.Query("Test");t.equalTo("username","==",a.userData.username),t.limit(1),t.find(!1).then((t=>t.length?"undefined"==typeof OffscreenCanvas?(l.itemInfo.isLargeCanvas=!e,o.$message.warning("当前浏览器暂不支持此功能")):void(l.itemInfo.isLargeCanvas=e):(l.itemInfo.isLargeCanvas=!e,o.$message.warning("当前账号暂无内测资格")))).catch((t=>{l.itemInfo.isLargeCanvas=!e,o.$message.error("网络异常，请稍后再试")}))},handleSelectTemplate(e){l.selectTemplateId=e.id,0!==e.id&&(l.itemInfo.width=e.width,l.itemInfo.height=e.height)},handleChangeRatio(e){e&&(l.widthHeightRatio=l.itemInfo.width/l.itemInfo.height)},handleClose(){l.isloading=!1,l.dialogVisible=!1,t.emit("close")},handleChangeCanvasSize(e,t){if(e<o.$config.canvasMinSize||e>o.$config.canvasMaxSize)l.itemInfo[t]=e<o.$config.canvasMinSize?o.$config.canvasMinSize:e>o.$config.canvasMaxSize?o.$config.canvasMaxSize:l.itemInfo[t],o.$message.warning(`画布像素必须${o.$config.canvasMinSize}-${o.$config.canvasMaxSize}像素区间`);else{if(!l.itemInfo.isLargeCanvas&&e>150)return l.itemInfo[t]=150,o.$message.warning("画布过大，请启用大画布模式");l.itemInfo[t]=Number(e)}l.isCheckedRatio&&("width"===t?l.itemInfo.height=parseInt(l.itemInfo[t]/l.widthHeightRatio):l.itemInfo.width=parseInt(l.itemInfo[t]/l.widthHeightRatio));let a=l.canvasTemplate.find((e=>e.width===l.itemInfo.width&&e.height===l.itemInfo.height));l.selectTemplateId=a?a.id:0},handleAddGroup(o){a.addProjectToGroup(e.groupId,l.projectGroupID,o),t.emit("group")},handleConfirm(){o.$refs.form.validate((i=>{if(i){if(l.isloading=!0,e.editInfo&&e.isLocalProject)return l.itemInfo.updateAt=S(),l.itemInfo.tip="最近编辑",void t.emit("local",l.itemInfo,(()=>r.handleClose()));if(e.editInfo)return r.handleAddGroup(l.itemInfo.projectId),l.itemInfo.updateAt=S(),l.itemInfo.tip="最近编辑",void a.saveProject(l.itemInfo,!0).then((e=>{e&&(l.isloading=!1,r.handleClose(),o.$message.success(o.$t("message.saveSucceeded")))})).catch((e=>{l.isloading=!1,o.$message.error(o.$t("message.saveFailed"))}));if(l.itemInfo.projectId=x.v1(),e.isLocalProject)return l.itemInfo.createAt=S(),l.itemInfo.updateAt=l.itemInfo.createAt,void t.emit("local",l.itemInfo,(()=>r.handleClose()));r.handleAddGroup(l.itemInfo.projectId),l.itemInfo.createAt=S(),l.itemInfo.updateAt=l.itemInfo.createAt,a.saveProject(l.itemInfo,!0).then((e=>{e&&(o.$message.success(o.$t("message.newSucceeded")),l.isloading=!1,r.handleClose(),t.emit("save",l.itemInfo))})).catch((e=>{o.$message.error(o.$t("message.newFailed")),l.isloading=!1}))}else o.$message.warning("请填写参数")}))}};return u((()=>{e.editInfo&&(l.itemInfo=e.editInfo)})),n(s(s({},g(l)),r),{editSpaceStore:a})}}),me={class:"flex-between full-w"},fe={style:{"margin-left":"20px"}},he={key:1,class:"flex-between full-w",style:{gap:"5px","margin-top":"10px"}},je=["onClick"],ye=["src"],be={class:"full-w size flex-center"},ke={class:"dialog-footer"};var Pe=ie(ge,[["render",function(e,t,a,o,l,r){const i=m("el-input"),s=m("el-form-item"),n=m("el-checkbox"),c=m("el-tag"),d=m("el-option"),p=m("el-select"),u=m("el-form"),g=m("el-button"),S=m("el-dialog");return f(),h(S,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=t=>e.dialogVisible=t),title:e.editInfo?e.$t("message.editProject"):e.$t("message.newProject"),width:350,"before-close":e.handleClose,"close-on-click-modal":!1,"lock-scroll":!1,class:"z-dialog",center:""},{footer:j((()=>[y("span",ke,[b(g,{onClick:e.handleClose},{default:j((()=>[k(P(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),b(g,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:j((()=>[k(P(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:j((()=>[b(u,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,model:e.itemInfo},{default:j((()=>[e.editInfo?(f(),h(s,{key:0,label:"项目ID"},{default:j((()=>[b(i,{modelValue:e.itemInfo.projectId,"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemInfo.projectId=t),disabled:""},null,8,["modelValue"])])),_:1})):v("",!0),b(s,{label:"项目名称",required:"",prop:"projectName"},{default:j((()=>[b(i,{modelValue:e.itemInfo.projectName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemInfo.projectName=t),clearable:"",placeholder:"请输入",maxlength:"20"},null,8,["modelValue"])])),_:1}),b(s,{label:"画布大小",required:""},{default:j((()=>[y("div",me,[b(i,{modelValue:e.itemInfo.width,"onUpdate:modelValue":t[2]||(t[2]=t=>e.itemInfo.width=t),type:"number",size:"small",disabled:e.editInfo,max:e.$config.canvasMaxSize,min:e.$config.canvasMinSize,onChange:t[3]||(t[3]=t=>e.handleChangeCanvasSize(t,"width"))},{prepend:j((()=>t[10]||(t[10]=[k("宽")]))),_:1},8,["modelValue","disabled","max","min"]),b(i,{modelValue:e.itemInfo.height,"onUpdate:modelValue":t[4]||(t[4]=t=>e.itemInfo.height=t),style:{"margin-left":"10px"},type:"number",size:"small",disabled:e.editInfo,max:e.$config.canvasMaxSize,min:e.$config.canvasMinSize,onChange:t[5]||(t[5]=t=>e.handleChangeCanvasSize(t,"height"))},{prepend:j((()=>t[11]||(t[11]=[k("高")]))),_:1},8,["modelValue","disabled","max","min"]),y("div",fe,[b(n,{modelValue:e.isCheckedRatio,"onUpdate:modelValue":t[6]||(t[6]=t=>e.isCheckedRatio=t),disabled:e.editInfo,label:"保持横纵比",onChange:e.handleChangeRatio},null,8,["modelValue","disabled","onChange"])])]),e.editInfo?v("",!0):(f(),h(c,{key:0,type:"info",style:{"margin-top":"10px"}},{default:j((()=>[k("目前画布最大支持 "+P(e.$config.canvasMaxSize)+"*"+P(e.$config.canvasMaxSize)+" 大小",1)])),_:1})),e.editInfo?v("",!0):(f(),w("div",he,[(f(!0),w(I,null,C(e.canvasTemplate,(a=>(f(),w("div",{key:a.label,class:B(["template-box pointer",{active:e.selectTemplateId===a.id}]),onClick:t=>e.handleSelectTemplate(a)},[y("img",{src:ue},null,8,ye),y("div",be,[0!==a.id?(f(),h(c,{key:0,type:"success",size:"small"},{default:j((()=>[k(P(a.width)+"*"+P(a.height),1)])),_:2},1024)):(f(),h(c,{key:1,type:"primary",size:"small"},{default:j((()=>t[12]||(t[12]=[k("自定义")]))),_:1,__:[12]}))])],10,je)))),128))]))])),_:1}),e.isLocalProject?v("",!0):(f(),h(s,{key:1,label:"项目分组"},{default:j((()=>[b(p,{modelValue:e.projectGroupID,"onUpdate:modelValue":t[7]||(t[7]=t=>e.projectGroupID=t),placeholder:"请选择项目分组"},{default:j((()=>[(f(!0),w(I,null,C(e.editSpaceStore.projectGroupList,(e=>(f(),h(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),b(s,{label:"项目描述"},{default:j((()=>[b(i,{modelValue:e.itemInfo.desc,"onUpdate:modelValue":t[8]||(t[8]=t=>e.itemInfo.desc=t),placeholder:"请输入",type:"textarea",maxlength:"30","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-2b7db860"]]);const ve=c({name:"UploadFileDialog",components:{},props:{visible:{type:Boolean,default:!1}},emits:["close","reload"],setup(e,t){const{proxy:a}=_();let o=p({loading:!1,dialogVisible:e.visible,fileList:[],fileListTemp:[],imageTypes:["image/jpeg","image/png","image/gif","image/bmp","image/svg+xml"]}),l={handleClose(){o.dialogVisible=!1,t.emit("close")},handleConfirm(){if(!o.fileList.length)return a.$message.warning("上传文件不能为空");t.emit("close"),t.emit("reload",o.fileList)},handleChange(e,t){if(o.fileList=t,!["application/json","application/x-zip-compressed"].includes(e.raw.type)&&!e.raw.name.endsWith(".px")){let t=o.fileList.findIndex((t=>t.uid===e.uid));return o.fileList.splice(t,1),void a.$message.warning("导入文件格式不正确")}if("application/x-zip-compressed"===e.raw.type){let t=[];(new $).loadAsync(e.raw).then((l=>{let r=Object.keys(l.files),i=[];for(let e=0;e<r.length;e++)if("json"===A(l.files[r[e]].name)){let a=l.files[r[e]].async("blob").then((function(a){let o=new File([a],l.files[r[e]].name,{type:"application/json"});t.push(o)}));i.push(a)}else if("px"===A(l.files[r[e]].name)){let a=l.files[r[e]].async("blob").then((function(a){let o=new File([a],l.files[r[e]].name,{type:"application/octet-stream"});t.push(o)}));i.push(a)}let s=o.fileList.findIndex((t=>t.uid===e.uid));o.fileList.splice(s,1),Promise.all(i).then((e=>{if(0===t.length)return a.$message.warning("压缩包不存在对应项目文件或项目文件格式不正确");for(let a=0;a<t.length;a++)o.fileList.push(t[a])}))}))}}};return s(s({},g(o)),l)}}),we={class:"dialog-footer"};var Ie=ie(ve,[["render",function(e,t,a,o,l,r){const i=m("upload-filled"),s=m("el-icon"),n=m("el-upload"),c=m("el-button"),d=m("el-dialog");return f(),h(d,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dialogVisible=t),title:"导入项目","before-close":e.handleClose,"close-on-click-modal":!1,"lock-scroll":!1,class:"z-dialog",center:"",width:350},{footer:j((()=>[y("span",we,[b(c,{onClick:e.handleClose},{default:j((()=>[k(P(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),b(c,{type:"primary",onClick:e.handleConfirm,loading:e.loading},{default:j((()=>[k(P(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:j((()=>[b(n,{ref:"uploadRef",class:"content",drag:"",multiple:"","auto-upload":!1,accept:".json,.zip,.px","on-change":e.handleChange,"file-list":e.fileList,"onUpdate:fileList":t[0]||(t[0]=t=>e.fileList=t)},{tip:j((()=>t[2]||(t[2]=[y("div",{class:"el-upload__tip text-center"}," 支持上传多个.json 或 .px为后缀的项目文件或.zip项目压缩包 ",-1)]))),default:j((()=>[b(s,{class:"el-icon--upload"},{default:j((()=>[b(i)])),_:1}),t[3]||(t[3]=y("div",{class:"el-upload__text"},[y("em",null,"点击这里上传")],-1))])),_:1,__:[3]},8,["on-change","file-list"])])),_:1},8,["modelValue","before-close"])}],["__scopeId","data-v-d504571c"]]);const Ce=c({name:"PublishDialog",components:{},props:{visible:{type:Boolean,default:!1},editInfo:{type:Object,default:null}},emits:["close","save"],setup(e,t){const a=d(),o=D();re();let{proxy:l}=_(),r=p({uploadUrl:"/api/1/upload",dialogVisible:e.visible,itemInfo:{projectName:"",desc:"",createAt:"",updateAt:"",projectId:"",width:"32",height:"32",frameImg:"",isTop:"0",tip:"",data:null},projectOptions:{isPass:"0",author:"",authorAvatar:"",projectName:"",projectId:"",desc:"-",width:"32",height:"32",frameImg:"",isTop:"0",tip:"",tag:"0",authorId:"",authorUid:"",source:["0"],activityCode:"0",createAt:""},imageTypes:["image/jpeg","image/jpg","image/png","image/gif"],fileList:[],fileHeader:{"X-API-Key":l.$config.PICGO_KEY},poster:"",isloading:!1,deletePosterUrl:"",progressValue:0,posterFile:null}),i={handleChangeActivity:e=>r.projectOptions.source.includes("0")?(r.projectOptions.activityCode="0",l.$message.warning("请确保项目是原创作品！")):Number(r.projectOptions.width)>100||Number(r.projectOptions.height)>100?(r.projectOptions.activityCode="0",l.$message.warning("请确保项目画布尺寸小于100")):""===r.projectOptions.tip?l.$message.warning("请确保项目画布尺寸小于100"):void 0,handleChangeProjectTag(e){"1"===r.projectOptions.tag&&(r.projectOptions.tip="动画")},handleBeforeUploadPoster:e=>r.imageTypes.includes(e.type)?!(e.size/1024/1024>l.$config.MAX_UPLOAD_SIZE)||(l.$message.warning("上传图片封面大小不能超过500kb！"),!1):(l.$message.warning("上传图片封面格式不正确！"),!1),handleErrorUploadPoster(e,t){l.$message.error("上传封面失败"),r.isloading=!1},handleSuccessUploadPoster(e,t){},handleExceedUploadPoster(e,t){o.value.clearFiles();const a=e[0];a.uid=L(),o.value.handleStart(a)},handleChangeUploadPoster(e,t){r.poster=URL.createObjectURL(e.raw),r.posterFile=e},handleUploadFileToOBS(e){const t=JSON.stringify(r.itemInfo),a=new Blob([t],{type:""});G(a,`${r.projectOptions.projectId}.json`,(t=>{i.handleBmobPublish(e)}),(t=>{l.$message.error(t),i.handleDeletePoster(e)}),(e=>{r.progressValue=e}))},handleUploadPosterToOBS(e){r.projectOptions.projectId=x.v1();let t=A(e.name),a=`${r.projectOptions.projectId}.${t}`;G(e.raw,a,(e=>{i.handleUploadFileToOBS("/"+a)}),(e=>{r.isloading=!1,l.$message.error(e)}),(e=>{}))},async handleBmobPublish(e){r.projectOptions.frameImg=e,r.projectOptions.author=a.userData.nickname,r.projectOptions.authorId=a.userData.username,r.projectOptions.authorUid=a.userData.uid,r.projectOptions.authorAvatar=a.userData.avatar||"",r.projectOptions.createAt=S();const t=l.$bmob.Query("Resource");let o=Object.keys(r.projectOptions);for(let a=0;a<o.length;a++){let e=o[a];"source"!==e?("desc"===e&&(r.projectOptions[e]=r.projectOptions[e].trim()),t.set(e,r.projectOptions[e])):(r.projectOptions[e].sort(((e,t)=>e-t)),t.set(e,r.projectOptions[e].join(",")))}t.save().then((e=>{r.isloading=!1,l.$message.success("发布成功，已提交审核"),URL.revokeObjectURL(r.poster),i.handleClose()})).catch((t=>{i.handleDeleteToOBS(),i.handleDeletePoster(e),l.$message.error("发布失败"),URL.revokeObjectURL(r.poster),a.saveErrorToBmob("发布项目",t)}))},handleDeletePoster(e){let t=e.slice(1);V(t,(e=>{r.isloading=!1}),(e=>{r.isloading=!1}))},handleDeleteToOBS(){V(`${r.projectOptions.projectId}.json`,(e=>{}),(e=>{}))},handleClose(){r.dialogVisible=!1,t.emit("close")},handleConfirm(){l.$refs.form.validate((async e=>{if(e){if(""===r.poster)return l.$message.warning("请上传封面");if("1"===r.projectOptions.activityCode){if(!r.projectOptions.source.includes("1"))return l.$message.warning("请确保项目是原创作品！");if(Number(r.projectOptions.width)>100||Number(r.projectOptions.height)>100)return l.$message.warning("请确保项目画布尺寸小于100");if(""===r.projectOptions.tip)return l.$message.warning("请填写联系方式");if(""===r.projectOptions.desc)return l.$message.warning("请填写项目描述")}if(r.isloading=!0,"1"===r.projectOptions.activityCode){const e=l.$bmob.Query("Resource");e.equalTo("authorUid","==",a.userData.uid),e.equalTo("activityCode","==","1");if((await e.find()).results.length)return r.isloading=!1,l.$message.warning("你已经参与过此次活动了!")}i.handleBeforeUploadPoster(r.posterFile.raw)?i.handleUploadPosterToOBS(r.posterFile):r.isloading=!1}else l.$message.warning("请填写参数")}))}};return u((()=>{if(e.editInfo){if(r.itemInfo=e.editInfo,r.itemInfo.frameImg="@",r.itemInfo.tip="",r.itemInfo.isTop=0,delete r.itemInfo.isBackup,delete r.itemInfo.backupUpdatedAt,delete r.itemInfo.authorUid,r.itemInfo.data&&r.itemInfo.data.length&&r.itemInfo.data[0].currentFrameImg){let e=O(r.itemInfo.data[0].currentFrameImg);r.poster=URL.createObjectURL(e),r.posterFile={name:"frame0.png",raw:new File([e],"frame0",{type:"image/png"})}}r.projectOptions.desc=r.itemInfo.desc,r.projectOptions.projectName=r.itemInfo.projectName,r.projectOptions.width=String(r.itemInfo.width),r.projectOptions.height=String(r.itemInfo.height),r.projectOptions.activityCode=r.itemInfo.activityCode}})),n(s(s({},g(r)),i),{uploadRef:o})}}),Se={key:1,class:"poster flex-center"},xe=["src"],Be={key:0,class:"el-upload__tip"},_e={class:"dialog-footer"};var $e=ie(Ce,[["render",function(e,t,a,o,l,r){const i=m("upload-filled"),s=m("el-icon"),n=m("el-upload"),c=m("el-input"),d=m("el-form-item"),p=m("el-option"),u=m("el-select"),g=m("el-form"),C=m("el-progress"),S=m("el-button"),x=m("el-dialog");return f(),h(x,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=t=>e.dialogVisible=t),title:"1"===e.projectOptions.activityCode?"投稿作品":"发布项目",width:350,"before-close":e.handleClose,"lock-scroll":!1,"close-on-click-modal":!1,class:"z-dialog",center:""},{footer:j((()=>[y("span",_e,[b(S,{onClick:e.handleClose},{default:j((()=>[k(P(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),b(S,{type:"primary",onClick:e.handleConfirm,loading:e.isloading},{default:j((()=>[k(P(e.$t("message.confirm")),1)])),_:1},8,["onClick","loading"])])])),default:j((()=>[b(n,{ref:"uploadRef",class:"flex-column-center",drag:"",action:e.uploadUrl,"auto-upload":!1,"show-file-list":!1,accept:".png,.jpg,.jpeg,.gif",name:"source",limit:1,method:"post",headers:e.fileHeader,"file-list":e.fileList,"onUpdate:fileList":t[0]||(t[0]=t=>e.fileList=t),"on-success":e.handleSuccessUploadPoster,"before-upload":e.handleBeforeUploadPoster,"on-error":e.handleErrorUploadPoster,"on-exceed":e.handleExceedUploadPoster,"on-change":e.handleChangeUploadPoster,disabled:"1"===e.projectOptions.activityCode},{tip:j((()=>["0"===e.projectOptions.activityCode?(f(),w("div",Be," 上传小于500KB的jpg/png/gif文件作为封面 ")):v("",!0)])),default:j((()=>[""===e.poster?(f(),w(I,{key:0},[b(s,{class:"el-icon--upload"},{default:j((()=>[b(i)])),_:1}),t[7]||(t[7]=y("div",{class:"el-upload__text"},[k(" 拖拽文件到这 或者 "),y("em",null,"点击这里上传")],-1))],64)):(f(),w("div",Se,[y("img",{src:e.poster,style:{"object-fit":"contain"},draggable:"false"},null,8,xe)]))])),_:1},8,["action","headers","file-list","on-success","before-upload","on-error","on-exceed","on-change","disabled"]),b(g,{ref:"form","label-position":"top","label-width":"100px","show-message":!1,class:"scrollbar scrollY",style:{"margin-top":"10px","max-height":"300px",padding:"0 10px"},model:e.projectOptions},{default:j((()=>[b(d,{label:"项目名称",required:"",prop:"projectName"},{default:j((()=>[b(c,{modelValue:e.projectOptions.projectName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.projectOptions.projectName=t),clearable:"",placeholder:"请输入项目名称",maxlength:"20"},null,8,["modelValue"])])),_:1}),b(d,{label:"项目标签"},{default:j((()=>[b(u,{modelValue:e.projectOptions.tag,"onUpdate:modelValue":t[2]||(t[2]=t=>e.projectOptions.tag=t),placeholder:"请选择项目标签",onChange:e.handleChangeProjectTag},{default:j((()=>[b(p,{label:"静态",value:"0"}),b(p,{label:"动态",value:"1"})])),_:1},8,["modelValue","onChange"])])),_:1}),b(d,{label:"项目来源"},{default:j((()=>[b(u,{modelValue:e.projectOptions.source,"onUpdate:modelValue":t[3]||(t[3]=t=>e.projectOptions.source=t),placeholder:"请选择项目来源","multiple-limit":2,"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,multiple:""},{default:j((()=>[b(p,{label:"临摹",value:"0",disabled:e.projectOptions.source.includes("1")},null,8,["disabled"]),b(p,{label:"原创",value:"1",disabled:e.projectOptions.source.includes("0")},null,8,["disabled"]),b(p,{label:"二创",value:"2"})])),_:1},8,["modelValue"])])),_:1}),"1"===e.projectOptions.activityCode?(f(),h(d,{key:0,label:"联系方式",required:"",prop:"tip"},{default:j((()=>[b(c,{modelValue:e.projectOptions.tip,"onUpdate:modelValue":t[4]||(t[4]=t=>e.projectOptions.tip=t),clearable:"",placeholder:"请输入联系方式",maxlength:"20"},null,8,["modelValue"])])),_:1})):v("",!0),b(d,{label:"项目描述"},{default:j((()=>[b(c,{modelValue:e.projectOptions.desc,"onUpdate:modelValue":t[5]||(t[5]=t=>e.projectOptions.desc=t),placeholder:"请输入项目描述",type:"textarea",maxlength:"100","show-word-limit":"",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"]),t[8]||(t[8]=y("p",{style:{"line-height":"1.5","font-size":"12px","margin-top":"5px"},class:"text-grey"},"注：如需艾特原创作者可通过 @原创作者名称[原创作者链接地址] 标明",-1))])),_:1,__:[8]})])),_:1},8,["model"]),e.progressValue>0?(f(),h(C,{key:0,"text-inside":!0,"stroke-width":20,percentage:e.progressValue,status:"success"},null,8,["percentage"])):v("",!0)])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-15d99ba8"]]);const Ae=c({name:"AddProjectGroupDialog",components:{},props:{visible:{type:Boolean,default:!1},editData:{type:Object,default:null},isSelectGroup:{type:Boolean,default:!1}},emits:["close","add"],setup(e,t){const{proxy:a}=_(),o=d();let l=p({loading:!1,dialogVisible:e.visible,form:{group:{value:"",list:[],label:"",desc:""}},projectGroupID:"0"}),r={handleClose(){l.dialogVisible=!1,t.emit("close")},async handleConfirm(){if(e.isSelectGroup)return t.emit("add",l.projectGroupID),void r.handleClose();!e.editData&&o.checkVipFunction("projectGroup",o.projectGroupList.length,!0,!1)||a.$refs.form.validate((t=>{t?(l.loading=!0,!e.editData&&(l.form.group.value=x.v4()),o.saveProjectGroup(l.form.group),l.loading=!1,r.handleClose()):a.$message.warning("请填写参数")}))}};return u((()=>{e.editData&&(l.form.group=e.editData)})),n(s(s({},g(l)),r),{editSpaceStore:o})}}),De={class:"dialog-footer"};var Oe=c({name:"project",components:{NewProjectDialog:Pe,UploadFileDialog:Ie,PublishDialog:$e,AddProjectGroupDialog:ie(Ae,[["render",function(e,t,a,o,l,r){const i=m("el-input"),s=m("el-form-item"),n=m("el-option"),c=m("el-select"),d=m("el-form"),p=m("el-button"),u=m("el-dialog");return f(),h(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=t=>e.dialogVisible=t),title:e.isSelectGroup?"选择分组":e.editData?"编辑分组":"新增分组","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:j((()=>[y("span",De,[b(p,{onClick:e.handleClose},{default:j((()=>t[4]||(t[4]=[k("取 消")]))),_:1,__:[4]},8,["onClick"]),b(p,{type:"primary",onClick:e.handleConfirm,loading:e.loading},{default:j((()=>t[5]||(t[5]=[k("确 定")]))),_:1,__:[5]},8,["onClick","loading"])])])),default:j((()=>[b(d,{ref:"form",model:e.form.group,"label-position":"top"},{default:j((()=>[e.isSelectGroup?v("",!0):(f(),h(s,{key:0,label:"分组名称",required:"",prop:"label"},{default:j((()=>[b(i,{modelValue:e.form.group.label,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.group.label=t),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])])),_:1})),e.isSelectGroup?v("",!0):(f(),h(s,{key:1,label:"分组描述"},{default:j((()=>[b(i,{modelValue:e.form.group.desc,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.group.desc=t),placeholder:"请输入描述",clearable:""},null,8,["modelValue"])])),_:1})),e.isSelectGroup?(f(),h(s,{key:2,label:"选择分组"},{default:j((()=>[b(c,{modelValue:e.projectGroupID,"onUpdate:modelValue":t[2]||(t[2]=t=>e.projectGroupID=t),placeholder:"请选择项目分组"},{default:j((()=>[(f(!0),w(I,null,C(e.editSpaceStore.projectGroupList,(e=>(f(),h(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):v("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue","title","before-close"])}]])},props:{},emits:[],setup(e,t){const{proxy:a}=_(),o=d();let l=p({isExporting:!1,NewProjectVisible:!1,PublishProjectVisible:!1,editProjectInfo:null,isloading:!0,searchValue:"",searchData:[],loadingText:"正在加载...",isBackupsing:!1,backupsProjectId:"",selectedProject:new Map,UploadFileVisible:!1,count:0,scrollHeight:0,currentPage:1,pageSize:20,totalCount:0,backupsProjectOptions:{id:null,projectName:"",projectId:"",desc:"-",width:"32",height:"32",isTop:"0",authorUid:"",createAt:"",updateAt:"",backupUpdatedAt:""},isPullBackupsing:!1,alreadySyncBackup:0,syncBackupArr:[],isShowNoticeTag:!0,isExpandGroup:!1,searchGroup:"",searchGroupData:[],currentGroup:"0",projectGroupVisible:!1,projectList:[],projectGroupData:null,isSelectGroup:!1,isLocalProject:!1,currentDirectoryHandle:null,currentFileHandle:null,directoryStack:[]});const r={getFrameImg:J((()=>e=>e.data?""!==e.data[0].currentFrameImg&&null!==e.data[0].currentFrameImg?e.data[0].currentFrameImg:"/"===e.frameImg[0]?`${a.$config.HUAWEI_OBS_CONFIG.HOST}${e.frameImg}`:ce:ce)),getGroupImg:J((()=>e=>{if(!e.list.length){if("0"===e.value){return o.projectList.slice(0,1).map((e=>{var t,a,o;return(null==(t=e.data)?void 0:t.data)&&(null==(a=e.data)?void 0:a.data.length)&&(null==(o=e.data)?void 0:o.data[0].currentFrameImg)||""}))[0]}return""}return e.list.slice(0,1).map((e=>{var t,a,l;const r=o.projectList.find((t=>t.id===e));return r&&(null==(t=r.data)?void 0:t.data)&&(null==(a=r.data)?void 0:a.data.length)&&(null==(l=r.data)?void 0:l.data[0].currentFrameImg)||""}))[0]})),getProjectList:J((()=>o.projectList.slice(l.pageSize*l.currentPage-l.pageSize,l.pageSize*l.currentPage))),checkBackupCount:J((()=>{var e,t;let a=(null==(e=o.userData)?void 0:e.backupCount)||"0",l=(null==(t=o.userData)?void 0:t.vip)||"0",r=a/(Number(o.versionInfoData[Number(l)].count)+Number(o.userData.extraBackupCount||0));return r<=.5?"success":r>.5&&r<=.75?"warning":"danger"}))};let i={handleBatchCommand(e){"1"===e?i.handleBatchDeleteProject():"2"===e?i.handleBatchExportProject():"3"===e?i.handleBatchBackupProject():"4"===e&&(l.projectGroupVisible=!0,l.isSelectGroup=!0)},handleCurrentChange(e){l.currentPage=e,l.scrollHeight=0,i.getProjectByGroup(),M((()=>{let e=a.$refs.scroll;e&&(e.scrollTop=l.scrollHeight)}))},handleScroll(e){l.scrollHeight=e.target.scrollTop},handleReset(){if(l.selectedProject.size>0)return l.selectedProject.clear();l.searchData.length=0,l.searchValue=""},handleSelectProject(e){l.selectedProject.has(e.projectId)?l.selectedProject.delete(e.projectId):l.selectedProject.set(e.projectId,e)},handleAllSelect(){let e=l.searchData.length?l.searchData:l.projectList;for(let t=0;t<e.length;t++)l.selectedProject.set(e[t].data.projectId,e[t].data)},handleBatchExportProject(){if(0===l.selectedProject.size)return a.$message.warning("请选择项目后导出");q.prompt("请输入导出的文件名称","批量导出项目",{confirmButtonText:"确 认",cancelButtonText:"取 消"}).then((async({value:e})=>{const t=new $;let o=0;Array.from(l.selectedProject.keys()).forEach((r=>{let i=l.selectedProject.get(r).projectName;const s=JSON.stringify(l.selectedProject.get(r)),n=new Blob([s],{type:""});t.file(`${i}.json`,n,{blob:!0}),o++,o>=l.selectedProject.size&&t.generateAsync({type:"blob"}).then((t=>{Q.saveAs(t,`${e}.zip`),a.$message.success("导出成功"),l.selectedProject.clear()}))}))})).catch((e=>{}))},handleBatchDeleteProject(){var e;if(0===l.selectedProject.size)return a.$message.warning("请选择项目后删除");let t=Array.from(l.selectedProject.keys()),r=!1;for(let a=0;a<t.length;a++)if(null==(e=l.selectedProject.get(t[a]))?void 0:e.isBackup){r=!0;break}if(r)return a.$message.warning("选中项目存在已备份项目，无法执行批量删除");q.confirm("是否删除选中的项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{let e=[];Array.from(l.selectedProject.keys()).forEach((async t=>{o.deleteProjectToGroup(l.currentGroup,l.selectedProject.get(t).projectId);let a=await o.deleteProjectById(l.selectedProject.get(t).projectId);e.push(a)})),Promise.all(e).then((e=>{l.selectedProject.clear(),a.$message.success("删除成功"),i.getProjectByGroup()})).catch((e=>{a.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},async handleBatchBackupProject(){if(o.checkVipFunction("batchBackup"))return;if(0===l.selectedProject.size)return a.$message.warning("请选择项目后备份");l.isPullBackupsing=!0;let e=Array.from(l.selectedProject.keys());for(let t=0;t<e.length;t++)await i.handleBackupProject(l.selectedProject.get(e[t])),l.selectedProject.delete(l.selectedProject.get(e[t]).projectId);l.isPullBackupsing=!1},handleCheckBackups(e=!0){var t,r,s;if(!(null==(t=o.userData)?void 0:t.browserId)||"0"===(null==(r=o.userData)?void 0:r.browserId)||(null==(s=o.userData)?void 0:s.browserId)===o.browserId)return e?a.$message.warning("暂无可同步备份"):"";if(l.alreadySyncBackup==o.userData.backupCount)return e?a.$message.warning("暂无可同步备份"):"";const n=a.$bmob.Query("Backups");n.equalTo("authorUid","==",o.userData.uid),n.count().then((e=>{e.count>0&&q.confirm("检测到有可同步的项目备份文件，是否同步至本地？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{i.handlePullBackups()})).catch((()=>{}))})).catch((e=>{a.$message.warning("网络异常")}))},async handlePullBackups(){var e,t,r;if((null==(e=o.userData)?void 0:e.browserId)&&"0"!==(null==(t=o.userData)?void 0:t.browserId)&&(null==(r=o.userData)?void 0:r.browserId)!==o.browserId){if(l.syncBackupArr.length&&l.alreadySyncBackup!==o.userData.backupCount)return void i.handlePullBackupFileBySyncData();let e=100,t=0;const r=a.$bmob.Query("Backups");r.equalTo("authorUid","==",o.userData.uid),r.limit(e);for(let i=0;i<Math.ceil(o.userData.backupCount/e);i++)try{r.skip(i*e);const a=await r.find();t=a.count,l.syncBackupArr=[...l.syncBackupArr,...a.results]}catch(s){a.$message.error("备份拉取失败")}i.handlePullBackupFileBySyncData()}else a.$message.warning("暂无可同步备份")},async handlePullBackupFileBySyncData(){if(!l.syncBackupArr.length)return;let e=l.syncBackupArr.filter((e=>!o.projectList.some((t=>t.data.backupUpdatedAt&&t.data.backupUpdatedAt==e.backupUpdatedAt&&t.data.projectId===e.projectId))));if(0===e.length)return l.alreadySyncBackup=o.userData.backupCount,void i.handleUpdateUserBrowserId();l.alreadySyncBackup=l.syncBackupArr.length-e.length;for(let r=0;r<e.length;r++)try{const t=await i.handlePullBackupFile(e[r].projectId);let s=await K(t);s&&(s.isBackup=!0,o.saveProject(s).then((t=>{t&&(l.alreadySyncBackup++,a.$message.success("项目（"+e[r].projectName+"）同步成功"),l.alreadySyncBackup==o.userData.backupCount&&i.handleUpdateUserBrowserId())})).catch((t=>{a.$message.error("项目（"+e[r].projectName+"）同步失败")})))}catch(t){a.$message.error("项目（"+e[r].projectName+"）同步失败")}},handleUpdateUserBrowserId(){o.updateUserInfo(a,{browserId:o.browserId},(async()=>{}),(e=>{}))},handlePullBackupFile:async e=>new Promise(((t,a)=>{Z(`${o.userData.uid}/${e}.json`,(e=>{t(e)}),(e=>{a(e)}))})),getProjectByGroup(){var e;if(l.isloading=!0,l.loadingText="正在加载...","0"===l.currentGroup)return l.totalCount=o.projectList.length,l.projectList=o.projectList.slice(l.pageSize*l.currentPage-l.pageSize,l.pageSize*l.currentPage),void(l.isloading=!1);let t=null==(e=o.projectGroupList.find((e=>e.value===l.currentGroup)))?void 0:e.list;t.length||(l.projectList=[],l.totalCount=l.projectList.length,l.isloading=!1);const a=t.map((e=>o.projectList.find((t=>t.id===e))));l.projectList=a.slice(l.pageSize*l.currentPage-l.pageSize,l.pageSize*l.currentPage),l.totalCount=l.projectList.length,l.isloading=!1},handleSearch(){if(""===l.searchValue.trim())return a.$message.warning("请输入搜索内容");let e=new RegExp(l.searchValue,"i");return l.searchData=o.projectList.filter((t=>e.test(t.data.projectName))),l.searchData.length?void 0:a.$message.warning("搜索不到该项目")},async handleOpenProject(e){if(e.type&&"folder"===e.type)return l.directoryStack.push(e.entry),l.currentDirectoryHandle=e.entry,o.localProjectList=[],void(await i.populateFolderGrid(e.entry));if(e.type&&"file"===e.type){let t=e.data;return l.currentFileHandle=e.entry,t.isLargeCanvas&&"1"===t.isLargeCanvas?(l.isloading=!0,l.loadingText="正在打开本机项目",void a.$router.push({name:"draw",params:{projectId:"B"+t.projectId}})):(t.isLargeCanvas="1",l.isloading=!0,l.loadingText="正在打开本机项目",void a.$router.push({name:"draw",params:{projectId:"B"+t.projectId}}))}if(!e.isLargeCanvas||"1"!==e.isLargeCanvas)return e.updateAt=S(),e.tip="最近编辑",e.isLargeCanvas="1",void o.saveProject(e,!0).then((t=>{t&&(l.isloading=!0,l.loadingText="正在打开项目",a.$router.push({name:"draw",params:{projectId:"A"+e.projectId}}))})).catch((e=>{a.$message.error("项目打开异常")}));l.isloading=!0,l.loadingText="正在打开项目",a.$router.push({name:"draw",params:{projectId:"A"+e.projectId}})},async handleTopProject(e){let t=JSON.parse(JSON.stringify(e));t.isTop=0==e.isTop?"1":"0";try{await o.saveProject(t),e.isTop=0==e.isTop?"1":"0",a.$message.success(""+(0==e.isTop?"已取消置顶":"已置顶")),i.getProjectByGroup()}catch(l){a.$message.error("置顶失败 - "+l)}},handleEditProject(e){e.type&&"file"===e.type&&(l.currentFileHandle=e.entry,l.currentFileHandle.id=e.id,e=e.data),l.editProjectInfo=JSON.parse(JSON.stringify(e)),l.NewProjectVisible=!0},async handleBackupProject(e){if(o.checkVipFunction("backup"))return;l.isBackupsing=!0,l.backupsProjectId=e.projectId;let t=JSON.parse(JSON.stringify(e));l.backupsProjectOptions.createAt=t.createAt,l.backupsProjectOptions.updateAt=t.updateAt,l.backupsProjectOptions.isTop=String(t.isTop),l.backupsProjectOptions.desc=t.desc,l.backupsProjectOptions.projectName=t.projectName,l.backupsProjectOptions.width=String(t.width),l.backupsProjectOptions.height=String(t.height),l.backupsProjectOptions.projectId=t.projectId,l.backupsProjectOptions.authorUid=o.userData.uid,t.authorUid=o.userData.uid,l.backupsProjectOptions.id=null;const r=a.$bmob.Query("Backups");r.equalTo("authorUid","==",o.userData.uid),r.equalTo("projectId","==",l.backupsProjectOptions.projectId),r.limit(1);try{const e=await r.find(!1);return e.length?Y(e[0].updateAt)===Y(l.backupsProjectOptions.updateAt)?(l.isBackupsing=!1,a.$message.warning("当前项目已备份")):(l.backupsProjectOptions.id=e[0].objectId,await i.handleUploadFileToOBS(t)):await i.handleUploadFileToOBS(t)}catch(s){return l.isBackupsing=!1,new Promise(((e,t)=>t(s)))}},handleUploadFileToOBS(e){e.backupUpdatedAt=String((new Date).getTime());const t=JSON.stringify(e),r=new Blob([t],{type:""});return new Promise(((t,s)=>{G(r,`${o.userData.uid}/${l.backupsProjectOptions.projectId}.json`,(async a=>{try{await i.handleBmobPublish(e),t(!0)}catch(o){s(o)}}),(t=>{s(t),l.isBackupsing=!1,a.$message.error("项目（"+e.projectName+"）备份失败")}),(e=>{}))}))},handleDeletePoster(e){V(e,(e=>{l.isBackupsing=!1}),(e=>{l.isBackupsing=!1}))},handleDeleteToOBS:e=>new Promise(((t,a)=>{V(`${o.userData.uid}/${e}.json`,(e=>{t(!0)}),(e=>{a(e)}))})),handleBmobPublish:async e=>new Promise(((t,r)=>{const s=a.$bmob.Query("Backups");l.backupsProjectOptions.backupUpdatedAt=e.backupUpdatedAt;let n=Object.keys(l.backupsProjectOptions);for(let e=0;e<n.length;e++){let t=n[e];l.backupsProjectOptions[t]&&s.set(t,l.backupsProjectOptions[t])}s.save().then((async i=>{try{if(l.backupsProjectOptions.id)return e.isBackup=!0,await o.saveProject(e),void o.updateUserInfo(a,{browserId:o.browserId},(async()=>{l.isBackupsing=!1,a.$message.success("项目（"+e.projectName+"）备份成功")}),(e=>{l.isBackupsing=!1,r(e)}));o.updateUserInfo(a,{backupCount:String(Number(o.userData.backupCount||0)+1),browserId:o.browserId},(async()=>{e.isBackup=!0,await o.saveProject(e),l.isBackupsing=!1,a.$message.success("项目（"+e.projectName+"）备份成功"),t(!0)}),(e=>{l.isBackupsing=!1,r(e)}))}catch(s){l.isBackupsing=!1}})).catch((async t=>{l.isBackupsing=!1,a.$message.error("项目（"+e.projectName+"）备份失败");try{await i.handleDeleteToOBS(l.backupsProjectOptions.projectId),r(t)}catch(s){r(t)}o.saveErrorToBmob("备份项目",t)}))})),handlePublishProject(e,t=!1){o.checkIsLogin()||(l.editProjectInfo=JSON.parse(JSON.stringify(e)),l.editProjectInfo.activityCode="0",t&&(l.editProjectInfo.activityCode="1"),l.PublishProjectVisible=!0)},async handleExportProject(e){l.isExporting=!0;let t=JSON.parse(JSON.stringify(e));delete t.isBackup,delete t.backupUpdatedAt,delete t.authorUid;let o=await se(t);if(!o){const t=JSON.stringify(e);return o=new Blob([t],{type:""}),Q.saveAs(o,`${e.projectName}.json`),a.$message.success("导出成功"),void(l.isExporting=!1)}Q.saveAs(o,`${e.projectName}.px`),a.$message.success("导出成功"),l.isExporting=!1},handleDeleteProject(e){if(e.type&&"file"===e.type)return l.currentFileHandle=e.entry,l.currentFileHandle.id=e.id,void q.confirm("是否删除该本机项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((async()=>{try{const e=l.directoryStack[l.directoryStack.length-1];await e.removeEntry(l.currentFileHandle.name);let t=o.localProjectList.findIndex((e=>e.id===l.currentFileHandle.id));t>=0&&(o.localProjectList.splice(t,1),l.currentFileHandle=null,o.localProjectList=[],await i.populateFolderGrid(e)),a.$message.success("删除成功")}catch(e){a.$message.error("删除失败")}})).catch((()=>{}));let{projectId:t,isBackup:r,projectName:s}=e;r?q.confirm(`项目（${s}）已备份，是否删除该备份项目？`,"提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"error",beforeClose:(l,r,s)=>{if("confirm"===l){r.confirmButtonLoading=!0,r.confirmButtonText="正在删除...";const l=a.$bmob.Query("Backups");l.equalTo("authorUid","==",o.userData.uid),l.equalTo("projectId","==",t),l.limit(1),l.find(!1).then((async t=>{if(t.length)l.destroy(t[0].objectId).then((async l=>{try{await i.handleDeleteToOBS(t[0].projectId),o.updateUserInfo(a,{backupCount:String(Math.max(0,Number(o.userData.backupCount||0)-1)),browserId:o.browserId},(async()=>{e.isBackup=!1,e.backupUpdatedAt="0",e.authorUid="0",await o.saveProject(e),a.$message.success("删除成功"),s()}),(async t=>{var a,l;e.isBackup=!1,e.backupUpdatedAt="0",e.authorUid="0",await o.saveProject(e),(null==(a=o.userData)?void 0:a.backupCount)&&(null==(l=o.userData)?void 0:l.backupCount)>0&&(o.userData.backupCount=String(Math.max(0,Number(o.userData.backupCount||0)-1))),s()}))}catch(r){}})).catch((e=>{a.$message.error("备份项目删除失败")}));else{e.isBackup=!1,e.backupUpdatedAt="0",e.authorUid="0";try{await o.saveProject(e)}catch(r){}a.$message.warning("备份项目不存在或已被删除"),s()}})).catch((e=>{a.$message.error("网络异常，请稍后再试"),r.confirmButtonText="确 认",r.confirmButtonLoading=!1}))}else{if(r.confirmButtonLoading)return;s()}}}).then((()=>{})).catch((()=>{})):q.confirm("是否删除该项目？","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{o.deleteProjectById(t).then((e=>{e&&(a.$message.success(e),o.deleteProjectToGroup(l.currentGroup,t),i.getProjectByGroup())})).catch((e=>{a.$message.error("删除失败 - "+e)}))})).catch((()=>{}))},handleImportProject(e){l.isloading=!0,l.loadingText="正在导入项目";for(let r=0;r<e.length;r++)try{const t=new FileReader;t.onload=async function(t){let s=t.target.result;if(s="application/json"===e[r].raw.type?JSON.parse(t.target.result):await ne(t.target.result),!s.projectId)return l.count++,void(l.count>=e.length&&(a.$message.error(e[r].name+a.$t("message.importFailed")+"，请检查项目文件是否完整！"),l.isloading=!1,l.count=0));s.projectId=x.v1(),s.createAt=S(),s.updateAt=s.createAt,s.tip="新项目",o.saveProject(s).then((t=>{t&&(l.count++,l.count>=e.length&&(a.$message.success(a.$t("message.importSucceeded")),o.addProjectToGroup(l.currentGroup,l.currentGroup,s.projectId),l.isloading=!1,l.count=0,i.getProjectByGroup()))})).catch((t=>{l.count++,a.$message.error(e[r].name+a.$t("message.importFailed")),l.count>=e.length&&(l.isloading=!1,l.count=0)}))},"application/json"===e[r].raw.type?t.readAsText(e[r].raw):t.readAsArrayBuffer(e[r].raw)}catch(t){l.isloading=!1,a.$message.error(e[r].name+a.$t("message.importFailed"))}},handleCopyProject(e){const t=JSON.parse(JSON.stringify(e));t.projectId=x.v1(),t.createAt=S(),t.updateAt=t.createAt,t.tip="新项目",o.saveProject(t).then((e=>{e&&a.$message.success("复制成功")})).catch((e=>{a.$message.error("复制失败")}))},handleImportProject1(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const t=e.files[0];if(t){if(["image/jpeg","image/png","image/gif","image/bmp","image/svg+xml"].includes(t.type))return a.$message.warning("导入文件格式不正确，确保导入的是项目文件而非图片文件");l.isloading=!0,l.loadingText="正在导入项目";const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);t.projectId=x.v1(),t.createAt=S(),t.updateAt=t.createAt,t.tip="新项目",o.saveProject(t).then((e=>{e&&(a.$message.success(a.$t("message.importSucceeded")),l.isloading=!1)})).catch((e=>{a.$message.error(a.$t("message.importFailed")),l.isloading=!1}))},e.readAsText(t)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)},handleExpand(){l.isExpandGroup=!l.isExpandGroup;let e=document.querySelector(".project-group"),t=document.querySelector(".back-icon");l.isExpandGroup?(e.style.transform="translateX(0)",t.children[0].style.transform="rotate(0deg)"):(e.style.transform="translateX(100%)",t.children[0].style.transform="rotate(180deg)")},handleSearchGroup(){if(""===l.searchGroup.trim())return l.searchGroupData=[],a.$message.warning("请输入搜索内容");let e=new RegExp(l.searchGroup,"i");return l.searchGroupData=o.projectGroupList.filter((t=>e.test(t.label))),l.searchGroupData.length?void 0:a.$message.warning("搜索不到该分组")},handleOpenProjectGroup(e){l.currentGroup=e.value,l.currentPage=1,i.getProjectByGroup()},handleEditProjectGroup(e){l.projectGroupVisible=!0,l.isSelectGroup=!1,l.projectGroupData=JSON.parse(JSON.stringify(e))},handleDeleteProjectGroup(e){let t=o.projectGroupList.findIndex((t=>t.value===e.value));t<0||(o.projectGroupList.splice(t,1),a.$utils.cache.projectGroup.set(JSON.stringify(o.projectGroupList)))},handleAddProjectToGroup(e){let t=Array.from(l.selectedProject.keys());if(!t.length)return a.$message.warning("请选择项目后分组");for(let a=0;a<t.length;a++)o.addProjectToGroup(l.currentGroup,e,t[a]);a.$message.success("添加完成"),l.selectedProject.clear(),i.getProjectByGroup()},async handleOpenLocalProject(){if(l.isLocalProject)return l.isLocalProject=!1,o.localProjectList=[],l.currentDirectoryHandle=null,void(l.directoryStack=[]);l.isLocalProject=!0;try{const e=await window.showDirectoryPicker();l.currentDirectoryHandle=e,l.directoryStack=[e],o.localProjectList=[],await i.populateFolderGrid(e)}catch(e){a.$message.error("无法打开本机文件夹")}},async populateFolderGrid(e){l.isloading=!0;for await(const a of e.values())if("directory"===a.kind){let e={type:"folder",id:x.v4(),name:a.name,entry:a};o.localProjectList.push(e)}else if("file"===a.kind&&a.name.endsWith(".json")){let e=null;try{const t=await a.getFile(),l=await t.text();if(e=JSON.parse(l),e&&e.projectId){if(e.data){let t=await W(e.data[0].currentFrameImg);e.data[0].currentFrameImg=t}e.isLocalFile="1";let t={type:"file",id:e.projectId,name:a.name,entry:a,data:e};o.localProjectList.push(t)}}catch(t){}}l.isloading=!1},async handleBackFolder(){l.directoryStack.length>1&&(l.directoryStack.pop(),l.currentDirectoryHandle=l.directoryStack[l.directoryStack.length-1],o.localProjectList=[],await i.populateFolderGrid(l.currentDirectoryHandle))},async handleSaveLocalProject(e,t){if(l.currentFileHandle)try{const r=await l.currentFileHandle.createWritable();delete e.isLocalFile,await r.write(JSON.stringify(e)),await r.close(),a.$message.success("保存成功"),t();const s=l.directoryStack[l.directoryStack.length-1];l.currentFileHandle=null,o.localProjectList=[],await i.populateFolderGrid(s)}catch(r){a.$message.error("保存失败"),t()}else try{const r=await l.currentDirectoryHandle.getFileHandle(`${e.projectName}.json`,{create:!0}),s=await r.createWritable();await s.write(JSON.stringify(e)),await s.close(),o.localProjectList=[],await i.populateFolderGrid(l.currentDirectoryHandle),a.$message.success("创建成功"),t()}catch(r){a.$message.success("创建失败"),t()}},async handleReloadLocalProject(){const e=l.directoryStack[l.directoryStack.length-1];l.currentFileHandle=null,o.localProjectList=[],await i.populateFolderGrid(e)}};return U((()=>{""===l.searchValue.trim()&&(l.searchData=[])})),T((()=>o.isQueryProjectData),((e,t)=>{"1"!==e&&"2"!==e||(l.isloading=!1,l.totalCount=o.projectList.length)}),{immediate:!0}),T((()=>o.projectList),((e,t)=>{e&&i.getProjectByGroup()}),{immediate:!0}),T((()=>o.isLogin),((e,t)=>{e||(l.alreadySyncBackup=0,l.syncBackupArr=[])})),u((()=>{i.getProjectByGroup(),i.handleCheckBackups(!1)})),N((()=>{M((()=>{let e=a.$refs.scroll;e&&(e.scrollTop=l.scrollHeight)})),l.isLocalProject&&i.handleReloadLocalProject()})),z((()=>{l.isloading=!1})),n(s(n(s(s({},g(l)),i),{editSpaceStore:o,ArrowDownBold:R}),r),{isMobile:F,isSafari:E,isSupportPaintWorklet:H})}}),Le="/static/webp/group-6bb8d4aa.webp";Symbol.toStringTag;const Ge={class:"full-layout flex-center routerview scrollHidden"},Ve={class:"project-group"},Ue={class:"group-body scrollbar full-layout"},Te={class:"group-title flex-between"},Fe={class:"input-search"},Ne={class:"scrollbar scrollAuto grid-box"},ze=["onClick"],Re={class:"frameImg flex-center"},Ee={class:"image-slot full-h"},He=["src"],Je={class:"info"},Me={class:"flex-between",style:{"padding-bottom":"5px"}},qe={class:"oneline project-name"},Qe={class:"twoline project-desc"},Ke=["element-loading-text"],Ze={style:{padding:"10px 20px",gap:"10px"},class:"flex-start flex-warp"},Ye={class:"flex-between flex-warp",style:{padding:"0px 20px 10px","row-gap":"10px"}},We={class:"title flex-start flex-warp",style:{gap:"10px"}},Xe={key:1,class:"folder-back-icon pointer"},et={key:0,class:"flex-start flex-warp full-w",style:{gap:"10px"}},tt={key:1,class:"flex-start flex-warp full-w",style:{gap:"10px"}},at=["onClick"],ot=["onDblclick"],lt=["src"],rt={class:"image-slot full-h"},it=["src"],st={class:"info"},nt={class:"flex-between",style:{"padding-bottom":"5px"}},ct=["title"],dt={class:"project-time text-left"},pt={class:"twoline project-desc"},ut={key:0,class:"flex-center full-w",style:{padding:"10px"}},gt=["onDblclick"],mt=["src"],ft={class:"image-slot full-h"},ht=["src"],jt={class:"info"},yt={class:"flex-between",style:{"padding-bottom":"5px"}},bt=["title"],kt=["title"],Pt={key:0,class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box",color:"#808080"}},vt={key:0,class:"flex-center full-w",style:{padding:"10px"}},wt={key:2,class:"full-layout flex-center scrollbar scrollAuto"};var It=ie(Oe,[["render",function(e,t,a,o,l,r){var i,s,n,c,d;const p=m("Expand"),u=m("el-icon"),g=m("CirclePlusFilled"),S=m("Search"),x=m("el-skeleton-item"),_=m("el-skeleton"),$=m("el-image"),A=m("el-button"),D=m("el-dropdown-item"),O=m("el-dropdown-menu"),L=m("el-dropdown"),G=m("el-divider"),V=m("el-tooltip"),U=m("van-notice-bar"),T=m("el-tag"),F=m("RefreshRight"),N=m("Delete"),z=m("ArrowLeft"),R=m("search"),E=m("el-input"),H=m("px-button"),J=m("arrow-down"),M=m("px-dropdown-item"),q=m("px-dropdown-menu"),Q=m("px-dropdown"),K=m("Loading"),Z=m("el-pagination"),Y=m("el-empty"),W=m("NewProjectDialog"),re=m("PublishDialog"),ie=m("UploadFileDialog"),se=m("AddProjectGroupDialog"),ne=X("loading");return f(),w("div",Ge,[y("div",Ve,[y("div",{class:"back-icon",onClick:t[0]||(t[0]=(...t)=>e.handleExpand&&e.handleExpand(...t))},[b(u,null,{default:j((()=>[b(p)])),_:1})]),y("div",Ue,[y("p",Te,[t[24]||(t[24]=k(" 项目分组 ")),b(u,{onClick:t[1]||(t[1]=t=>{e.projectGroupVisible=!0,e.isSelectGroup=!1})},{default:j((()=>[b(g)])),_:1})]),y("div",Fe,[b(u,null,{default:j((()=>[b(S)])),_:1}),ee(y("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.searchGroup=t),placeholder:"请搜索分组",onKeyup:t[3]||(t[3]=ae(((...t)=>e.handleSearchGroup&&e.handleSearchGroup(...t)),["enter"]))},null,544),[[te,e.searchGroup]])]),y("div",Ne,[(f(!0),w(I,null,C(e.searchGroupData.length?e.searchGroupData:e.editSpaceStore.projectGroupList,(a=>(f(),w("div",{class:B([{active:a.value===e.currentGroup},"project-item"]),onClick:t=>e.handleOpenProjectGroup(a),key:a.id},[y("div",Re,[b($,{src:e.getGroupImg(a),fit:"contain"},{placeholder:j((()=>[b(_,{animated:"",class:"full-layout"},{template:j((()=>[b(x,{variant:"image",style:{height:"100%"}})])),_:1})])),error:j((()=>[y("div",Ee,[y("img",{src:Le,style:{"object-fit":"contain","image-rendering":"auto"}},null,8,He)])])),_:2},1032,["src"])]),y("div",Je,[y("div",Me,[y("h4",qe,P(a.label),1),"0"!==a.value?(f(),h(L,{key:0,trigger:"click",size:"small"},{dropdown:j((()=>[b(O,null,{default:j((()=>[b(D,{onClick:t=>e.handleEditProjectGroup(a),icon:"Edit"},{default:j((()=>[k(P(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleDeleteProjectGroup(a),icon:"Delete"},{default:j((()=>[k(P(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:j((()=>[b(A,{type:"primary",icon:e.ArrowDownBold,size:"small",onClick:t[4]||(t[4]=le((()=>{}),["stop"])),style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)):v("",!0)]),b(G,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}}),b(V,{content:a.desc,effect:"light"},{default:j((()=>[y("div",Qe,P(a.desc),1)])),_:2},1032,["content"])])],10,ze)))),128))])])]),ee((f(),w("div",{class:"full-layout flex flex-column","element-loading-text":e.loadingText,"element-loading-background":"#00000020"},[y("div",Ze,[b(U,{class:"full-w notice-tag",color:"#ffffff",background:"#EBB105",mode:"closeable","left-icon":"volume-o",text:"须知：已备份的项目，只有在已登录状态下才能看见喔！"})]),y("div",Ye,[y("h2",We,[e.editSpaceStore.userData&&!e.isLocalProject&&e.editSpaceStore.versionInfoData?(f(),w(I,{key:0},[b(T,{size:"small",type:e.checkBackupCount},{default:j((()=>[k("已备份: "+P(e.editSpaceStore.userData.backupCount||"0")+" / "+P(Number(e.editSpaceStore.versionInfoData[e.editSpaceStore.userData.vip||"0"].count)+Number(e.editSpaceStore.userData.extraBackupCount||0)),1)])),_:1},8,["type"]),(null==(i=e.editSpaceStore.userData)?void 0:i.backupCount)>0&&(null==(s=e.editSpaceStore.userData)?void 0:s.browserId)&&"0"!==(null==(n=e.editSpaceStore.userData)?void 0:n.browserId)&&(null==(c=e.editSpaceStore.userData)?void 0:c.browserId)!==e.editSpaceStore.browserId?(f(),h(T,{key:0,type:"primary",size:"small"},{default:j((()=>[k(P(e.alreadySyncBackup==e.editSpaceStore.userData.backupCount?"已同步":"待同步")+": "+P(e.alreadySyncBackup)+" / "+P(e.editSpaceStore.userData.backupCount||"0"),1)])),_:1})):v("",!0),b(u,{onClick:e.handleCheckBackups,class:B({"is-loading":e.isPullBackupsing}),style:oe({pointerEvents:e.isPullBackupsing?"none":"auto",cursor:e.isPullBackupsing?"not-allowed":"pointer"})},{default:j((()=>[b(F)])),_:1},8,["onClick","class","style"]),(null==(d=e.editSpaceStore.userData)?void 0:d.vip)>1?(f(),h(u,{key:1,class:"pointer",onClick:t[5]||(t[5]=t=>e.$router.push("/recycle"))},{default:j((()=>[b(N)])),_:1})):v("",!0)],64)):e.isLocalProject?(f(),w("div",Xe,[b(u,{onClick:e.handleBackFolder},{default:j((()=>[b(z)])),_:1},8,["onClick"])])):v("",!0)]),e.isSupportPaintWorklet()?(f(),w("div",et,[b(E,{disabled:e.isLocalProject,modelValue:e.searchValue,"onUpdate:modelValue":t[6]||(t[6]=t=>e.searchValue=t),clearable:"",placeholder:e.$t("message.pleaseSearchProject"),onKeyup:ae(e.handleSearch,["enter"]),style:{"max-width":"150px"}},{prefix:j((()=>[b(u,{class:"el-input__icon"},{default:j((()=>[b(R)])),_:1})])),_:1},8,["disabled","modelValue","placeholder","onKeyup"]),b(H,{round:"",disabled:e.isLocalProject,type:"primary",onClick:e.handleReset},{default:j((()=>[k(P(e.$t("message.reset")),1)])),_:1},8,["disabled","onClick"]),b(H,{round:"",type:"primary",onClick:e.handleAllSelect,disabled:e.isLocalProject},{default:j((()=>t[25]||(t[25]=[k("全 选")]))),_:1,__:[25]},8,["onClick","disabled"]),b(Q,{trigger:"click",disabled:e.isLocalProject,onCommand:e.handleBatchCommand},{dropdown:j((()=>[b(q,null,{default:j((()=>[b(M,{onClick:e.handleBatchDeleteProject,command:"1"},{default:j((()=>t[27]||(t[27]=[k("批量删除")]))),_:1,__:[27]},8,["onClick"]),b(M,{onClick:e.handleBatchExportProject,command:"2"},{default:j((()=>t[28]||(t[28]=[k("批量导出")]))),_:1,__:[28]},8,["onClick"]),b(M,{onClick:e.handleBatchBackupProject,command:"3"},{default:j((()=>t[29]||(t[29]=[k("批量备份")]))),_:1,__:[29]},8,["onClick"]),b(M,{onClick:t[7]||(t[7]=t=>{e.projectGroupVisible=!0,e.isSelectGroup=!0}),command:"4"},{default:j((()=>t[30]||(t[30]=[k("批量分组")]))),_:1,__:[30]})])),_:1})])),default:j((()=>[b(H,{type:"primary",round:"",disabled:e.isLocalProject},{default:j((()=>[t[26]||(t[26]=k("批量操作 ")),b(u,{class:"el-icon--right"},{default:j((()=>[b(J)])),_:1})])),_:1,__:[26]},8,["disabled"])])),_:1},8,["disabled","onCommand"]),b(H,{round:"",type:"primary",disabled:e.isLocalProject,onClick:t[8]||(t[8]=t=>{e.UploadFileVisible=!0})},{default:j((()=>[k(P(e.$t("message.importProject")),1)])),_:1},8,["disabled"]),b(H,{round:"",type:"primary",onClick:t[9]||(t[9]=t=>{e.NewProjectVisible=!0,e.editProjectInfo=null})},{default:j((()=>[k(P(e.$t("message.newProject")),1)])),_:1}),v("",!0)])):(f(),w("div",tt,[b(E,{disabled:e.isLocalProject,modelValue:e.searchValue,"onUpdate:modelValue":t[10]||(t[10]=t=>e.searchValue=t),clearable:"",placeholder:e.$t("message.pleaseSearchProject"),onKeyup:ae(e.handleSearch,["enter"]),style:{"max-width":"150px"}},{prefix:j((()=>[b(u,{class:"el-input__icon"},{default:j((()=>[b(R)])),_:1})])),_:1},8,["disabled","modelValue","placeholder","onKeyup"]),b(A,{disabled:e.isLocalProject,type:"primary",onClick:e.handleReset},{default:j((()=>[k(P(e.$t("message.reset")),1)])),_:1},8,["disabled","onClick"]),b(A,{type:"primary",onClick:e.handleAllSelect,disabled:e.isLocalProject},{default:j((()=>t[31]||(t[31]=[k("全 选")]))),_:1,__:[31]},8,["onClick","disabled"]),b(L,{trigger:"click",disabled:e.isLocalProject},{dropdown:j((()=>[b(O,null,{default:j((()=>[b(D,{onClick:e.handleBatchDeleteProject},{default:j((()=>t[33]||(t[33]=[k("批量删除")]))),_:1,__:[33]},8,["onClick"]),b(D,{onClick:e.handleBatchExportProject},{default:j((()=>t[34]||(t[34]=[k("批量导出")]))),_:1,__:[34]},8,["onClick"]),b(D,{onClick:e.handleBatchBackupProject},{default:j((()=>t[35]||(t[35]=[k("批量备份")]))),_:1,__:[35]},8,["onClick"]),b(D,{onClick:t[11]||(t[11]=t=>{e.projectGroupVisible=!0,e.isSelectGroup=!0})},{default:j((()=>t[36]||(t[36]=[k("批量分组")]))),_:1,__:[36]})])),_:1})])),default:j((()=>[b(A,{type:"primary",disabled:e.isLocalProject},{default:j((()=>[t[32]||(t[32]=k("批量操作 ")),b(u,{class:"el-icon--right"},{default:j((()=>[b(J)])),_:1})])),_:1,__:[32]},8,["disabled"])])),_:1},8,["disabled"]),b(A,{type:"primary",disabled:e.isLocalProject,onClick:t[12]||(t[12]=t=>{e.UploadFileVisible=!0})},{default:j((()=>[k(P(e.$t("message.importProject")),1)])),_:1},8,["disabled"]),b(A,{type:"primary",onClick:t[13]||(t[13]=t=>{e.NewProjectVisible=!0,e.editProjectInfo=null})},{default:j((()=>[k(P(e.$t("message.newProject")),1)])),_:1}),v("",!0)]))]),!e.projectList.length&&!e.searchData.length||e.isloading||e.isLocalProject?e.editSpaceStore.localProjectList.length&&!e.isloading&&e.isLocalProject?(f(),w(I,{key:1},[y("div",{class:"full-layout scrollbar scrollAuto grid-box",onScroll:t[18]||(t[18]=(...t)=>e.handleScroll&&e.handleScroll(...t)),ref:"scroll"},[(f(!0),w(I,null,C(e.editSpaceStore.localProjectList,(a=>(f(),w("div",{key:a.id,class:"project-item"},[y("div",{class:"frameImg flex-center",onDblclick:le((t=>e.handleOpenProject(a)),["stop"])},["folder"===a.type?(f(),w("img",{key:0,src:Le,class:"folderImg"},null,8,mt)):(f(),h($,{key:1,src:e.getFrameImg(a.data),fit:"contain"},{placeholder:j((()=>[b(_,{animated:"",class:"full-layout"},{template:j((()=>[b(x,{variant:"image",style:{height:"100%"}})])),_:1})])),error:j((()=>[y("div",ft,[y("img",{src:ce||de},null,8,ht)])])),_:2},1032,["src"])),a.data?(f(),h(T,{key:2,type:"success",class:"size"},{default:j((()=>[k(P(a.data.width)+"x"+P(a.data.height),1)])),_:2},1024)):v("",!0)],40,gt),y("div",jt,[y("div",yt,["folder"===a.type?(f(),w("h4",{key:0,class:"oneline",title:a.name},P(a.name),9,bt)):v("",!0),"file"===a.type?(f(),w("h4",{key:1,class:"oneline",title:a.data.projectName},P(a.data.projectName),9,kt)):v("",!0),"file"===a.type?(f(),h(L,{key:2,trigger:"click",size:"small"},{dropdown:j((()=>[b(O,null,{default:j((()=>[b(D,{onClick:t=>e.handleOpenProject(a),icon:"Open"},{default:j((()=>[k(P(e.$t("message.open")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleEditProject(a),icon:"Edit"},{default:j((()=>[k(P(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleDeleteProject(a),icon:"Delete"},{default:j((()=>[k(P(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:j((()=>["file"===a.type?(f(),h(A,{key:0,type:"primary",icon:e.ArrowDownBold,size:"small",onClick:t[17]||(t[17]=le((()=>{}),["stop"])),style:{"margin-left":"5px"}},null,8,["icon"])):v("",!0)])),_:2},1024)):v("",!0)]),b(G,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:j((()=>[k(P(a.data?a.data.updateAt:""),1)])),_:2},1024),b(V,{content:(null==a?void 0:a.data)?a.data.desc:"",effect:"light"},{default:j((()=>[a.data?(f(),w("div",Pt,P(a.data.desc),1)):v("",!0)])),_:2},1032,["content"])])])))),128))],544),e.searchData.length||e.editSpaceStore.localProjectList.length?v("",!0):(f(),w("div",vt,[b(Z,{"current-page":e.currentPage,"onUpdate:currentPage":t[19]||(t[19]=t=>e.currentPage=t),"page-size":e.pageSize,background:"",layout:"total, prev, pager, next",total:e.totalCount,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])]))],64)):e.isloading||e.searchData.length&&e.projectList.length&&e.editSpaceStore.localProjectList.length?v("",!0):(f(),w("div",wt,[b(Y,{image:pe,description:"空空如也","image-size":200},null,8,["image"])])):(f(),w(I,{key:0},[y("div",{class:"full-layout scrollbar scrollAuto grid-box",onScroll:t[15]||(t[15]=(...t)=>e.handleScroll&&e.handleScroll(...t)),ref:"scroll"},[(f(!0),w(I,null,C(e.searchData.length?e.searchData:e.projectList,(a=>(f(),w("div",{class:B([{active:e.selectedProject.has(a.id)},"project-item"]),onClick:t=>e.handleSelectProject(a.data),key:a.id},[y("div",{class:"frameImg flex-center",onDblclick:le((t=>e.handleOpenProject(a.data)),["stop"])},[""===a.data.frameImg?(f(),w("img",{key:0,src:ce,class:"emptyImg"},null,8,lt)):(f(),h($,{key:1,src:e.getFrameImg(a.data),fit:"contain"},{placeholder:j((()=>[b(_,{animated:"",class:"full-layout"},{template:j((()=>[b(x,{variant:"image",style:{height:"100%"}})])),_:1})])),error:j((()=>[y("div",rt,[y("img",{src:ce||de},null,8,it)])])),_:2},1032,["src"])),a.data.isBackup?(f(),h(T,{key:2,size:"small",type:"success",effect:"dark",class:"backups"},{default:j((()=>t[37]||(t[37]=[k("已备份")]))),_:1,__:[37]})):v("",!0),e.isBackupsing&&e.backupsProjectId===a.data.projectId?(f(),h(T,{key:3,size:"small",type:"success",effect:"dark",class:"backups"},{default:j((()=>[b(u,{size:"16",class:"is-loading"},{default:j((()=>[b(K)])),_:1}),t[38]||(t[38]=k(" 正在备份 "))])),_:1})):v("",!0),1==a.data.isTop?(f(),h(T,{key:4,size:"small",type:"danger",effect:"dark",class:"top"},{default:j((()=>[k(P(e.$t("message.top")),1)])),_:1})):v("",!0),b(T,{size:"small",type:"success",class:"size"},{default:j((()=>[k(P(a.data.width)+"x"+P(a.data.height),1)])),_:2},1024),""!==a.data.tip?(f(),h(T,{key:5,size:"small",type:"primary",effect:"dark",class:"tip"},{default:j((()=>[k(P(a.data.tip),1)])),_:2},1024)):v("",!0)],40,ot),y("div",st,[y("div",nt,[y("h4",{class:"oneline project-name",title:a.data.projectName},P(a.data.projectName),9,ct),b(L,{trigger:"click",size:"small"},{dropdown:j((()=>[b(O,null,{default:j((()=>[b(D,{onClick:t=>e.handleOpenProject(a.data),icon:"Open"},{default:j((()=>[k(P(e.$t("message.open")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleEditProject(a.data),icon:"Edit"},{default:j((()=>[k(P(e.$t("message.edit")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleTopProject(a.data),icon:"Upload"},{default:j((()=>[k(P(a.data.isTop>0?e.$t("message.cancelTop"):e.$t("message.top")),1)])),_:2},1032,["onClick"]),b(D,{onClick:t=>e.handleCopyProject(a.data),icon:"DocumentCopy"},{default:j((()=>t[39]||(t[39]=[k("复 制")]))),_:2,__:[39]},1032,["onClick"]),b(D,{onClick:t=>e.handleExportProject(a.data),disabled:e.isExporting,icon:"FolderOpened"},{default:j((()=>[k(P(e.isExporting?e.$t("message.exportLoading"):e.$t("message.export")),1)])),_:2},1032,["onClick","disabled"]),b(D,{onClick:t=>e.handlePublishProject(a.data),icon:"FolderChecked"},{default:j((()=>t[40]||(t[40]=[k("发 布")]))),_:2,__:[40]},1032,["onClick"]),b(D,{onClick:t=>e.handleBackupProject(a.data),icon:"MostlyCloudy",disabled:e.isBackupsing},{default:j((()=>t[41]||(t[41]=[k(P("备 份"))]))),_:2,__:[41]},1032,["onClick","disabled"]),b(D,{onClick:t=>e.handleDeleteProject(a.data),icon:"Delete"},{default:j((()=>[k(P(e.$t("message.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:j((()=>[b(A,{type:"primary",icon:e.ArrowDownBold,size:"small",onClick:t[14]||(t[14]=le((()=>{}),["stop"])),style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),y("div",dt,P(a.data.updateAt),1),b(V,{content:a.data.desc,effect:"light"},{default:j((()=>[y("div",pt,P(a.data.desc),1)])),_:2},1032,["content"])])],10,at)))),128))],544),e.searchData.length?v("",!0):(f(),w("div",ut,[b(Z,{"current-page":e.currentPage,"onUpdate:currentPage":t[16]||(t[16]=t=>e.currentPage=t),"page-size":e.pageSize,background:"",layout:"total, prev, pager, next",total:e.totalCount,"pager-count":3,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])]))],64)),e.NewProjectVisible?(f(),h(W,{key:3,visible:e.NewProjectVisible,editInfo:e.editProjectInfo,groupId:e.currentGroup,isLocalProject:e.isLocalProject,onSave:e.handleOpenProject,onLocal:e.handleSaveLocalProject,onClose:t[20]||(t[20]=t=>e.NewProjectVisible=!1)},null,8,["visible","editInfo","groupId","isLocalProject","onSave","onLocal"])):v("",!0),e.PublishProjectVisible?(f(),h(re,{key:4,visible:e.PublishProjectVisible,editInfo:e.editProjectInfo,onClose:t[21]||(t[21]=t=>e.PublishProjectVisible=!1)},null,8,["visible","editInfo"])):v("",!0),e.UploadFileVisible?(f(),h(ie,{key:5,visible:e.UploadFileVisible,onReload:e.handleImportProject,onClose:t[22]||(t[22]=t=>e.UploadFileVisible=!1)},null,8,["visible","onReload"])):v("",!0),e.projectGroupVisible?(f(),h(se,{key:6,editData:e.projectGroupData,isSelectGroup:e.isSelectGroup,visible:e.projectGroupVisible,onAdd:e.handleAddProjectToGroup,onClose:t[23]||(t[23]=t=>{e.projectGroupVisible=!1,e.projectGroupData=null,e.isSelectGroup=!1})},null,8,["editData","isSelectGroup","visible","onAdd"])):v("",!0)],8,Ke)),[[ne,e.isloading]])])}],["__scopeId","data-v-08945701"]]);export{It as default};
