var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&i(e,t,a[t]);return e},n=(e,l)=>a(e,t(l));import{_ as d,d as c,A as u,B as p,r as m,o as g,t as f,b as h,a2 as v,f as b,h as y,s as w,g as k,C as P,aw as x,au as C,as as A,av as S,an as D,e as U,O as j,l as I,k as E,n as _,j as O,v as N,z as V,c as R,F as $,p as B,q as M,x as T,y as z,aH as Q,bA as F,V as G,aQ as J,a8 as H,ap as Y,am as K}from"./index-6a0d579b.js";import{v as q,g as L}from"./validator-ad586801.js";import{P as X,a as Z}from"./PersonShareDialog-ee28b076.js";import{u as W}from"./useModule-f0faaaf9.js";import{p as ee}from"./pro-f2363fe4.js";import{b as ae}from"./boy-09783d30.js";import{h as te}from"./hot-d0a3d9b9.js";import{e as le}from"./empty-6662c720.js";import"./useDB-ae0c91ac.js";import"./grid-33bc5412.js";const se=c({name:"AvatarUpload",components:{},props:{defaultAvatar:{type:String,default:""},isAuto:{type:Boolean,default:!1},height:{type:Number,default:80},width:{type:Number,default:80},type:{type:Number,default:0},borderRadius:{type:Number,default:50},desc:{type:String,default:"上传头像"}},emits:[],setup(e,a){const t=u();let{proxy:l}=k();const s=p();let o=m({uploadUrl:"",avatarUrl:"",headers:{"X-API-Key":l.$config.PICGO_KEY},fileType:["image/jpeg","image/jpg","image/png","image/svg+xml"],isSelected:!1,uploadBeforeFile:null,deletePosterUrl:"",isUploading:!1}),i={handleBmobPublish(e){let a=P();const s=l.$bmob.Query("User");s.set("id",t.userData.objectId),s.set("avatarUpdatedAt",a),s.set("avatar",e),s.save().then((async s=>{o.isUploading=!1,l.$message.success("上传成功"),o.avatarUrl=`${l.$config.HUAWEI_OBS_CONFIG.HOST}${e}?time=${(new Date).getTime()}`,t.userData.avatar=e+`?time=${(new Date).getTime()}`,t.userData.avatarUpdatedAt=a,t.saveUserInfo(t.userData)})).catch((a=>{o.isUploading=!1,i.handleDeleteAvatar(e),l.$message.error("上传失败")}))},handleDeleteAvatar(e){let a=e.slice(1);x(a,(e=>{}),(e=>{}))},handleExceed(e,a){s.value.clearFiles();const t=e[0];t.uid=C(),s.value.handleStart(t)},handleProgress(){o.isUploading=!0},handleAvatarChange(a,t){e.isAuto||(o.isUploading=!0,i.beforeAvatarUpload(a.raw)?i.handleUploadToOBS(a):o.isUploading=!1)},handleUploadToOBS(e){let a=A(e.name),s=`${t.userData.uid}.${a}`;S(e.raw,s,(e=>{i.handleBmobPublish("/"+s)}),(e=>{o.isUploading=!1,l.$message.error(e)}),(e=>{}))},handleAvatarSuccess(e,a){o.avatarUrl=e.image.url,o.deletePosterUrl=e.image.delete_url,i.handleBmobPublish("1")},handleAvatarError(e,a){o.isUploading=!1,l.$message.error("上传头像失败")},beforeAvatarUpload(e){let a=0;return t.userData.avatarUpdatedAt&&""!==t.userData.avatarUpdatedAt&&(a=D(t.userData.avatarUpdatedAt)),(new Date).getTime()-a<6048e5?(l.$message.warning("七天内只能更新一次头像喔！"),!1):["image/png"].includes(e.type)?!(e.size/1024/1024>l.$config.MAX_UPLOAD_SIZE)||(l.$message.warning("上传图片大小不能超过500kb！"),!1):(l.$message.warning("上传图片格式不正确！"),!1)}};return g((async()=>{""!==e.defaultAvatar&&e.defaultAvatar.startsWith("/")&&!e.defaultAvatar.includes("assets")?o.avatarUrl=`${l.$config.HUAWEI_OBS_CONFIG.HOST}${e.defaultAvatar}`:o.avatarUrl=e.defaultAvatar})),n(r(r({},f(o)),i),{uploadRef:s})}}),oe={class:"tip"},ie={class:"tip"};var re=d(se,[["render",function(e,a,t,l,s,o){const i=h("el-skeleton-item"),r=h("el-skeleton"),n=h("el-image"),d=h("Plus"),c=h("el-icon"),u=h("el-upload"),p=v("loading");return U(),b(u,{ref:"uploadRef",class:"avatar-uploader",style:w({height:e.height+"px"}),action:e.uploadUrl,name:"source",method:"post","show-file-list":!1,limit:1,accept:".png",headers:e.headers,"auto-upload":e.isAuto,"on-change":e.handleAvatarChange,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-error":e.handleAvatarError,"on-exceed":e.handleExceed,"on-progress":e.handleProgress},{default:y((()=>[""!==e.avatarUrl?j((U(),I("div",{key:0,class:"avatar flex-center",style:w({height:e.height+"px",width:e.width+"px",borderRadius:e.borderRadius+"%"})},[E(' <img :src="avatarUrl" style="object-fit: cover;"> '),_(n,{src:e.avatarUrl,fit:"cover"},{placeholder:y((()=>[_(r,{animated:"",class:"full-layout"},{template:y((()=>[_(i,{variant:"image",style:{height:"100%"}})])),_:1})])),_:1},8,["src"]),O("div",oe,N(e.desc),1)],4)),[[p,e.isUploading]]):(U(),I("div",{key:1,class:"avatar flex-center",style:w({height:e.height+"px",width:e.width+"px",borderRadius:e.borderRadius+"%"})},[_(c,{size:20,color:"#808080"},{default:y((()=>[_(d)])),_:1}),O("div",ie,N(e.desc),1)],4))])),_:1},8,["style","action","headers","auto-upload","on-change","on-success","before-upload","on-error","on-exceed","on-progress"])}],["__scopeId","data-v-f807882c"],["__file","D:/project/pixel-grid/src/components/AvatarUpload.vue"]]);const ne=c({name:"EditPasswordDialog",components:{},props:{visible:{type:Boolean,default:!1}},emits:["close","update"],setup(e,a){const t=p(),{proxy:l}=k(),s=u();let o=m({form:{oldPassword:"",newPassword:""},loading:!1,rules:{oldPassword:[{required:!0,trigger:"change",validator:(e,a,l)=>{q.validatePwd1(e,a,l,o.form.newPassword,t)}}],newPassword:[{required:!0,trigger:"change",validator:(e,a,t)=>{q.validatePwd2(e,a,t,o.form.oldPassword)}}]},dialogVisible:e.visible}),i={handleClose(){o.dialogVisible=!1,a.emit("close")},handleReset(e){const t=l.$bmob.Query("User");t.set("id",e),t.set("password",l.$utils.secret.MD5(o.form.newPassword)),t.save().then((e=>{o.loading=!1,l.$message.success("修改成功，请重新登录"),a.emit("update"),i.handleClose(),setTimeout((()=>{s.deleteUserInfo()}),1e3)})).catch((e=>{o.loading=!1,l.$message.error("修改失败")}))},async handleConfirm(e){e&&e.validate((e=>{if(!e)return!1;{o.loading=!0;const e=l.$bmob.Query("User");e.equalTo("username","==",s.userData.username),e.equalTo("password","==",l.$utils.secret.MD5(o.form.oldPassword)),e.select("isEnable"),e.limit(1),e.find().then((e=>(o.loading=!1,e.results.length?e.results.length&&e.results[0].isEnable&&"0"===e.results[0].isEnable?l.$message.warning("账号已被禁用"):void i.handleReset(e.results[0].objectId):l.$message.warning("用户不存在")))).catch((e=>{o.loading=!1,l.$message.error("修改失败")}))}}))}};return n(r(r({},f(o)),i),{ruleFormRef:t})}}),de={class:"dialog-footer"},ce=V("取 消"),ue=V("确 定");var pe=d(ne,[["render",function(e,a,t,l,s,o){const i=h("el-input"),r=h("el-form-item"),n=h("el-form"),d=h("el-button"),c=h("el-dialog");return U(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=a=>e.dialogVisible=a),title:"修改密码","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[O("span",de,[_(d,{onClick:e.handleClose},{default:y((()=>[ce])),_:1},8,["onClick"]),_(d,{type:"primary",onClick:a[2]||(a[2]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>[ue])),_:1},8,["loading"])])])),default:y((()=>[_(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[_(r,{label:"旧密码",prop:"oldPassword"},{default:y((()=>[_(i,{type:"password",modelValue:e.form.oldPassword,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.oldPassword=a),"show-password":"",placeholder:"请输入旧密码",clearable:""},null,8,["modelValue"])])),_:1}),_(r,{label:"新密码",prop:"newPassword"},{default:y((()=>[_(i,{type:"password","show-password":"",modelValue:e.form.newPassword,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.newPassword=a),placeholder:"请输入新密码",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"])}],["__file","D:/project/pixel-grid/src/components/dialog/EditPasswordDialog.vue"]]);const me=c({name:"EditPasswordDialog",components:{},props:{visible:{type:Boolean,default:!1}},emits:["close","update"],setup(e,a){const t=p(),{proxy:l}=k(),s=u();let o=m({form:{newNickname:s.userData.nickname},loading:!1,rules:{newNickname:[{required:!0,trigger:"change",validator:(e,a,t)=>{q.validateFormNickname(a,t)}}]},dialogVisible:e.visible}),i={handleClose(){o.dialogVisible=!1,a.emit("close")},async handleConfirm(e){e&&e.validate((e=>{if(!e)return!1;{let e=0;if(s.userData.nameUpdatedAt&&""!==s.userData.nameUpdatedAt&&(e=D(s.userData.nameUpdatedAt)),(new Date).getTime()-e<6048e5)return void l.$message.warning("七天内只能更新一次昵称喔！");o.loading=!0;let t=P();const r=l.$bmob.Query("User");r.set("id",s.userData.objectId),r.set("nameUpdatedAt",t),r.set("nickname",o.form.newNickname),r.save().then((e=>{o.loading=!1,l.$message.success("修改成功"),s.userData.nickname=o.form.newNickname,s.userData.nameUpdatedAt=t,s.saveUserInfo(s.userData),a.emit("update"),i.handleClose()})).catch((e=>{o.loading=!1,l.$message.error("修改失败")}))}}))}};return n(r(r({},f(o)),i),{ruleFormRef:t})}}),ge={class:"dialog-footer"},fe=V("取 消"),he=V("确 定");var ve=d(me,[["render",function(e,a,t,l,s,o){const i=h("el-input"),r=h("el-form-item"),n=h("el-form"),d=h("el-button"),c=h("el-dialog");return U(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogVisible=a),title:"修改昵称","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[O("span",ge,[_(d,{onClick:e.handleClose},{default:y((()=>[fe])),_:1},8,["onClick"]),_(d,{type:"primary",onClick:a[1]||(a[1]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>[he])),_:1},8,["loading"])])])),default:y((()=>[_(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[_(r,{label:"新昵称",prop:"newNickname"},{default:y((()=>[_(i,{modelValue:e.form.newNickname,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.newNickname=a),placeholder:"请输入新昵称",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"])}],["__file","D:/project/pixel-grid/src/components/dialog/EditNickNameDialog.vue"]]);const be=c({name:"CustomHomePageDialog",components:{},props:{visible:{type:Boolean,default:!1},editData:{type:Object,default:null}},emits:["close","update"],setup(e,a){const t=p(),{proxy:l}=k(),s=u();let o=m({form:{url:"",id:"0"},loading:!1,rules:{url:[{required:!0,trigger:"change",validator:(e,a,t)=>{q.validateUrl(a,t)}}]},dialogVisible:e.visible});const i=R((()=>e=>new URL(`/svg/${e}.svg`,window.location.origin).href));let d={handleClose(){o.dialogVisible=!1,a.emit("close")},async handleConfirm(t){t&&t.validate((t=>{var i;if(!t)return!1;{o.loading=!0;let t=JSON.parse(JSON.stringify(JSON.parse((null==(i=s.userData)?void 0:i.homePage)||[])));if(t.findIndex((e=>e.id===o.form.id))>=0)return o.loading=!1,l.$message.warning("已存在该主页");if(e.editData){let e=t.findIndex((e=>e.id===o.form.id));e>=0&&t.splice(e,1,o.form)}else t.push(o.form);let r={homePage:JSON.stringify(t)};s.updateUserInfo(l,r,(()=>{l.$message.success("保存成功"),o.loading=!1,a.emit("update"),d.handleClose()}),(()=>{l.$message.error("保存失败"),o.loading=!1}))}}))}};return g((()=>{e.editData&&(o.form=JSON.parse(JSON.stringify(e.editData)))})),n(r(r({},f(o)),d),{ruleFormRef:t,getIcon:i})}}),ye={key:0},we=(e=>(T("data-v-31036e6e"),e=e(),z(),e))((()=>O("p",null,"主页选择",-1))),ke={class:"page-box flex-warp flex-center"},Pe=["onClick"],xe=["src"],Ce={class:"dialog-footer"},Ae=V("取 消"),Se=V("确 定");var De=c({name:"user",props:{},components:{AvatarUpload:re,EditPasswordDialog:pe,EditNickNameDialog:ve,PersonShareDialog:X,PublishEditDialog:Z,CustomHomePageDialog:d(be,[["render",function(e,a,t,l,s,o){const i=h("el-input"),r=h("el-form-item"),n=h("el-form"),d=h("el-button"),c=h("el-dialog");return U(),b(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogVisible=a),title:"自定义主页","before-close":e.handleClose,class:"z-dialog",center:"","close-on-click-modal":!1,width:350},{footer:y((()=>[O("span",Ce,[_(d,{onClick:e.handleClose},{default:y((()=>[Ae])),_:1},8,["onClick"]),_(d,{type:"primary",onClick:a[1]||(a[1]=a=>e.handleConfirm(e.ruleFormRef)),loading:e.loading},{default:y((()=>[Se])),_:1},8,["loading"])])])),default:y((()=>[_(n,{ref:"ruleFormRef",model:e.form,"label-position":"top",rules:e.rules},{default:y((()=>[_(r,{label:"链接",prop:"url"},{default:y((()=>[_(i,{modelValue:e.form.url,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.url=a),placeholder:"请输入链接地址",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),e.editData?E("v-if",!0):(U(),I("div",ye,[we,O("div",ke,[(U(!0),I($,null,B(e.$config.homePageList,((a,t)=>(U(),I("div",{class:M(["page-icon flex-column-center pointer",{active:t==e.form.id}]),key:a.name,onClick:a=>e.form.id=String(t)},[O("img",{src:e.getIcon(t),style:w({backgroundColor:a.color})},null,12,xe),O("span",null,N(a.label),1)],10,Pe)))),128))])]))])),_:1},8,["modelValue","before-close"])}],["__scopeId","data-v-31036e6e"],["__file","D:/project/pixel-grid/src/components/dialog/CustomHomePageDialog.vue"]]),SafeRender:{props:{sourceText:{type:String,required:!0}},render(){if(""===this.sourceText||!this.sourceText)return"";const e=this.sourceText.split("@");if(1===e.length)return this.sourceText;const a=e[1];if(1===a.split("[").length)return this.sourceText;const t=a.split("[")[0].trim(),l=a.split("[")[1].split("]")[0],s=a.split("[")[1].split("]")[1];return t&&l?Q("div",[e[0],Q("a",{href:l,target:"_blank"},"@"+t),s]):this.sourceText}}},emits:[],setup(e,a){const{proxy:t}=k(),l=u(),s=W();F(l);let o=m({visible:!1,visible1:!1,visible2:!1,visible3:!1,isloading:!0,myPublishProject:[],loading:!0,isSelf:!0,currentPage:1,pageSize:10,totalCount:0,userData:null,emptyStatus:!1,desc:"未登录",backRoute:null,shareUrl:"",homePageEditData:null,filterOrder:"-updatedAt"});const i=R((()=>e=>e?"1"===e?ee:"data:image/png;base64,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":"")),d=R((()=>e=>new URL(`/svg/${e}.svg`,window.location.origin).href)),c=R((()=>e=>Y.homePageList[e].color)),p=R((()=>e=>{if(""===e||!e)return t.$config.projectSource[0];let a=e.split(","),l="";for(let s=0;s<a.length;s++)s+1===a.length&&a.length>=2&&(l+="/"),l+=t.$config.projectSource[a[s]];return l}));let h={handleEditProject(e){o.myPublishProject.forEach((a=>{a.projectId===e.projectId&&(a.desc=e.desc,a.isPass="0",a.author=e.author,a.projectName=e.projectName,a.tag=e.tag)}))},handleClose(){o.backRoute&&""!==o.backRoute?t.$router.back():t.$router.push("/about")},handleShareLink(){o.shareUrl=location.href,t.$refs.PersonShareDialog.handleOpen("主页分享",o.shareUrl)},handleShare({projectId:e}){let a=K()+"draw/C"+e;t.$refs.PersonShareDialog.handleOpen("作品分享",a)},handleLogOut(){l.deleteUserInfo(),o.userData=null,o.myPublishProject=[],o.emptyStatus=!0,o.desc="未登录",t.$router.replace("/user")},CheckUserSex:e=>"0"===e,CheckAvatar:e=>e.avatar&&""!==e.avatar?e.avatar.startsWith("http")?e.avatar:`${t.$config.HUAWEI_OBS_CONFIG.HOST}${e.avatar}`:"0"==e.sex?ae:L,handleCurrentChange(e){o.currentPage=e,o.loading=!0,h.getMyPublishProject()},handleFilterCommand(e){o.filterOrder=e,o.loading=!0,h.getMyPublishProject()},getMyPublishProject(){o.loading=!0;const e=t.$bmob.Query("Resource");o.isSelf&&l.isLogin?(e.equalTo("authorId","==",l.userData.username),e.limit(o.pageSize),e.skip(o.pageSize*(o.currentPage-1)),e.order(...o.filterOrder.split(",")),e.find().then((e=>{o.totalCount=e.count,o.myPublishProject=e.results,o.loading=!1})).catch((e=>{t.$message.error("获取作品数据失败"),o.loading=!1}))):(e.equalTo("authorId","==",t.$route.params.username),e.equalTo("isPass","==","1"),e.limit(o.pageSize),e.skip(o.pageSize*(o.currentPage-1)),e.order(...o.filterOrder.split(",")),e.find().then((e=>{o.totalCount=e.count,o.myPublishProject=e.results,o.loading=!1})).catch((e=>{t.$message.error("获取作品数据失败"),o.loading=!1})))},handleUpdateUserData(){o.userData=JSON.parse(JSON.stringify(l.userData))},checkUsername(){if(!t.$route.params.username||l.isLogin&&t.$route.params.username===l.userData.username)return o.isSelf=!0,l.isLogin?(o.emptyStatus=!1,o.userData=JSON.parse(JSON.stringify(l.userData)),o.isloading=!1,void h.getMyPublishProject()):(o.isloading=!1,void(o.emptyStatus=!0));o.isSelf=!1;const e=t.$bmob.Query("User");e.limit(1),e.equalTo("username","==",t.$route.params.username),e.select("username","avatar","sex","rank","nickname","vip"),e.find().then((e=>{e.results.length?(o.userData=JSON.parse(JSON.stringify(e.results[0])),o.emptyStatus=!1,h.getMyPublishProject()):(o.desc="用户不存在",o.emptyStatus=!0),o.isloading=!1})).catch((e=>{o.isloading=!1,o.desc="加载失败",o.emptyStatus=!0}))},handleOpenUrl(e){window.open(e,"_blank")},handleDeleteHomePage(e){var a;let s=JSON.parse(JSON.stringify(JSON.parse((null==(a=l.userData)?void 0:a.homePage)||[]))),o=s.findIndex((a=>a.id===e));if(o>=0){s.splice(o,1);let e={homePage:JSON.stringify(s)};l.updateUserInfo(t,e,(()=>{t.$message.success("删除成功"),h.handleUpdateUserData()}),(()=>t.$message.error("删除失败")))}}};return g((()=>{o.backRoute=t.$router.options.history.state.back})),G((()=>t.$route.params.username),((e,a)=>{h.checkUsername()})),G((()=>l.isCheckUser),((e,a)=>{e&&h.checkUsername()}),{immediate:!0}),G((()=>l.isLogin),((e,a)=>{e&&h.checkUsername()})),n(r(r(n(r(r({},f(o)),h),{editSpaceStore:l,InfoFilled:J,copyText:H}),f(s.data)),s),{getUserVip:i,getIcon:d,getIconColor:c,getSource:p})}});const Ue=e=>(T("data-v-4498f7b0"),e=e(),z(),e),je={class:"full-layout","element-loading-background":"#00000000"},Ie={class:"header-box"},Ee=Ue((()=>O("h2",{class:"title"},"个人主页",-1))),_e={class:"flex-center",style:{gap:"20px"}},Oe=V("须知：每个用户七天内只能修改一次昵称和头像喔"),Ne={class:"flex-between info-box flex-warp"},Ve={class:"flex-start flex-warp",style:{gap:"15px"}},Re={key:1,class:"scrollHidden box-shadow flex-center",style:{height:"100px",width:"100px",borderRadius:"50%"}},$e={class:"flex-column-start info-text"},Be={class:"flex-between info-name"},Me={key:1,class:"flex-center"},Te=["src"],ze={class:"flex-center"},Qe={class:"flex-start",style:{gap:"10px","margin-top":"10px"}},Fe=["onClick"],Ge=["src"],Je=V("编 辑"),He=V("删 除"),Ye={key:0},Ke=V("退出登录"),qe={key:1,class:"flex-between info-box flex-warp"},Le={class:"flex-start flex-warp",style:{gap:"15px"}},Xe={class:"info-icon flex-center"},Ze=Ue((()=>O("div",{class:"info-line"},null,-1))),We=Ue((()=>O("div",{class:"flex-column-start info-text"},[O("h5",null,"登录密码"),O("p",null,"管理登录密码")],-1))),ea=Ue((()=>O("div",{class:"flex-column-start info-text"},[O("p",null," 设置安全性高的密码可以使您的账号更安全。建议您定期更换密码 "),O("p",null," 设置包含大小写字母，数字且不能使用特殊字符，同时长度6 ~ 16位的密码 ")],-1))),aa=V("修改密码"),ta={style:{margin:"30px 15px 10px"}},la={class:"flex-between",style:{margin:"0 20px"}},sa=Ue((()=>O("h2",{class:"title"},"作品集",-1))),oa=V("按热度排序"),ia=V("按更新时间排序"),ra=V("按发布时间排序"),na={style:{padding:"15px 0"}},da={class:"grid-box scrollAuto scrollbar"},ca={class:"frameImg"},ua=["src"],pa={class:"info"},ma={class:"flex-between",style:{"padding-bottom":"5px"}},ga=["title"],fa=V("编 辑"),ha=V("分 享"),va={class:"twoline",style:{"font-size":"14px",display:"-webkit-inline-box"}},ba={class:"flex-center full-w",style:{padding:"10px"}},ya={key:1,class:"flex-center"},wa={key:2,class:"flex-center"},ka=[Ue((()=>O("div",{class:"loading-spinner-1"},null,-1)))],Pa={key:1,class:"flex-center",style:{height:"calc(100% - 55px)"}};var xa=d(De,[["render",function(e,a,t,l,s,o){const i=h("Promotion"),r=h("el-icon"),n=h("el-tooltip"),d=h("Close"),c=h("el-tag"),u=h("AvatarUpload"),p=h("el-skeleton-item"),m=h("el-skeleton"),g=h("el-image"),f=h("Male"),k=h("Female"),P=h("el-dropdown-item"),x=h("el-dropdown-menu"),C=h("el-dropdown"),A=h("Plus"),S=h("el-button"),D=h("el-popconfirm"),R=h("Lock"),M=h("Filter"),T=h("el-divider"),z=h("SafeRender"),Q=h("el-pagination"),F=h("el-empty"),G=h("el-scrollbar"),J=h("EditPasswordDialog"),H=h("EditNickNameDialog"),Y=h("CustomHomePageDialog"),K=h("PersonShareDialog"),q=h("PublishEditDialog"),L=v("loading");return j((U(),I("div",je,[O("div",Ie,[Ee,O("div",_e,[_(n,{content:"分享主页",placement:"bottom"},{default:y((()=>[e.isSelf&&e.userData?(U(),b(r,{key:0,size:20,class:"pointer icon",onClick:e.handleShareLink},{default:y((()=>[_(i)])),_:1},8,["onClick"])):E("v-if",!0)])),_:1}),_(n,{content:"关 闭",placement:"bottom"},{default:y((()=>[_(r,{size:20,class:"pointer icon",onClick:e.handleClose},{default:y((()=>[_(d)])),_:1},8,["onClick"])])),_:1})])]),e.isloading||e.emptyStatus||!e.userData?e.isloading||!e.emptyStatus||e.userData?E("v-if",!0):(U(),I("div",Pa,[_(F,{image:le,description:e.desc,"image-size":200},{default:y((()=>[E(' <el-button type="primary" @click="editSpaceStore.loginVisible = true">去登录</el-button> ')])),_:1},8,["image","description"])])):(U(),b(G,{key:0,style:{height:"calc(100% - 55px)"}},{default:y((()=>{var t,l;return[e.isSelf?(U(),b(c,{key:0,type:"warning",style:{margin:"20px 20px 0"},effect:"dark",class:"notice-tag"},{default:y((()=>[Oe])),_:1})):E("v-if",!0),O("div",Ne,[O("div",Ve,[O("div",null,[e.isSelf?(U(),b(u,{key:0,height:100,width:100,type:0,isAuto:!1,defaultAvatar:e.CheckAvatar(e.userData)},null,8,["defaultAvatar"])):(U(),I("div",Re,[_(g,{src:e.CheckAvatar(e.userData),fit:"cover",class:"full-layout"},{placeholder:y((()=>[_(m,{animated:"",class:"full-layout"},{template:y((()=>[_(p,{variant:"image",style:{height:"100%"}})])),_:1})])),_:1},8,["src"]),E(' <img :src="CheckAvatar(userData)" style="object-fit: cover;"> ')]))]),O("div",$e,[O("div",Be,[e.isSelf?(U(),I("span",{key:0,class:"flex-center pointer",onClick:a[0]||(a[0]=a=>e.visible1=!0)},N(e.userData.nickname),1)):(U(),I("span",Me,N(e.userData.nickname),1)),e.CheckUserSex(e.userData.sex)?(U(),b(r,{key:2,size:20,color:"#0052d9"},{default:y((()=>[_(f)])),_:1})):(U(),b(r,{key:3,size:20,color:"#d760b7"},{default:y((()=>[_(k)])),_:1})),(null==(t=e.userData)?void 0:t.vip)>0?(U(),I("img",{key:4,src:e.getUserVip(null==(l=e.userData)?void 0:l.vip),class:"vip"},null,8,Te)):E("v-if",!0),E(' <img src="/img/coco.png" class="vip" v-if="userData?.isCocoVip && userData.isCocoVip === \'1\'"> ')]),O("p",ze,"像素号："+N(e.userData.username),1),e.userData.rank?(U(),b(c,{key:0,type:"success"},{default:y((()=>[V("像素格子第"+N(e.userData.rank)+"位用户",1)])),_:1})):E("v-if",!0),E(' <p class="flex-center" v-if="userData.rank">像素格子第{{userData.rank}}位用户</p> '),O("div",Qe,[e.userData.homePage?(U(!0),I($,{key:0},B(JSON.parse(e.userData.homePage),(a=>(U(),b(C,{key:a.id},{dropdown:y((()=>[_(x,null,{default:y((()=>[_(P,{onClick:t=>{e.visible3=!0,e.homePageEditData=a}},{default:y((()=>[Je])),_:2},1032,["onClick"]),_(P,{onClick:t=>e.handleDeleteHomePage(a.id)},{default:y((()=>[He])),_:2},1032,["onClick"])])),_:2},1024)])),default:y((()=>[O("div",{class:"pointer flex-center pageIcon",onClick:t=>e.handleOpenUrl(a.url)},[O("img",{src:e.getIcon(a.id),style:w({backgroundColor:e.getIconColor(a.id)})},null,12,Ge)],8,Fe)])),_:2},1024)))),128)):E("v-if",!0),e.isSelf?(U(),I("div",{key:1,class:"pointer flex-center pageIcon",onClick:a[1]||(a[1]=a=>{e.visible3=!0,e.homePageEditData=null})},[_(r,null,{default:y((()=>[_(A)])),_:1})])):E("v-if",!0)])])]),e.isSelf?(U(),I("div",Ye,[_(D,{width:160,"confirm-button-text":"确认","cancel-button-text":"取消",icon:e.InfoFilled,"confirm-button-type":"primary",title:"是否退出登录？",onConfirm:e.handleLogOut},{reference:y((()=>[_(S,{type:"primary"},{default:y((()=>[Ke])),_:1})])),_:1},8,["icon","onConfirm"])])):E("v-if",!0)]),e.isSelf&&!e.userData.platform||e.isSelf&&"0"===e.userData.platform?(U(),I("div",qe,[O("div",Le,[O("div",Xe,[_(r,{size:25,color:"#0052d9"},{default:y((()=>[_(R)])),_:1})]),Ze,We,ea]),O("div",null,[_(S,{type:"primary",onClick:a[2]||(a[2]=a=>e.visible=!0)},{default:y((()=>[aa])),_:1})])])):E("v-if",!0),O("div",ta,[O("div",la,[sa,O("div",null,[_(C,{onCommand:e.handleFilterCommand,"max-height":200},{dropdown:y((()=>[_(x,null,{default:y((()=>[_(P,{command:"-isTop,-downloadCount"},{default:y((()=>[oa])),_:1}),_(P,{command:"-updatedAt"},{default:y((()=>[ia])),_:1}),_(P,{command:"-createdAt"},{default:y((()=>[ra])),_:1})])),_:1})])),default:y((()=>[_(r,{size:"20",class:"pointer iconHover"},{default:y((()=>[_(M)])),_:1})])),_:1},8,["onCommand"])])]),O("div",na,[e.myPublishProject.length&&!e.loading?(U(),I($,{key:0},[O("div",da,[(U(!0),I($,null,B(e.myPublishProject,(a=>(U(),I("div",{key:a.projectId,class:"download-item"},[O("div",ca,[E(' <img :src="getFrameImg(item.data.frameImg)"/> '),_(g,{src:e.getFrameImg(a.frameImg),fit:"contain",class:"image-pixelated"},{placeholder:y((()=>[_(m,{animated:"",class:"full-layout"},{template:y((()=>[_(p,{variant:"image",style:{height:"100%"}})])),_:1})])),_:2},1032,["src"]),"1"===a.isTop?(U(),I("img",{key:0,src:te,class:"top"},null,8,ua)):E("v-if",!0),_(c,{type:"success",class:"size"},{default:y((()=>[V(N(a.width)+"x"+N(a.height),1)])),_:2},1024),E(' <el-tag type="danger" v-if="item.tip!==\'\'" class="tip">{{ item.tip }}</el-tag> '),_(c,{type:"danger",class:"tip"},{default:y((()=>[E(" {{ item.source ? $config.projectSource[item.source] : $config.projectSource['0'] }} "),V(N(e.getSource(a.source)),1)])),_:2},1024),_(n,{content:a.reason,placement:"top"},{default:y((()=>[e.isSelf&&"2"===a.isPass?(U(),b(c,{key:0,type:e.$config.projectStateInfo[a.isPass].type,class:"state"},{default:y((()=>[V(N(e.$config.projectStateInfo[a.isPass].label),1)])),_:2},1032,["type"])):E("v-if",!0)])),_:2},1032,["content"]),e.isSelf&&"2"!==a.isPass?(U(),b(c,{key:1,type:e.$config.projectStateInfo[a.isPass].type,class:"state"},{default:y((()=>[V(N(e.$config.projectStateInfo[a.isPass].label),1)])),_:2},1032,["type"])):E("v-if",!0)]),O("div",pa,[O("div",ma,[O("h4",{class:"oneline project-name",title:a.projectName},N(a.projectName),9,ga),_(C,{trigger:"click",size:"small","hide-on-click":!1},{dropdown:y((()=>[_(x,null,{default:y((()=>["1"!==a.isPass||a.activityCode&&"0"!==a.activityCode?E("v-if",!0):(U(),b(P,{key:0,onClick:t=>e.handleDownload(a),icon:"Download",disabled:e.isDownload},{default:y((()=>[V(N(e.isDownload?e.$t("message.downloadLoading"):e.$t("message.download")),1)])),_:2},1032,["onClick","disabled"])),"1"!==a.isPass||a.activityCode&&"0"!==a.activityCode?E("v-if",!0):(U(),b(P,{key:1,onClick:t=>e.handleImport(a),icon:"FolderAdd",disabled:e.isImport},{default:y((()=>[V(N(e.isImport?e.$t("message.importLoading"):e.$t("message.import")),1)])),_:2},1032,["onClick","disabled"])),"1"!==a.isPass||a.activityCode&&"0"!==a.activityCode?E("v-if",!0):(U(),b(P,{key:2,onClick:t=>e.handlePreview(a),icon:"View",disabled:e.isPreview},{default:y((()=>[V(N(e.isPreview?e.$t("message.previewLoading"):e.$t("message.preview")),1)])),_:2},1032,["onClick","disabled"])),e.isSelf?(U(),b(P,{key:3,onClick:t=>e.handleEdit(a),icon:"Edit"},{default:y((()=>[fa])),_:2},1032,["onClick"])):E("v-if",!0),e.isSelf?(U(),b(P,{key:4,onClick:t=>e.handleShare(a),icon:"Link"},{default:y((()=>[ha])),_:2},1032,["onClick"])):E("v-if",!0),!e.isSelf||"1"!==a.isPass||a.activityCode&&"0"!==a.activityCode?E("v-if",!0):(U(),b(P,{key:5,onClick:t=>e.handleEditResource(a,"3","isPass"),icon:"Hide"},{default:y((()=>[V(N("3"===a.isPass?"取消隐藏":"隐 藏"),1)])),_:2},1032,["onClick"]))])),_:2},1024)])),default:y((()=>[_(S,{type:"primary",icon:e.ArrowDownBold,size:"small",style:{"margin-left":"5px"}},null,8,["icon"])])),_:2},1024)]),_(T,{"border-style":"dashed","content-position":"left",style:{margin:"5px 0"}},{default:y((()=>[V(N(a.createAt.split(" ")[0].replaceAll("/","-"))+" - 下载量: "+N(a.downloadCount?a.downloadCount>=100?"99+":a.downloadCount:"0"),1)])),_:2},1024),_(n,{content:a.desc,effect:"light"},{default:y((()=>[O("div",va,[E(" {{ item.desc }}  "),_(z,{sourceText:a.desc},null,8,["sourceText"])])])),_:2},1032,["content"])])])))),128))]),O("div",ba,[_(Q,{"current-page":e.currentPage,"onUpdate:current-page":a[3]||(a[3]=a=>e.currentPage=a),"page-size":e.pageSize,background:"",layout:"total, prev, pager, next",total:e.totalCount,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):e.loading||e.myPublishProject.length?e.loading?(U(),I("div",wa,ka)):E("v-if",!0):(U(),I("div",ya,[_(F,{image:le,description:"空空如也","image-size":200},null,8,["image"])]))])]),E(' <div class="flex-start info-box">\r\n                <div class="info-icon flex-center">\r\n                    <el-icon :size="25" color="#0052d9"><Message /></el-icon>\r\n                </div>\r\n                <div class="info-line">\r\n                </div>\r\n                <div class="flex-column-start info-text">\r\n                    <h5>邮箱</h5>\r\n                    <p>{{userData.email}}</p>\r\n                </div>\r\n            </div> ')]})),_:1})),e.visible?(U(),b(J,{key:2,visible:e.visible,onClose:a[4]||(a[4]=a=>e.visible=!1),onUpdate:a[5]||(a[5]=a=>{e.userData=null,e.emptyStatus=!0})},null,8,["visible"])):E("v-if",!0),e.visible1?(U(),b(H,{key:3,visible:e.visible1,onClose:a[6]||(a[6]=a=>e.visible1=!1),onUpdate:e.handleUpdateUserData},null,8,["visible","onUpdate"])):E("v-if",!0),e.visible3?(U(),b(Y,{key:4,visible:e.visible3,onClose:a[7]||(a[7]=a=>e.visible3=!1),editData:e.homePageEditData,onUpdate:e.handleUpdateUserData},null,8,["visible","editData","onUpdate"])):E("v-if",!0),_(K,{ref:"PersonShareDialog"},null,512),e.PublishEditVisible?(U(),b(q,{key:5,visible:e.PublishEditVisible,editInfo:e.editProjectInfo,onSave:e.handleEditProject,onClose:a[8]||(a[8]=a=>e.PublishEditVisible=!1)},null,8,["visible","editInfo","onSave"])):E("v-if",!0)])),[[L,e.isloading]])}],["__scopeId","data-v-4498f7b0"],["__file","D:/project/pixel-grid/src/views/user/index.vue"]]);export{xa as default};
