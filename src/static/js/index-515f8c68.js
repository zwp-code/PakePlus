var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&s(e,l,a[l]);return e};import{d,A as u,r,o as c,az as m,V as p,N as h,t as f,aQ as g,a8 as b,aK as y,aa as v,g as x,ab as C,ac as P,u as k,ad as w,ae as S,af as $,ag as _,K as B,_ as V,b as O,a2 as D,l as N,j as L,n as E,h as A,O as j,ah as F,F as J,p as K,k as R,x as I,y as M,e as T,f as U,q as z,X as q,v as Q,s as W,z as X}from"./index-6a0d579b.js";import{u as G,w as H,r as Y}from"./xlsx-eef54bab.js";import{e as Z}from"./empty-6662c720.js";var ee=d({name:"customPindou",props:{},components:{},emits:[],setup(e,t){const{proxy:o}=x(),n=u();let s=r({backRoute:null,loading:!1,list:null,myCustom:[],pindouBrand:"",customPindouKey:"",customPindouName:"",customPindouLabel:"",innerVisible:!1,name:"",color:"",editMask:-1,customData:{},isAddPindou:!1,searchValue:"",searchData:[],selectRows:[],pindouColorScheme:"",pindouColorSchemeOptions:[{num:"0",label:"黑色系"},{num:"1",label:"白色系"},{num:"2",label:"灰色系"},{num:"3",label:"棕色系"},{num:"4",label:"红色系"},{num:"5",label:"红橙色系"},{num:"6",label:"橙色系"},{num:"7",label:"橙黄色系"},{num:"8",label:"黄色系"},{num:"9",label:"黄绿色系"},{num:"10",label:"绿色系"},{num:"11",label:"蓝绿色系"},{num:"12",label:"蓝色系"},{num:"13",label:"蓝紫色系"},{num:"14",label:"紫色系"},{num:"15",label:"紫红色系"},{num:"16",label:"粉色系"}],selectedPindou:new Map}),d={handleSelect(e){s.selectedPindou.has(e)?s.selectedPindou.delete(e):s.selectedPindou.set(e,e)},handleEditPindou(e,a){s.innerVisible=!0,s.editMask=e,s.color=`#${a.color}`,s.name=a.name},handleSearchColorScheme(){let e=s.list&&s.list.data;s.loading=!0,s.searchValue="";let a=[];for(let l=0;l<e.length;l++){let t=v(e[l].color);C(P(t[0],t[1],t[2]),s.pindouColorScheme)&&a.push(e[l])}s.searchData=a,s.loading=!1},handleSearch(){if(""===s.searchValue.trim())return s.searchData=[],o.$message.warning("请输入搜索内容");s.loading=!0;let e=new RegExp(s.searchValue,"i");s.searchData=s.list&&s.list.data.filter((a=>e.test(a.name))),s.loading=!1},handleOpen(){s.loading=!0;let e=o.$utils.cache.pindou.get();e&&(s.myCustom=JSON.parse(e),""===s.pindouBrand&&(s.pindouBrand=s.myCustom[0].value,s.list=d.getList()),s.loading=!1)},getList:(e=s.pindouBrand)=>e&&""!==e&&JSON.parse(JSON.stringify(n.pindouMaps[e]))||null,saveData(){o.$utils.cache.pindou.set(JSON.stringify(s.myCustom)),n.pindouBrandOptions=JSON.parse(JSON.stringify(s.myCustom))},handleChange(e){""===s.pindouBrand?s.list=null:(s.loading=!0,d.handleReset(),s.list=d.getList(s.pindouBrand),s.loading=!1)},async handleSavePindou(e){if("edit"===e){if(""===s.customPindouLabel.trim())return o.$message.warning("请输入拼豆名称");return void(await n.editPindouData({id:s.pindouBrand,value:s.list})&&(s.myCustom.forEach((e=>{e.value===s.pindouBrand&&(e.label=s.customPindouLabel)})),d.saveData(),o.$message.success("已保存")))}if(s.customPindouKey=k.v1(),""===s.customPindouName.trim()||""===s.customPindouKey.trim())return o.$message.warning("请输入拼豆名称");if(Object.keys(n.pindouMaps).find((e=>e===s.customPindouKey)))return o.$message.warning("拼豆属性不能重复");await n.savePindouData({id:s.customPindouKey,value:{data:[],label:s.customPindouName}})&&(s.myCustom.push({label:s.customPindouName,value:s.customPindouKey}),s.pindouBrand=s.customPindouKey,s.list=d.getList(),d.saveData(),o.$message.success("已新增"),s.isAddPindou=!1,s.customPindouKey="",s.customPindouName="")},async handleDeletePindou(){var e,a;if(w.has(s.pindouBrand))return o.$message.warning("该拼豆不能删除");let l=s.myCustom.findIndex((e=>e.value===s.pindouBrand));if(l>=0){await n.deletePindouById(s.pindouBrand)&&(s.myCustom.splice(l,1),s.pindouBrand=(null==(e=s.myCustom[0])?void 0:e.value)?null==(a=s.myCustom[0])?void 0:a.value:"",s.list=d.getList(),d.saveData(),o.$message.success("已删除"),n.settingsOption.defaultPindou="mard-v2")}},handleAdd(){s.innerVisible=!0,s.editMask=-1,s.name="",s.color=""},hideDiaog(){s.innerVisible=!1},handleClose(){o.$utils.cache.customPindou.remove(),s.backRoute&&""!==s.backRoute?o.$router.back():o.$router.push("/about")},handleAddColorTemplate(){let e=o.$utils.cache.mycolor.get();if(e){let a=JSON.parse(e);n.setMyColorList(s.list);let l=s.list&&s.list.data.map((e=>({label:null==e?void 0:e.name,color:String(e.color).startsWith("#")?e.color:`#${e.color}`})));a.push({id:k.v1(),groupName:s.list.label,list:l}),o.$utils.cache.mycolor.set(JSON.stringify(a)),n.setMyColorList(a),o.$message.success("添加成功")}},handleReset(){s.selectedPindou.size>0&&s.selectedPindou.clear(),s.searchValue="",s.searchData=[],s.pindouColorScheme=""},handleEdit(){if(""===s.name)return o.$message.warning("色号不能为空");if(""===s.color)return o.$message.warning("颜色不能为空");if(!S(s.color)&&!$(s.color))return o.$message.warning("颜色不规范，请输入十六进制的颜色值");if(s.editMask>=0)s.list&&(s.list.data[s.editMask]={name:s.name,color:s.color.slice(1,7).toLowerCase()});else{if(s.list&&s.list.data.find((e=>e.name===s.name)))return o.$message.warning("色号不能重复");s.list.data.push({name:s.name,color:s.color.slice(1,7).toLowerCase()})}n.editPindouData({id:s.pindouBrand,value:s.list}).then((e=>{o.$message.success("已保存"),d.hideDiaog()})).catch((e=>{o.$message.error("保存失败")}))},handleDelete(e){let a=s.list&&s.list.data.findIndex((a=>a.name===e.name));a>=0&&s.list.data.splice(a,1),n.editPindouData({id:s.pindouBrand,value:s.list}).then((e=>{o.$message.success("已删除")})).catch((e=>{o.$message.error("删除失败")}))},handleBatchDelete(){if(!s.selectedPindou.size)return o.$message.warning("请先选择拼豆色号");Array.from(s.selectedPindou.keys()).forEach((e=>{let a=s.list&&s.list.data.findIndex((a=>a.name===s.selectedPindou.get(e)));a>=0&&s.list.data.splice(a,1)})),n.editPindouData({id:s.pindouBrand,value:s.list}).then((e=>{s.selectedPindou.clear(),o.$message.success("已删除")})).catch((e=>{o.$message.error("删除失败")}))},exportFile(e=!1){if(!e&&n.checkVipFunction("customPindouExport"))return;let a=e?"拼豆色卡模板":`${s.pindouBrand}-${s.customPindouLabel}`;const l=G.book_new(),t=G.json_to_sheet(e?[{name:"A1",color:"000000"}]:s.list?s.list.data:[]);G.book_append_sheet(l,t,"Sheet1"),H(l,`${a}.xlsx`)},exportJSONFile(){if(n.checkVipFunction("customPindouExport"))return;const e=JSON.stringify(s.list?s.list.data:[]),a=new Blob([e],{type:""});_.saveAs(a,`${s.pindouBrand}-${s.customPindouLabel}.json`)},importExcelFile(){const e=document.createElement("input");e.type="file",e.accept=".xls,.xlsx",e.addEventListener("change",(function(){const a=e.files[0];if(a){const e=new FileReader;e.onload=function(e){const a=new Uint8Array(e.target.result),l=Y(a,{type:"array",cellStyles:!0});let t=[];l.SheetNames.forEach((function(e){const a=l.Sheets[e],o=G.sheet_to_json(a);t=t.concat(o)})),d.openInfo(t)},e.readAsArrayBuffer(a)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)},importJSONFile(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",(function(){const a=e.files[0];if(a){const e=new FileReader;e.onload=function(e){const a=JSON.parse(e.target.result);d.openInfo(a)},e.readAsText(a)}})),document.body.appendChild(e),e.click(),document.body.removeChild(e)},openInfo(e){B.confirm("是否覆盖已有数据?","提 示",{confirmButtonText:"确 认",cancelButtonText:"取 消",type:"warning"}).then((()=>{s.list?s.list.data=e:s.list={data:e,label:s.pindouBrand},n.editPindouData({id:s.pindouBrand,value:s.list,label:s.customPindouLabel}).then((e=>{o.$message.success("已覆盖")})).catch((e=>{o.$message.error("保存失败")}))})).catch((()=>{}))},handleInput(e){s.customPindouKey=s.customPindouKey.replace(/[\u4E00-\u9FA5]/g,"")}};return c((()=>{s.backRoute=o.$router.options.history.state.back,o.$utils.cache.customPindou.set("1")})),m((()=>{d.handleOpen()})),p((()=>s.pindouBrand),((e,a)=>{if(e){let a=s.myCustom.find((a=>a.value===e));s.customPindouLabel=a?a.label:""}else s.customPindouLabel="",s.pindouBrand=""})),p((()=>s.customPindouLabel),((e,a)=>{s.list&&(s.list.label=e)})),h((()=>{o.$utils.cache.customPindou.remove()})),V=i(i({},f(s)),d),a(V,l({editSpaceStore:n,InfoFilled:g,copyText:b,extractRgbaToString:y,hexToRgba:v}));var V}});const ae={class:"full-layout"},le={class:"header-box"},te=(e=>(I("data-v-772d01fa"),e=e(),M(),e))((()=>L("h2",{class:"title"},"自定义拼豆",-1))),oe={class:"flex-center",style:{gap:"20px"}},ne={class:"flex flex-column","element-loading-background":"#00000000",style:{height:"calc(100% - 55px)"}},se={class:"flex-column-start flex-warp searchBox"},ie={class:"flex-start flex-warp",style:{gap:"10px"}},de={class:"item flex-start flex-warp"},ue=X(" 新建拼豆色卡 "),re={class:"flex-column-start"},ce={class:"flex-end"},me=X("取消"),pe=X("保存"),he={class:"item flex-start flex-warp"},fe=X("保存拼豆"),ge=X("删除拼豆"),be=X("导入/导出拼豆"),ye=X("下载空模板"),ve=X("导入为Excel"),xe=X("导出为Excel"),Ce=X("导入为JSON"),Pe=X("导出为JSON"),ke=X("添加到我的颜色"),we={class:"flex-start flex-warp",style:{gap:"10px"}},Se={class:"item flex-start flex-warp"},$e={class:"item flex-start flex-warp"},_e=X("重置列表"),Be=X("批量删除"),Ve=X("新增色号"),Oe={key:0,class:"full-layout scrollbar grid-box scrollAuto"},De=["onClick"],Ne=["onClick"],Le={class:"color-meta flex-column-start",style:{gap:"10px"}},Ee={style:{"font-size":"15px"},class:"full-w flex-between"},Ae={class:"flex-end",style:{gap:"10px"}},je={style:{"font-size":"12px"}},Fe={key:1,class:"full-layout flex-center scrollbar scrollAuto"},Je={class:"flex-between",style:{"margin-top":"10px"}},Ke={class:"dialog-footer"};var Re=V(ee,[["render",function(e,a,l,t,o,n){var s;const i=O("Close"),d=O("el-icon"),u=O("el-tooltip"),r=O("el-option"),c=O("el-button"),m=O("el-input"),p=O("el-select"),h=O("el-popconfirm"),f=O("el-dropdown-item"),g=O("el-dropdown-menu"),b=O("el-dropdown"),y=O("search"),v=O("Edit"),x=O("Delete"),C=O("el-empty"),P=O("el-color-picker"),k=O("el-dialog"),w=D("loading");return T(),N("div",ae,[L("div",le,[te,L("div",oe,[E(u,{content:"关 闭",placement:"bottom"},{default:A((()=>[E(d,{size:20,class:"pointer icon",onClick:e.handleClose},{default:A((()=>[E(i)])),_:1},8,["onClick"])])),_:1})])]),j((T(),N("div",ne,[L("div",se,[L("div",ie,[L("div",de,[E(p,{modelValue:e.pindouBrand,"onUpdate:modelValue":a[4]||(a[4]=a=>e.pindouBrand=a),placeholder:"请选择",style:{width:"200px"},onChange:e.handleChange},{footer:A((()=>[e.isAddPindou?(T(),N(J,{key:1},[L("div",re,[E(m,{modelValue:e.customPindouName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.customPindouName=a),class:"option-input",placeholder:"请输入拼豆名称",maxlength:"15"},null,8,["modelValue"])]),L("div",ce,[E(c,{onClick:a[2]||(a[2]=a=>{e.customPindouKey="",e.customPindouName="",e.isAddPindou=!1})},{default:A((()=>[me])),_:1}),E(c,{type:"primary",onClick:a[3]||(a[3]=a=>e.handleSavePindou("save"))},{default:A((()=>[pe])),_:1})])],64)):(T(),U(c,{key:0,text:"",bg:"",onClick:a[0]||(a[0]=a=>e.isAddPindou=!0)},{default:A((()=>[ue])),_:1}))])),default:A((()=>[(T(!0),N(J,null,K(e.myCustom,(e=>(T(),U(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),E(m,{modelValue:e.customPindouLabel,"onUpdate:modelValue":a[5]||(a[5]=a=>e.customPindouLabel=a),placeholder:"请输入拼豆名称",style:{width:"200px"},disabled:""===e.pindouBrand},null,8,["modelValue","disabled"])]),L("div",he,[E(c,{type:"primary",onClick:a[6]||(a[6]=a=>e.handleSavePindou("edit")),disabled:""===e.pindouBrand},{default:A((()=>[fe])),_:1},8,["disabled"]),E(h,{title:"确定删除该拼豆?",onConfirm:e.handleDeletePindou},{reference:A((()=>[E(c,{type:"danger",disabled:""===e.pindouBrand},{default:A((()=>[ge])),_:1},8,["disabled"])])),_:1},8,["onConfirm"]),E(b,{trigger:"click",style:{flex:"1"}},{dropdown:A((()=>[E(g,null,{default:A((()=>[E(f,{onClick:a[7]||(a[7]=a=>e.exportFile(!0))},{default:A((()=>[ye])),_:1}),E(f,{onClick:e.importExcelFile},{default:A((()=>[ve])),_:1},8,["onClick"]),E(f,{onClick:a[8]||(a[8]=a=>e.exportFile(!1))},{default:A((()=>[xe])),_:1}),E(f,{onClick:e.importJSONFile},{default:A((()=>[Ce])),_:1},8,["onClick"]),E(f,{onClick:e.exportJSONFile},{default:A((()=>[Pe])),_:1},8,["onClick"])])),_:1})])),default:A((()=>[E(c,{type:"warning",disabled:""===e.pindouBrand},{default:A((()=>[be])),_:1},8,["disabled"])])),_:1}),E(c,{type:"success",onClick:e.handleAddColorTemplate,disabled:""===e.pindouBrand},{default:A((()=>[ke])),_:1},8,["onClick","disabled"])])]),L("div",we,[L("div",Se,[E(m,{modelValue:e.searchValue,"onUpdate:modelValue":a[9]||(a[9]=a=>e.searchValue=a),style:{width:"200px"},placeholder:"搜索色号",clearable:"",onKeyup:F(e.handleSearch,["enter"]),disabled:""===e.pindouBrand},{prefix:A((()=>[E(d,{class:"el-input__icon"},{default:A((()=>[E(y)])),_:1})])),_:1},8,["modelValue","onKeyup","disabled"]),E(p,{modelValue:e.pindouColorScheme,"onUpdate:modelValue":a[10]||(a[10]=a=>e.pindouColorScheme=a),placeholder:"请选择色系",style:{width:"200px"},onChange:e.handleSearchColorScheme,clearable:""},{default:A((()=>[(T(!0),N(J,null,K(e.pindouColorSchemeOptions,(e=>(T(),U(r,{key:e.num,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),L("div",$e,[E(c,{type:"primary",onClick:e.handleReset,disabled:""===e.pindouBrand},{default:A((()=>[_e])),_:1},8,["onClick","disabled"]),E(c,{type:"danger",onClick:e.handleBatchDelete,disabled:""===e.pindouBrand,style:{"margin-left":"0"}},{default:A((()=>[Be])),_:1},8,["onClick","disabled"]),E(c,{type:"success",onClick:e.handleAdd,disabled:""===e.pindouBrand,style:{"margin-left":"0"}},{default:A((()=>[Ve])),_:1},8,["onClick","disabled"])])])]),(e.list||(null==(s=e.list)?void 0:s.data)||e.searchData.length)&&!e.loading?(T(),N("div",Oe,[(T(!0),N(J,null,K(e.searchData.length?e.searchData:e.list?e.list.data||e.list:[],((l,t)=>(T(),N("div",{key:l.name,class:z(["color-item",{active:e.selectedPindou.has(l.name)}]),onClick:a=>e.handleSelect(l.name)},[L("div",{style:W({backgroundColor:`#${l.color}`}),class:"color-preview pointer"},[L("div",{class:"color-name",onClick:q((a=>e.copyText(`#${l.color}`)),["stop"])},Q(l.name),9,Ne)],4),L("div",Le,[L("div",Ee,[L("span",null,Q(`#${l.color}`.toUpperCase()),1),L("div",Ae,[E(d,{onClick:q((a=>e.handleEditPindou(t,l)),["stop"]),class:"pointer"},{default:A((()=>[E(v)])),_:2},1032,["onClick"]),E(h,{title:"确定删除该色号?",onConfirm:a=>e.handleDelete(l)},{reference:A((()=>[E(d,{onClick:a[11]||(a[11]=q((()=>{}),["stop"])),class:"pointer"},{default:A((()=>[E(x)])),_:1})])),_:2},1032,["onConfirm"])])]),L("span",je,Q(e.extractRgbaToString(e.hexToRgba(l.color))),1)])],10,De)))),128))])):e.loading||e.searchData.length&&e.list?R("v-if",!0):(T(),N("div",Fe,[E(C,{image:Z,description:"空空如也","image-size":200},null,8,["image"])]))])),[[w,e.loading]]),E(k,{modelValue:e.innerVisible,"onUpdate:modelValue":a[14]||(a[14]=a=>e.innerVisible=a),width:"300",title:e.editMask>=0?"修改":"添加","append-to-body":"",class:"z-dialog"},{footer:A((()=>[L("div",Ke,[E(c,{onClick:e.hideDiaog},{default:A((()=>[X(Q(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),E(c,{type:"primary",onClick:e.handleEdit},{default:A((()=>[X(Q(e.$t("message.save")),1)])),_:1},8,["onClick"])])])),default:A((()=>[L("div",Je,[E(m,{modelValue:e.name,"onUpdate:modelValue":a[12]||(a[12]=a=>e.name=a),placeholder:"请输入",style:{width:"200px"}},null,8,["modelValue"]),E(P,{modelValue:e.color,"onUpdate:modelValue":a[13]||(a[13]=a=>e.color=a)},null,8,["modelValue"])])])),_:1},8,["modelValue","title"])])}],["__scopeId","data-v-772d01fa"],["__file","D:/project/pixel-grid/src/views/customPindou/index.vue"]]);export{Re as default};
